<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YORI - Ton refuge crÃ©atif</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Outfit:wght@300;400;500;600;700&family=Caveat:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* ============================================
           VARIABLES & RESET
        ============================================ */
        :root {
            /* Colors */
            --cream: #F5F1E8;
            --ink: #3D3428;
            --terracotta: #D4A589;
            --terracotta-dark: #B8876E;
            
            --powder-blue: #B4C7D9;
            --clay-pink: #E8C5C0;
            --sage: #C9D1BC;
            --honey: #F4E4C1;
            --lavender: #D1C9D9;
            
            --success: #A8C69F;
            --alert: #E8B4A0;
            --neutral: #DDDAD3;
            
            /* Typography */
            --font-display: 'DM Serif Display', serif;
            --font-body: 'Outfit', sans-serif;
            --font-handwritten: 'Caveat', cursive;
            
            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
            
            /* Border radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 2px 8px rgba(61, 52, 40, 0.06);
            --shadow-md: 0 4px 16px rgba(61, 52, 40, 0.08);
            --shadow-lg: 0 8px 32px rgba(61, 52, 40, 0.12);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-body);
            background-color: var(--cream);
            color: var(--ink);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* ============================================
           UTILITIES
        ============================================ */
        .hidden {
            display: none !important;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        /* ============================================
           LAYOUT
        ============================================ */
        .container {
            max-width: 430px;
            min-height: 100vh;
            margin: 0 auto;
            background: var(--cream);
            box-shadow: 0 0 40px rgba(0,0,0,0.1);
        }
        
        .screen {
            min-height: 100vh;
            padding: var(--space-lg);
            display: none;
        }
        
        .screen.active {
            display: flex;
            flex-direction: column;
        }
        
        /* ============================================
           TYPOGRAPHY
        ============================================ */
        h1 {
            font-family: var(--font-display);
            font-size: 36px;
            line-height: 1.2;
            margin-bottom: var(--space-md);
        }
        
        h2 {
            font-family: var(--font-display);
            font-size: 28px;
            line-height: 1.2;
            margin-bottom: var(--space-md);
        }
        
        h3 {
            font-family: var(--font-display);
            font-size: 22px;
            line-height: 1.3;
            margin-bottom: var(--space-sm);
        }
        
        p {
            font-size: 16px;
            line-height: 1.6;
            color: rgba(61, 52, 40, 0.8);
        }
        
        /* ============================================
           COMPONENTS
        ============================================ */
        
        /* Button */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: 14px 32px;
            border: none;
            border-radius: var(--radius-md);
            font-family: var(--font-body);
            font-weight: 500;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: var(--terracotta);
            color: var(--cream);
            box-shadow: var(--shadow-md);
        }
        
        .btn-primary:hover {
            background: var(--terracotta-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: transparent;
            color: var(--ink);
            border: 1.5px solid rgba(61, 52, 40, 0.15);
        }
        
        .btn-ghost {
            background: transparent;
            color: var(--terracotta);
        }
        
        .btn-full {
            width: 100%;
        }
        
        /* Card */
        .card {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            box-shadow: var(--shadow-sm);
            position: relative;
        }
        
        .card-elevated {
            box-shadow: var(--shadow-lg);
        }
        
        /* Badge */
        .badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-primary {
            background: var(--terracotta);
            color: var(--cream);
        }
        
        .badge-success {
            background: var(--success);
            color: var(--ink);
        }
        
        /* ============================================
           SCREENS - ONBOARDING
        ============================================ */
        #onboarding-screen {
            text-align: center;
            justify-content: center;
        }
        
        .onboarding-logo {
            width: 120px;
            height: 120px;
            margin: 0 auto var(--space-xl);
            background: var(--terracotta);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            box-shadow: var(--shadow-lg);
        }
        
        .onboarding-title {
            margin-bottom: var(--space-md);
        }
        
        .onboarding-subtitle {
            font-size: 18px;
            margin-bottom: var(--space-2xl);
            max-width: 320px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* ============================================
           SCREENS - HOME
        ============================================ */
        #home-screen {
            justify-content: flex-start;
        }
        
        .header {
            margin-bottom: var(--space-xl);
        }
        
        .greeting {
            font-size: 32px;
            margin-bottom: var(--space-xs);
        }
        
        .subtitle {
            font-size: 16px;
        }
        
        .daily-quote-card {
            background: linear-gradient(135deg, rgba(201, 209, 188, 0.2), rgba(180, 199, 217, 0.2));
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            text-align: center;
            border-radius: var(--radius-lg);
        }
        
        .quote-icon {
            font-size: 32px;
            margin-bottom: var(--space-sm);
        }
        
        .quote-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(61, 52, 40, 0.5);
            margin-bottom: var(--space-md);
            font-weight: 600;
        }
        
        .quote-text {
            font-family: var(--font-display);
            font-size: 18px;
            line-height: 1.6;
            color: var(--ink);
            font-style: italic;
        }
        
        /* ============================================
           JOURNAL HERO CTA (MAIN FOCUS)
        ============================================ */
        .journal-hero-cta {
            background: linear-gradient(135deg, rgba(212, 165, 137, 0.15), rgba(201, 209, 188, 0.15));
            border-radius: var(--radius-lg);
            padding: var(--space-2xl);
            margin-bottom: var(--space-xl);
            box-shadow: 0 4px 20px rgba(61, 52, 40, 0.08);
            border: 2px solid rgba(212, 165, 137, 0.2);
        }
        
        .journal-hero-content {
            text-align: center;
        }
        
        .hero-icon-large {
            font-size: 64px;
            margin-bottom: var(--space-md);
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .hero-title {
            font-family: var(--font-display);
            font-size: 28px;
            color: var(--ink);
            margin-bottom: var(--space-sm);
        }
        
        .hero-description {
            font-size: 16px;
            line-height: 1.6;
            color: rgba(61, 52, 40, 0.7);
            margin-bottom: var(--space-xl);
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .btn-large {
            padding: var(--space-lg) var(--space-2xl);
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            box-shadow: 0 4px 12px rgba(212, 165, 137, 0.3);
        }
        
        .btn-large:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(212, 165, 137, 0.4);
        }
        
        .btn-icon {
            font-size: 22px;
        }
        
        .btn-arrow {
            font-size: 20px;
            transition: transform 0.2s ease;
        }
        
        .btn-large:hover .btn-arrow {
            transform: translateX(4px);
        }
        
        .quick-mood-selector {
            margin-top: var(--space-xl);
            padding-top: var(--space-lg);
            border-top: 1px solid rgba(61, 52, 40, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-md);
        }
        
        .mood-label {
            font-size: 14px;
            color: rgba(61, 52, 40, 0.6);
            font-weight: 500;
        }
        
        .mood-quick-buttons {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .mood-quick-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 2px solid rgba(61, 52, 40, 0.1);
            background: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mood-quick-btn:hover {
            transform: scale(1.1);
            border-color: var(--terracotta);
        }
        
        .mood-quick-btn.selected {
            border-color: var(--terracotta);
            border-width: 3px;
            box-shadow: 0 0 0 3px rgba(212, 165, 137, 0.2);
        }
        
        /* ============================================
           TODAY'S ENTRY PREVIEW
        ============================================ */
        .today-entry-card {
            background: rgba(244, 228, 193, 0.2);
            border: 2px solid rgba(244, 228, 193, 0.5);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-xl);
        }
        
        .entry-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
            font-weight: 600;
            color: var(--ink);
        }
        
        .entry-card-preview {
            font-family: var(--font-handwritten);
            font-size: 16px;
            line-height: 1.6;
            color: rgba(61, 52, 40, 0.8);
            margin-bottom: var(--space-md);
            max-height: 80px;
            overflow: hidden;
            position: relative;
        }
        
        .entry-card-preview::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: linear-gradient(transparent, rgba(244, 228, 193, 0.2));
        }
        
        .entry-card-actions {
            display: flex;
            justify-content: flex-end;
        }
        
        .btn-small {
            padding: var(--space-sm) var(--space-md);
            font-size: 14px;
        }
        
        /* ============================================
           SECTION HEADERS
        ============================================ */
        .section-header {
            margin: var(--space-xl) 0 var(--space-lg) 0;
        }
        
        .section-header h3 {
            font-family: var(--font-display);
            font-size: 20px;
            color: var(--ink);
            margin-bottom: var(--space-xs);
        }
        
        .section-header p {
            font-size: 14px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        /* ============================================
           COMPACT ENVELOPE (SECONDARY)
        ============================================ */
        .envelope-hero-card {
            background: linear-gradient(135deg, rgba(244, 228, 193, 0.3), rgba(232, 197, 192, 0.3));
            border-radius: var(--radius-lg);
            padding: var(--space-2xl);
            margin-bottom: var(--space-xl);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(244, 228, 193, 0.5);
            box-shadow: 0 4px 20px rgba(244, 228, 193, 0.3);
        }
        
        .envelope-hero-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(244, 228, 193, 0.5);
            border-color: var(--honey);
        }
        
        .envelope-hero-visual {
            font-size: 80px;
            margin-bottom: var(--space-md);
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .envelope-hero-title {
            font-family: var(--font-display);
            font-size: 24px;
            color: var(--ink);
            margin-bottom: var(--space-sm);
        }
        
        .envelope-hero-description {
            font-size: 15px;
            color: rgba(61, 52, 40, 0.7);
            margin-bottom: var(--space-xl);
            line-height: 1.6;
        }
        
        .envelope-card-compact {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-xl);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        .envelope-card-compact:hover {
            border-color: var(--terracotta);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .envelope-visual-small {
            font-size: 40px;
            flex-shrink: 0;
        }
        
        .envelope-content-small {
            flex: 1;
        }
        
        .envelope-title-small {
            font-family: var(--font-display);
            font-size: 18px;
            color: var(--ink);
            margin-bottom: 4px;
        }
        
        .envelope-description-small {
            font-size: 14px;
            color: rgba(61, 52, 40, 0.6);
            margin: 0;
        }
        
        .envelope-arrow {
            font-size: 24px;
            color: var(--terracotta);
            flex-shrink: 0;
            transition: transform 0.2s ease;
        }
        
        .envelope-card-compact:hover .envelope-arrow {
            transform: translateX(4px);
        }
        
        /* ============================================
           QUICK NAVIGATION
        ============================================ */
        .home-quick-nav {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }
        
        .quick-nav-item {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }
        
        .quick-nav-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .quick-nav-icon {
            font-size: 32px;
            margin-bottom: var(--space-sm);
        }
        
        .quick-nav-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--ink);
            margin-bottom: 4px;
        }
        
        .quick-nav-count {
            font-size: 12px;
            color: rgba(61, 52, 40, 0.5);
        }
        
        .envelope-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: var(--space-xl);
            margin: var(--space-xl) 0;
        }
        
        .envelope-card {
            text-align: center;
            width: 100%;
        }
        
        .envelope-visual {
            width: 200px;
            height: 250px;
            margin: 0 auto var(--space-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 120px;
            cursor: pointer;
            transition: transform 0.3s ease;
            position: relative;
        }
        
        .envelope-visual:hover {
            transform: scale(1.05);
        }
        
        .envelope-visual.shake {
            animation: shake 0.5s ease;
        }
        
        .envelope-title {
            font-size: 24px;
            margin-bottom: var(--space-sm);
        }
        
        .envelope-description {
            margin-bottom: var(--space-lg);
        }
        
        .countdown {
            font-family: var(--font-display);
            font-size: 20px;
            color: var(--terracotta);
            margin-top: var(--space-md);
        }
        
        .streak-badge {
            background: var(--honey);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-full);
            display: inline-block;
            margin: var(--space-lg) auto;
            font-weight: 500;
        }
        
        .quick-actions {
            display: flex;
            justify-content: space-around;
            margin-top: var(--space-xl);
            gap: var(--space-md);
        }
        
        .quick-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-xs);
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .quick-action:hover {
            transform: translateY(-3px);
        }
        
        .quick-action-icon {
            font-size: 32px;
        }
        
        .quick-action-text {
            font-size: 14px;
            color: rgba(61, 52, 40, 0.7);
        }
        
        /* ============================================
           SCREENS - ENVELOPE OPENING
        ============================================ */
        #envelope-opening-screen {
            justify-content: center;
            align-items: center;
            text-align: center;
            background: var(--cream);
        }
        
        .opening-title {
            margin-bottom: var(--space-lg);
        }
        
        .opening-envelope {
            width: 300px;
            height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 150px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: var(--space-xl) 0;
        }
        
        .opening-envelope:hover {
            transform: scale(1.1);
        }
        
        .opening-envelope.tearing {
            animation: tear 1.2s ease-out forwards;
        }
        
        @keyframes tear {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.2) rotate(5deg); opacity: 0.8; }
            100% { transform: scale(0.8) rotate(10deg); opacity: 0; }
        }
        
        .hint-text {
            font-size: 14px;
            color: rgba(61, 52, 40, 0.5);
        }
        
        /* Reveal Cards */
        .reveal-container {
            width: 100%;
        }
        
        .reveal-title {
            margin-bottom: var(--space-2xl);
        }
        
        .assets-grid {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
            margin-bottom: var(--space-2xl);
        }
        
        .asset-card {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            text-align: center;
            animation: slideUp 0.5s ease-out forwards;
            opacity: 0;
        }
        
        .asset-card:nth-child(1) { animation-delay: 0.1s; }
        .asset-card:nth-child(2) { animation-delay: 0.3s; }
        .asset-card:nth-child(3) { animation-delay: 0.5s; }
        
        .rarity-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: var(--radius-md);
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: var(--space-sm);
        }
        
        .rarity-common {
            background: var(--sage);
            color: var(--ink);
        }
        
        .rarity-rare {
            background: var(--lavender);
            color: var(--ink);
        }
        
        .rarity-legendary {
            background: var(--honey);
            color: var(--ink);
        }
        
        .asset-visual {
            width: 120px;
            height: 120px;
            margin: var(--space-md) auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
        }
        
        .asset-artist {
            font-size: 13px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        /* ============================================
           SCREENS - JOURNAL EDITOR
        ============================================ */
        #journal-editor-screen {
            padding: 0;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-lg);
            background: var(--cream);
            border-bottom: 1px solid rgba(61, 52, 40, 0.08);
        }
        
        .icon-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            transition: background 0.2s ease;
        }
        
        .icon-btn:hover {
            background: rgba(61, 52, 40, 0.05);
        }
        
        .editor-actions {
            display: flex;
            gap: var(--space-sm);
        }
        
        .editor-canvas-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: var(--space-lg);
            overflow-y: auto;
        }
        
        .formatting-toolbar {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: white;
            border-radius: var(--radius-md);
            margin-bottom: var(--space-md);
            box-shadow: var(--shadow-sm);
            overflow-x: auto;
        }
        
        .toolbar-section {
            display: flex;
            gap: var(--space-xs);
        }
        
        .toolbar-divider {
            width: 1px;
            height: 24px;
            background: rgba(61, 52, 40, 0.15);
        }
        
        .toolbar-btn {
            width: 36px;
            height: 36px;
            border: 1px solid rgba(61, 52, 40, 0.15);
            border-radius: var(--radius-sm);
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .toolbar-btn:hover {
            border-color: var(--terracotta);
            background: rgba(212, 165, 137, 0.05);
        }
        
        .toolbar-btn.active {
            background: var(--terracotta);
            color: white;
            border-color: var(--terracotta);
        }
        
        .toolbar-btn.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .toolbar-btn.locked:hover {
            border-color: rgba(61, 52, 40, 0.15);
            background: white;
        }
        
        .canvas-wrapper {
            background: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            margin-bottom: var(--space-lg);
            position: relative;
            overflow: hidden;
            flex: 1;
        }
        
        .canvas {
            min-height: 400px;
            padding: var(--space-lg);
            position: relative;
        }
        
        .canvas-background {
            position: absolute;
            inset: 0;
            opacity: 0.3;
            background-size: cover;
            background-position: center;
            pointer-events: none;
        }
        
        .canvas-textarea {
            width: 100%;
            min-height: 200px;
            border: none;
            outline: none;
            font-family: var(--font-handwritten);
            font-size: 18px;
            line-height: 1.8;
            color: var(--ink);
            background: transparent;
            resize: none;
            position: relative;
            z-index: 1;
        }
        
        .canvas-textarea::placeholder {
            color: rgba(61, 52, 40, 0.4);
        }
        
        .canvas-stickers {
            position: relative;
            z-index: 2;
            pointer-events: none;
        }
        
        .sticker {
            position: absolute;
            cursor: move;
            user-select: none;
            pointer-events: all;
            transition: transform 0.1s ease;
        }
        
        .sticker:hover {
            transform: scale(1.05);
        }
        
        .sticker.dragging {
            opacity: 0.7;
            z-index: 1000;
        }
        
        /* Asset Palette */
        .asset-palette {
            background: white;
            border-top: 1px solid rgba(61, 52, 40, 0.08);
            padding: var(--space-lg);
        }
        
        .palette-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }
        
        .palette-title {
            font-family: var(--font-display);
            font-size: 18px;
        }
        
        .palette-tabs {
            display: flex;
            gap: var(--space-xs);
            margin-bottom: var(--space-md);
            overflow-x: auto;
            padding-bottom: var(--space-xs);
        }
        
        .palette-tab {
            padding: 8px 12px;
            border: 1px solid rgba(61, 52, 40, 0.15);
            border-radius: var(--radius-md);
            background: white;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .palette-tab:hover {
            border-color: var(--terracotta);
            background: rgba(212, 165, 137, 0.05);
        }
        
        .palette-tab.active {
            background: var(--terracotta);
            color: var(--cream);
            border-color: var(--terracotta);
        }
        
        .palette-tab.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .palette-tab.locked:hover {
            border-color: rgba(61, 52, 40, 0.15);
            background: white;
        }
        
        .palette-collapsed .palette-grid,
        .palette-collapsed .palette-tabs {
            display: none;
        }
        
        .palette-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: var(--space-sm);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .palette-item {
            aspect-ratio: 1;
            border: 1px solid rgba(61, 52, 40, 0.1);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
            font-size: 32px;
        }
        
        .palette-item:hover {
            border-color: var(--terracotta);
            transform: scale(1.05);
            box-shadow: var(--shadow-sm);
        }
        
        /* ============================================
           SCREENS - COLLECTION
        ============================================ */
        #collection-screen {
            padding-top: var(--space-lg);
        }
        
        .collection-header {
            margin-bottom: var(--space-xl);
        }
        
        .collection-stats {
            display: flex;
            justify-content: space-between;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }
        
        .stat-card {
            flex: 1;
            text-align: center;
        }
        
        .stat-number {
            font-family: var(--font-display);
            font-size: 28px;
            color: var(--terracotta);
            display: block;
            margin-bottom: var(--space-xs);
        }
        
        .stat-label {
            font-size: 13px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        .collection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: var(--space-md);
            padding: 0 var(--space-lg) var(--space-lg);
        }
        
        /* ============================================
           COLLECTION FILTERS (2 LEVELS)
        ============================================ */
        .collection-filters-level1 {
            display: flex;
            gap: var(--space-md);
            padding: 0 var(--space-lg) var(--space-lg);
            overflow-x: auto;
        }
        
        .filter-btn-level1 {
            flex: 1;
            min-width: 100px;
            padding: var(--space-md);
            border-radius: var(--radius-lg);
            border: 2px solid rgba(61, 52, 40, 0.1);
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-xs);
        }
        
        .filter-btn-level1:hover {
            border-color: var(--terracotta);
            transform: translateY(-2px);
        }
        
        .filter-btn-level1.active {
            border-color: var(--terracotta);
            background: rgba(212, 165, 137, 0.1);
        }
        
        .filter-icon {
            font-size: 28px;
        }
        
        .filter-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--ink);
        }
        
        .collection-filters-level2 {
            display: flex;
            gap: var(--space-sm);
            padding: 0 var(--space-lg) var(--space-lg);
            overflow-x: auto;
        }
        
        .collection-filters-level2.hidden {
            display: none;
        }
        
        .filter-btn-level2 {
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-full);
            border: 1px solid rgba(61, 52, 40, 0.15);
            background: white;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
            color: var(--ink);
        }
        
        .filter-btn-level2:hover {
            border-color: var(--terracotta);
        }
        
        .filter-btn-level2.active {
            background: var(--terracotta);
            color: white;
            border-color: var(--terracotta);
        }
        
        /* ============================================
           ZEN JOURNAL EDITOR
        ============================================ */
        
        /* Minimal Header */
        .editor-header-minimal {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md) var(--space-lg);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(61, 52, 40, 0.08);
        }
        
        .icon-btn-minimal {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: rgba(61, 52, 40, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.2s ease;
        }
        
        .icon-btn-minimal:hover {
            background: rgba(61, 52, 40, 0.1);
            transform: scale(1.05);
        }
        
        .editor-date-badge {
            font-size: 13px;
            color: rgba(61, 52, 40, 0.6);
            font-weight: 500;
        }
        
        .editor-autosave {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: var(--sage);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .editor-autosave.show {
            opacity: 1;
        }
        
        .autosave-text {
            font-weight: 500;
        }
        
        /* Canvas Zen */
        .journal-canvas-zen {
            position: relative;
            flex: 1;
            overflow-y: auto;
            background: #FAFAF8;
            z-index: 1;
        }
        
        .canvas-background-zen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: white;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: all 0.3s ease;
            z-index: 1;
        }
        
        /* Writing Container */
        .writing-container-zen {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
            padding: var(--space-2xl) var(--space-lg);
            min-height: calc(100vh - 200px);
            z-index: 2;
        }
        
        .journal-textarea-zen {
            width: 100%;
            min-height: 400px;
            border: none;
            background: transparent;
            font-family: 'Caveat', cursive;
            font-size: 20px;
            line-height: 1.8;
            color: var(--ink);
            resize: none;
            outline: none;
            padding: 0;
            position: relative;
            z-index: 2;
        }
        
        .journal-textarea-zen::placeholder {
            color: rgba(61, 52, 40, 0.3);
            font-style: italic;
        }
        
        .word-count-zen {
            text-align: center;
            font-size: 12px;
            color: rgba(61, 52, 40, 0.4);
            margin-top: var(--space-lg);
        }
        
        /* Stickers Layer */
        .stickers-layer-zen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none; /* Let clicks pass through to textarea */
            z-index: 10;
        }
        
        .sticker-zen {
            position: absolute;
            cursor: move;
            pointer-events: auto; /* But stickers themselves are clickable */
            user-select: none;
            transition: transform 0.2s ease;
            z-index: 1;
        }
        
        .sticker-zen:hover {
            transform: scale(1.05);
        }
        
        .sticker-zen.selected {
            outline: 2px dashed var(--terracotta);
            outline-offset: 4px;
        }
        
        .sticker-zen-icon {
            font-size: 48px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        
        .sticker-zen-delete {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--alert);
            color: white;
            border: 2px solid white;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }
        
        .sticker-zen.selected .sticker-zen-delete {
            display: flex;
        }
        
        /* Floating Toolbar */
        .editor-toolbar-floating {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: var(--space-sm);
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            padding: var(--space-sm);
            border-radius: var(--radius-full);
            box-shadow: 0 8px 32px rgba(61, 52, 40, 0.15);
            transition: all 0.3s ease;
            z-index: 100;
        }
        
        .editor-toolbar-floating.hidden {
            transform: translateX(-50%) translateY(100px);
            opacity: 0;
        }
        
        .toolbar-btn-zen {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: var(--space-sm) var(--space-md);
            border: none;
            background: transparent;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 70px;
        }
        
        .toolbar-btn-zen:hover {
            background: rgba(212, 165, 137, 0.1);
            transform: translateY(-2px);
        }
        
        .toolbar-btn-primary-zen {
            background: var(--terracotta);
            color: white;
        }
        
        .toolbar-btn-primary-zen:hover {
            background: var(--ink);
            transform: translateY(-2px) scale(1.05);
        }
        
        .toolbar-icon-zen {
            font-size: 24px;
        }
        
        .toolbar-label-zen {
            font-size: 11px;
            font-weight: 600;
            color: var(--ink);
        }
        
        .toolbar-btn-primary-zen .toolbar-label-zen {
            color: white;
        }
        
        /* Bottom Sheet */
        .bottom-sheet-zen {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
            max-height: 70vh;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.32, 0.72, 0, 1);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        
        .modal-overlay.active .bottom-sheet-zen {
            transform: translateY(0);
        }
        
        .bottom-sheet-compact-zen {
            max-height: 50vh;
        }
        
        .bottom-sheet-handle {
            width: 40px;
            height: 4px;
            background: rgba(61, 52, 40, 0.2);
            border-radius: 2px;
            margin: var(--space-md) auto var(--space-sm);
        }
        
        .bottom-sheet-header-zen {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md) var(--space-xl);
            border-bottom: 1px solid rgba(61, 52, 40, 0.08);
        }
        
        .bottom-sheet-header-zen h3 {
            font-family: var(--font-display);
            font-size: 18px;
            margin: 0;
        }
        
        .modal-close-zen {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: rgba(61, 52, 40, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s ease;
        }
        
        .modal-close-zen:hover {
            background: rgba(61, 52, 40, 0.1);
            transform: scale(1.05);
        }
        
        .bottom-sheet-content-zen {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-xl);
        }
        
        /* Stickers Grid in Picker */
        .stickers-grid-zen {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: var(--space-md);
        }
        
        .sticker-picker-item {
            aspect-ratio: 1;
            border-radius: var(--radius-md);
            border: 2px solid rgba(61, 52, 40, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 40px;
            background: white;
        }
        
        .sticker-picker-item:hover {
            border-color: var(--terracotta);
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }
        
        .sticker-picker-item img {
            width: 70%;
            height: 70%;
            object-fit: contain;
        }
        
        /* Backgrounds Carousel */
        .backgrounds-carousel-zen {
            display: flex;
            gap: var(--space-lg);
            overflow-x: auto;
            padding-bottom: var(--space-md);
        }
        
        .background-option-zen {
            flex-shrink: 0;
            width: 120px;
            height: 160px;
            border-radius: var(--radius-lg);
            border: 3px solid rgba(61, 52, 40, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .background-option-zen:hover {
            transform: scale(1.05);
            border-color: var(--terracotta);
        }
        
        .background-option-zen.active {
            border-color: var(--terracotta);
            box-shadow: 0 0 0 3px rgba(212, 165, 137, 0.2);
        }
        
        .background-option-zen.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .background-option-zen.locked::after {
            content: 'ðŸ”’';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
        }
        
        /* Mood Picker Grid */
        .mood-picker-grid-zen {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
        }
        
        .mood-picker-btn-zen {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-xl) var(--space-md);
            border-radius: var(--radius-lg);
            border: 2px solid rgba(61, 52, 40, 0.1);
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .mood-picker-btn-zen:hover {
            border-color: var(--terracotta);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .mood-picker-emoji-zen {
            font-size: 40px;
        }
        
        .mood-picker-label-zen {
            font-size: 13px;
            font-weight: 600;
            color: var(--ink);
        }
        
        .collection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
        }
        
        .collection-item {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-md);
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: transform 0.2s ease;
            cursor: pointer;
        }
        
        .collection-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }
        
        .collection-item-icon {
            font-size: 48px;
            margin-bottom: var(--space-xs);
        }
        
        .collection-item-name {
            font-size: 12px;
            color: rgba(61, 52, 40, 0.7);
        }
        
        /* Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            background: white;
            border-top: 1px solid rgba(61, 52, 40, 0.08);
            display: flex;
            justify-content: space-around;
            padding: var(--space-sm) 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            padding: var(--space-sm);
            color: rgba(61, 52, 40, 0.5);
            transition: color 0.2s ease;
            text-decoration: none;
        }
        
        .nav-item:hover,
        .nav-item.active {
            color: var(--terracotta);
        }
        
        .nav-icon {
            font-size: 24px;
        }
        
        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: var(--space-lg);
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: var(--cream);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            max-width: 400px;
            width: 100%;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
        }
        
        .modal-title {
            font-size: 24px;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(61, 52, 40, 0.1);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .modal-body {
            margin-bottom: var(--space-lg);
        }
        
        /* Mood Picker */
        .mood-colors {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }
        
        .mood-color {
            aspect-ratio: 1;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }
        
        .mood-color:hover {
            transform: scale(1.1);
        }
        
        .mood-color.selected {
            border-color: var(--ink);
            box-shadow: var(--shadow-md);
        }
        
        /* Premium Badge */
        .premium-badge {
            background: linear-gradient(135deg, var(--honey), var(--terracotta));
            color: var(--ink);
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
            margin-left: var(--space-sm);
        }
        
        /* Loading */
        .loading {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(245, 241, 232, 0.95);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: var(--space-lg);
        }
        
        .loading.active {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(61, 52, 40, 0.1);
            border-top-color: var(--terracotta);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 430px) {
            .container {
                box-shadow: none;
            }
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--ink);
            color: var(--cream);
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 9998;
            animation: slideUp 0.3s ease;
            max-width: 90%;
            text-align: center;
        }
        
        /* ============================================
           JOURNAL HISTORY
        ============================================ */
        .journal-entries-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }
        
        .journal-entry-card {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
        }
        
        .journal-entry-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-sm);
        }
        
        .entry-date {
            font-family: var(--font-display);
            font-size: 16px;
            color: var(--ink);
        }
        
        .entry-mood-indicator {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid rgba(61, 52, 40, 0.1);
        }
        
        .entry-preview {
            font-family: var(--font-handwritten);
            font-size: 15px;
            line-height: 1.6;
            color: rgba(61, 52, 40, 0.7);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .entry-preview.blurred {
            filter: blur(4px);
            user-select: none;
        }
        
        .entry-stats {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-sm);
            font-size: 12px;
            color: rgba(61, 52, 40, 0.5);
        }
        
        /* ============================================
           PIXEL YEAR
        ============================================ */
        .pixel-year-grid {
            display: grid;
            grid-template-columns: repeat(52, 1fr);
            gap: 3px;
            padding: var(--space-md);
            background: white;
            border-radius: var(--radius-md);
            overflow-x: auto;
        }
        
        .pixel {
            aspect-ratio: 1;
            min-width: 6px;
            border-radius: 2px;
            background: var(--neutral);
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .pixel:hover {
            transform: scale(1.3);
        }
        
        .pixel.filled {
            box-shadow: 0 0 4px rgba(0,0,0,0.1);
        }
        
        .mood-legend {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 14px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            box-shadow: var(--shadow-sm);
        }
        
        /* ============================================
           SETTINGS
        ============================================ */
        .settings-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
            margin-bottom: var(--space-lg);
        }
        
        .setting-item {
            background: white;
            padding: var(--space-lg);
            border-radius: var(--radius-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            gap: var(--space-md);
        }
        
        .setting-label {
            font-weight: 500;
            font-size: 15px;
            color: var(--ink);
            margin-bottom: 4px;
        }
        
        .setting-description {
            font-size: 13px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 28px;
            flex-shrink: 0;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: rgba(61, 52, 40, 0.2);
            border-radius: var(--radius-full);
            transition: 0.3s;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
            box-shadow: var(--shadow-sm);
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background: var(--terracotta);
        }
        
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        
        .link-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md) 0;
            border-bottom: 1px solid rgba(61, 52, 40, 0.08);
            cursor: pointer;
            font-size: 15px;
            transition: color 0.2s ease;
        }
        
        .link-item:last-child {
            border-bottom: none;
        }
        
        .link-item:hover {
            color: var(--terracotta);
        }
        
        /* ============================================
           PAYWALL
        ============================================ */
        .paywall-modal {
            max-width: 500px;
        }
        
        .paywall-header {
            text-align: center;
            margin-bottom: var(--space-xl);
        }
        
        .paywall-icon {
            font-size: 60px;
            margin-bottom: var(--space-md);
        }
        
        .paywall-features {
            margin-bottom: var(--space-xl);
        }
        
        .feature-row {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md) 0;
            border-bottom: 1px solid rgba(61, 52, 40, 0.08);
        }
        
        .feature-row:last-child {
            border-bottom: none;
        }
        
        .feature-icon {
            width: 40px;
            height: 40px;
            background: var(--honey);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .feature-text {
            flex: 1;
        }
        
        .feature-title {
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .feature-description {
            font-size: 13px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        .price-card {
            background: white;
            border: 2px solid var(--terracotta);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            text-align: center;
            margin-bottom: var(--space-lg);
        }
        
        .price-amount {
            font-family: var(--font-display);
            font-size: 48px;
            color: var(--terracotta);
            margin-bottom: var(--space-xs);
        }
        
        .price-period {
            font-size: 16px;
            color: rgba(61, 52, 40, 0.7);
            margin-bottom: var(--space-md);
        }
        
        .price-description {
            font-size: 13px;
            color: rgba(61, 52, 40, 0.5);
        }
        
        /* ============================================
           AMBIANCE PICKER
        ============================================ */
        .ambiance-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .ambiance-card {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .ambiance-card:hover {
            border-color: var(--terracotta);
            transform: translateY(-2px);
        }
        
        .ambiance-card.active {
            border-color: var(--terracotta);
            background: rgba(212, 165, 137, 0.05);
        }
        
        .ambiance-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .ambiance-icon {
            font-size: 40px;
            margin-bottom: var(--space-sm);
        }
        
        .ambiance-name {
            font-weight: 500;
            font-size: 15px;
            margin-bottom: 4px;
        }
        
        /* ============================================
           ARTIST DETAIL MODAL
        ============================================ */
        .artist-modal {
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .artist-detail-content {
            text-align: center;
        }
        
        .artist-avatar {
            width: 100px;
            height: 100px;
            background: var(--terracotta);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            margin: 0 auto var(--space-lg);
            box-shadow: var(--shadow-md);
        }
        
        .artist-name {
            font-family: var(--font-display);
            font-size: 28px;
            margin-bottom: var(--space-sm);
        }
        
        .artist-location {
            font-size: 14px;
            color: rgba(61, 52, 40, 0.6);
            margin-bottom: var(--space-lg);
        }
        
        .artist-bio {
            font-size: 15px;
            line-height: 1.7;
            color: rgba(61, 52, 40, 0.8);
            margin-bottom: var(--space-xl);
            text-align: left;
            padding: 0 var(--space-md);
        }
        
        .artist-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: var(--space-xl);
            padding: var(--space-lg) 0;
            border-top: 1px solid rgba(61, 52, 40, 0.08);
            border-bottom: 1px solid rgba(61, 52, 40, 0.08);
        }
        
        .artist-stat {
            text-align: center;
        }
        
        .artist-stat-number {
            font-family: var(--font-display);
            font-size: 24px;
            color: var(--terracotta);
            display: block;
            margin-bottom: 4px;
        }
        
        .artist-stat-label {
            font-size: 13px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        .artist-assets-section {
            text-align: left;
            margin-bottom: var(--space-lg);
        }
        
        .artist-assets-title {
            font-family: var(--font-display);
            font-size: 18px;
            margin-bottom: var(--space-md);
            padding: 0 var(--space-md);
        }
        
        .artist-assets-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-sm);
            padding: 0 var(--space-md);
        }
        
        .artist-asset-item {
            aspect-ratio: 1;
            background: white;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            border: 1px solid rgba(61, 52, 40, 0.1);
        }
        
        .artist-social-links {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            margin-top: var(--space-xl);
        }
        
        .social-link {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(212, 165, 137, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .social-link:hover {
            background: var(--terracotta);
            transform: scale(1.1);
        }
        
        /* ============================================
           ASSET DETAIL MODAL
        ============================================ */
        .asset-detail-content {
            text-align: center;
        }
        
        .asset-detail-visual {
            width: 150px;
            height: 150px;
            margin: 0 auto var(--space-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 100px;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }
        
        .asset-detail-name {
            font-family: var(--font-display);
            font-size: 24px;
            margin-bottom: var(--space-sm);
        }
        
        .asset-detail-artist {
            font-size: 15px;
            color: rgba(61, 52, 40, 0.6);
            margin-bottom: var(--space-md);
            cursor: pointer;
            text-decoration: underline;
        }
        
        .asset-detail-artist:hover {
            color: var(--terracotta);
        }
        
        .asset-detail-tags {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: var(--space-xl);
        }
        
        .asset-tag {
            padding: 6px 12px;
            background: rgba(212, 165, 137, 0.1);
            border-radius: var(--radius-full);
            font-size: 12px;
            color: var(--ink);
        }
        
        .asset-usage-stats {
            background: rgba(212, 165, 137, 0.05);
            padding: var(--space-lg);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-lg);
        }
        
        .usage-stat-item {
            display: flex;
            justify-content: space-between;
            padding: var(--space-sm) 0;
            font-size: 14px;
        }
        
        .usage-stat-label {
            color: rgba(61, 52, 40, 0.7);
        }
        
        .usage-stat-value {
            font-weight: 500;
            color: var(--ink);
        }
        
        /* ============================================
           JOURNAL VIEWER MODAL
        ============================================ */
        .journal-viewer-modal {
            max-width: 600px;
            max-height: 90vh;
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-lg);
            border-bottom: 1px solid rgba(61, 52, 40, 0.08);
        }
        
        .viewer-actions {
            display: flex;
            gap: var(--space-sm);
        }
        
        .viewer-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-xl);
        }
        
        .viewer-page {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-xl);
            box-shadow: var(--shadow-md);
            min-height: 400px;
            position: relative;
        }
        
        .viewer-date {
            font-family: var(--font-display);
            font-size: 20px;
            color: var(--ink);
            margin-bottom: var(--space-md);
        }
        
        .viewer-mood {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: 6px 12px;
            border-radius: var(--radius-full);
            font-size: 13px;
            margin-bottom: var(--space-lg);
        }
        
        .viewer-text {
            font-family: var(--font-handwritten);
            font-size: 18px;
            line-height: 1.8;
            color: var(--ink);
            white-space: pre-wrap;
            margin-bottom: var(--space-lg);
        }
        
        .viewer-text.hidden {
            filter: blur(8px);
            user-select: none;
        }
        
        .viewer-stickers {
            position: absolute;
            inset: 0;
            pointer-events: none;
        }
        
        .viewer-sticker {
            position: absolute;
            font-size: 40px;
        }
        
        .viewer-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-lg);
            border-top: 1px solid rgba(61, 52, 40, 0.08);
        }
        
        .nav-arrow {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 1px solid rgba(61, 52, 40, 0.15);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.2s ease;
        }
        
        .nav-arrow:hover {
            border-color: var(--terracotta);
            background: rgba(212, 165, 137, 0.05);
        }
        
        .nav-arrow:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .page-indicator {
            font-size: 14px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        /* ============================================
           SHARE MODAL
        ============================================ */
        .share-preview {
            background: var(--neutral);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .share-preview-canvas {
            background: white;
            border-radius: var(--radius-sm);
            padding: var(--space-lg);
            max-width: 100%;
            box-shadow: var(--shadow-md);
        }
        
        .share-options {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }
        
        .share-option {
            padding-bottom: var(--space-md);
            border-bottom: 1px solid rgba(61, 52, 40, 0.08);
        }
        
        .share-option:last-child {
            border-bottom: none;
        }
        
        .share-label {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 4px;
        }
        
        .share-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .share-description {
            font-size: 13px;
            color: rgba(61, 52, 40, 0.6);
            margin-left: 28px;
        }
        
        /* ============================================
           ONBOARDING IMPROVEMENTS
        ============================================ */
        .onboarding-step {
            text-align: center;
            justify-content: center;
            padding: var(--space-xl);
        }
        
        .onboarding-step.hidden {
            display: none;
        }
        
        .onboarding-progress {
            margin-bottom: var(--space-2xl);
        }
        
        .progress-bar {
            height: 4px;
            background: rgba(61, 52, 40, 0.1);
            border-radius: var(--radius-full);
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--terracotta);
            transition: width 0.3s ease;
        }
        
        .onboarding-choices {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            margin: var(--space-2xl) 0;
        }
        
        .choice-card {
            background: white;
            border: 2px solid rgba(61, 52, 40, 0.1);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }
        
        .choice-card:hover {
            border-color: var(--terracotta);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .choice-card.selected {
            border-color: var(--terracotta);
            background: rgba(212, 165, 137, 0.05);
        }
        
        .choice-icon {
            font-size: 32px;
            margin-bottom: var(--space-sm);
        }
        
        .choice-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
            color: var(--ink);
        }
        
        .choice-description {
            font-size: 14px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        .time-picker-container {
            margin: var(--space-2xl) 0;
        }
        
        .time-picker {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-sm);
            font-size: 48px;
            font-family: var(--font-display);
        }
        
        .time-select {
            font-size: 48px;
            font-family: var(--font-display);
            border: 2px solid rgba(61, 52, 40, 0.15);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            background: white;
            cursor: pointer;
        }
        
        .time-separator {
            color: var(--terracotta);
        }
        
        .onboarding-input {
            width: 100%;
            max-width: 300px;
            padding: var(--space-md) var(--space-lg);
            border: 2px solid rgba(61, 52, 40, 0.15);
            border-radius: var(--radius-md);
            font-size: 18px;
            font-family: var(--font-body);
            text-align: center;
            transition: all 0.2s ease;
            background: white;
        }
        
        .onboarding-input:focus {
            outline: none;
            border-color: var(--terracotta);
            box-shadow: 0 0 0 4px rgba(212, 165, 137, 0.1);
        }
        
        .onboarding-input::placeholder {
            color: rgba(61, 52, 40, 0.4);
        }
        
        /* ============================================
           WELLNESS DASHBOARD
        ============================================ */
        .wellness-summary {
            background: linear-gradient(135deg, rgba(201, 209, 188, 0.3), rgba(209, 201, 217, 0.3));
        }
        
        .wellness-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
        }
        
        .wellness-stat {
            text-align: center;
        }
        
        .wellness-stat-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 0 auto var(--space-sm);
        }
        
        .wellness-stat-value {
            font-family: var(--font-display);
            font-size: 24px;
            color: var(--ink);
            margin-bottom: 4px;
        }
        
        .wellness-stat-label {
            font-size: 12px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        .mood-distribution {
            display: flex;
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
        }
        
        .mood-bar {
            flex: 1;
            height: 120px;
            border-radius: var(--radius-sm);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            padding: var(--space-sm);
            font-size: 20px;
            position: relative;
        }
        
        .mood-bar-fill {
            width: 100%;
            border-radius: var(--radius-sm);
            transition: height 0.3s ease;
        }
        
        .mood-bar-label {
            position: absolute;
            bottom: var(--space-xs);
            font-size: 11px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        .insights-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }
        
        .insight-item {
            display: flex;
            gap: var(--space-md);
            padding: var(--space-md);
            background: rgba(212, 165, 137, 0.05);
            border-radius: var(--radius-md);
        }
        
        .insight-icon {
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .insight-text {
            font-size: 14px;
            line-height: 1.6;
            color: rgba(61, 52, 40, 0.8);
        }
        
        .progress-item {
            margin-bottom: var(--space-md);
        }
        
        .prompts-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .prompt-item {
            background: white;
            border: 1px solid rgba(61, 52, 40, 0.1);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            font-family: var(--font-handwritten);
            font-size: 16px;
            line-height: 1.6;
            color: var(--ink);
        }
        
        .prompt-item:hover {
            border-color: var(--terracotta);
            background: rgba(212, 165, 137, 0.05);
            transform: translateX(4px);
        }
        
        /* ============================================
           COMMUNITY FEED
        ============================================ */
        .feed-header {
            padding: var(--space-xl) var(--space-lg) var(--space-md);
        }
        
        .feed-header h1 {
            font-family: var(--font-display);
            font-size: 32px;
            margin-bottom: var(--space-xs);
        }
        
        .feed-subtitle {
            font-size: 16px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        .feed-filters {
            display: flex;
            gap: var(--space-sm);
            padding: 0 var(--space-lg) var(--space-lg);
            overflow-x: auto;
        }
        
        .feed-filter-btn {
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-full);
            border: 1px solid rgba(61, 52, 40, 0.15);
            background: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
        }
        
        .feed-filter-btn:hover {
            border-color: var(--terracotta);
        }
        
        .feed-filter-btn.active {
            background: var(--terracotta);
            color: white;
            border-color: var(--terracotta);
        }
        
        .feed-content {
            padding: 0 var(--space-lg) var(--space-lg);
        }
        
        .feed-post {
            background: white;
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }
        
        .post-header {
            padding: var(--space-md) var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--terracotta);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .post-user-info {
            flex: 1;
        }
        
        .post-username {
            font-weight: 600;
            font-size: 15px;
            color: var(--ink);
        }
        
        .post-time {
            font-size: 13px;
            color: rgba(61, 52, 40, 0.5);
        }
        
        .post-follow-btn {
            padding: 6px 16px;
            border-radius: var(--radius-full);
            border: 1px solid var(--terracotta);
            background: white;
            color: var(--terracotta);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .post-follow-btn:hover {
            background: var(--terracotta);
            color: white;
        }
        
        .post-follow-btn.following {
            background: var(--terracotta);
            color: white;
        }
        
        .post-image {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            background: var(--neutral);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .post-mood-badge {
            position: absolute;
            top: var(--space-md);
            left: var(--space-md);
            padding: 6px 12px;
            border-radius: var(--radius-full);
            background: rgba(255, 255, 255, 0.95);
            font-size: 13px;
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }
        
        .post-reactions {
            padding: var(--space-md) var(--space-lg);
            border-top: 1px solid rgba(61, 52, 40, 0.08);
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }
        
        .reaction-btn {
            padding: 8px 16px;
            border-radius: var(--radius-full);
            border: 1px solid rgba(61, 52, 40, 0.15);
            background: white;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .reaction-btn:hover {
            border-color: var(--terracotta);
            background: rgba(212, 165, 137, 0.05);
            transform: scale(1.05);
        }
        
        .reaction-btn.reacted {
            border-color: var(--terracotta);
            background: rgba(212, 165, 137, 0.1);
        }
        
        .reaction-emoji {
            font-size: 16px;
        }
        
        .reaction-count {
            font-size: 13px;
            font-weight: 600;
            color: var(--ink);
        }
        
        .post-caption {
            padding: 0 var(--space-lg) var(--space-md);
            font-size: 14px;
            line-height: 1.6;
            color: rgba(61, 52, 40, 0.8);
        }
        
        /* ============================================
           CELEBRATION MODAL
        ============================================ */
        .celebration-modal {
            text-align: center;
            max-width: 400px;
        }
        
        .celebration-confetti {
            font-size: 32px;
            margin-bottom: var(--space-md);
            letter-spacing: 12px;
            animation: confetti 2s ease-in-out;
        }
        
        @keyframes confetti {
            0% { transform: translateY(-20px); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .celebration-icon {
            font-size: 80px;
            margin-bottom: var(--space-md);
        }
        
        .celebration-title {
            font-family: var(--font-display);
            font-size: 32px;
            color: var(--ink);
            margin-bottom: var(--space-sm);
        }
        
        .celebration-message {
            font-size: 16px;
            line-height: 1.6;
            color: rgba(61, 52, 40, 0.7);
            margin-bottom: var(--space-xl);
        }
        
        .celebration-stats {
            display: flex;
            justify-content: center;
            gap: var(--space-2xl);
            margin-bottom: var(--space-xl);
            padding: var(--space-lg) 0;
            border-top: 1px solid rgba(61, 52, 40, 0.08);
            border-bottom: 1px solid rgba(61, 52, 40, 0.08);
        }
        
        .celebration-stat {
            text-align: center;
        }
        
        .celebration-stat .stat-value {
            font-family: var(--font-display);
            font-size: 36px;
            color: var(--terracotta);
            display: block;
            margin-bottom: 4px;
        }
        
        .celebration-stat .stat-label {
            font-size: 13px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        .celebration-actions {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }
        
        .celebration-share-prompt {
            font-size: 14px;
            color: rgba(61, 52, 40, 0.6);
            line-height: 1.6;
        }
        
        .btn-link {
            background: none;
            border: none;
            color: var(--terracotta);
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            text-decoration: underline;
        }
        
        .btn-link:hover {
            color: var(--ink);
        }
        
        /* ============================================
           PROFILE SCREEN
        ============================================ */
        .profile-header {
            text-align: center;
            padding: var(--space-2xl) var(--space-lg) var(--space-lg);
            background: linear-gradient(180deg, rgba(212, 165, 137, 0.1), transparent);
        }
        
        .profile-avatar-large {
            position: relative;
            display: inline-block;
            margin-bottom: var(--space-md);
        }
        
        .avatar-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--terracotta);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            box-shadow: 0 4px 12px rgba(212, 165, 137, 0.3);
        }
        
        .level-badge {
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--honey), var(--terracotta));
            color: white;
            padding: 4px 16px;
            border-radius: var(--radius-full);
            font-size: 13px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            white-space: nowrap;
        }
        
        .profile-name {
            font-family: var(--font-display);
            font-size: 28px;
            color: var(--ink);
            margin-bottom: 4px;
        }
        
        .profile-subtitle {
            font-size: 14px;
            color: rgba(61, 52, 40, 0.6);
            font-style: italic;
        }
        
        /* ============================================
           HARMONIE CARD
        ============================================ */
        .harmonie-card {
            margin: var(--space-lg);
            padding: var(--space-xl);
            background: linear-gradient(135deg, rgba(201, 209, 188, 0.2), rgba(244, 228, 193, 0.2));
        }
        
        .harmonie-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-lg);
        }
        
        .harmonie-icon {
            font-size: 40px;
        }
        
        .level-progress {
            margin-bottom: var(--space-md);
        }
        
        .level-progress-bar {
            height: 12px;
            background: rgba(61, 52, 40, 0.1);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-bottom: var(--space-sm);
        }
        
        .level-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--terracotta), var(--honey));
            border-radius: var(--radius-full);
            transition: width 0.6s ease;
        }
        
        .level-progress-text {
            text-align: center;
            font-size: 13px;
            color: rgba(61, 52, 40, 0.7);
            font-weight: 500;
        }
        
        .level-info {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: rgba(61, 52, 40, 0.6);
            padding-top: var(--space-sm);
            border-top: 1px solid rgba(61, 52, 40, 0.08);
        }
        
        /* ============================================
           INTENTIONS
        ============================================ */
        .intentions-section {
            padding: 0 var(--space-lg) var(--space-lg);
        }
        
        .section-title {
            font-family: var(--font-display);
            font-size: 20px;
            color: var(--ink);
            margin-bottom: var(--space-xs);
        }
        
        .section-description {
            font-size: 14px;
            color: rgba(61, 52, 40, 0.6);
            margin-bottom: var(--space-lg);
        }
        
        .intentions-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }
        
        .intention-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            box-shadow: var(--shadow-sm);
            position: relative;
            transition: all 0.2s ease;
        }
        
        .intention-card.completed {
            background: rgba(201, 209, 188, 0.2);
            border: 2px solid var(--sage);
        }
        
        .intention-card.completed .intention-check {
            opacity: 1;
        }
        
        .intention-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(212, 165, 137, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .intention-content {
            flex: 1;
        }
        
        .intention-title {
            font-weight: 600;
            font-size: 15px;
            color: var(--ink);
            margin-bottom: 2px;
        }
        
        .intention-description {
            font-size: 13px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        .intention-progress {
            font-size: 12px;
            color: var(--terracotta);
            font-weight: 600;
            margin-top: 4px;
        }
        
        .intention-reward {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-shrink: 0;
        }
        
        .reward-value {
            font-weight: 700;
            font-size: 16px;
            color: var(--terracotta);
        }
        
        .reward-icon {
            font-size: 18px;
        }
        
        .intention-check {
            position: absolute;
            top: var(--space-sm);
            right: var(--space-sm);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--sage);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        /* ============================================
           PROFILE STATS GRID
        ============================================ */
        .profile-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            padding: 0 var(--space-lg) var(--space-lg);
        }
        
        .profile-stat-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            text-align: center;
            box-shadow: var(--shadow-sm);
        }
        
        .profile-stat-card .stat-icon {
            font-size: 32px;
            margin-bottom: var(--space-sm);
        }
        
        .profile-stat-card .stat-value {
            font-family: var(--font-display);
            font-size: 24px;
            color: var(--terracotta);
            display: block;
            margin-bottom: 4px;
        }
        
        .profile-stat-card .stat-label {
            font-size: 12px;
            color: rgba(61, 52, 40, 0.6);
        }
        
        /* ============================================
           SETTINGS SECTION IN PROFILE
        ============================================ */
        .settings-section {
            padding: 0 var(--space-lg) var(--space-lg);
        }
        
        /* ============================================
           LEVEL UP MODAL
        ============================================ */
        .levelup-modal {
            text-align: center;
            max-width: 400px;
        }
        
        .levelup-rays {
            font-size: 28px;
            margin-bottom: var(--space-md);
            letter-spacing: 8px;
            animation: rays 2s ease-in-out infinite;
        }
        
        @keyframes rays {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        .levelup-icon {
            font-size: 80px;
            margin-bottom: var(--space-md);
            animation: bloom 1s ease-out;
        }
        
        @keyframes bloom {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .levelup-title {
            font-family: var(--font-display);
            font-size: 36px;
            color: var(--ink);
            margin-bottom: var(--space-sm);
        }
        
        .levelup-message {
            font-size: 16px;
            color: rgba(61, 52, 40, 0.7);
            margin-bottom: var(--space-xl);
            font-style: italic;
        }
        
        .levelup-reward {
            background: linear-gradient(135deg, rgba(244, 228, 193, 0.3), rgba(212, 165, 137, 0.3));
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
        }
        
        .reward-envelope {
            font-size: 64px;
            margin-bottom: var(--space-md);
        }
        
        .reward-text {
            font-size: 16px;
            font-weight: 600;
            color: var(--ink);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ============================================
             ONBOARDING SCREEN - WELLNESS FOCUSED
        ============================================ -->
        <div id="onboarding-screen" class="screen active">
            <!-- Step 1: Welcome -->
            <div class="onboarding-step" id="onboarding-step-1">
                <div class="onboarding-logo">ðŸŒ¸</div>
                <h1 class="onboarding-title">Bienvenue sur YORI</h1>
                <p class="onboarding-subtitle">Ton refuge crÃ©atif oÃ¹ chaque jour apporte une nouvelle surprise</p>
                
                <div style="margin: var(--space-2xl) 0;">
                    <input 
                        type="text" 
                        id="onboarding-name" 
                        placeholder="Comment t'appelles-tu ?"
                        class="onboarding-input"
                        maxlength="20"
                    >
                </div>
                
                <button class="btn btn-primary btn-full" onclick="app.nextOnboardingStep()" id="onboarding-start-btn">
                    Commencer
                </button>
            </div>

            <!-- Step 2: Purpose -->
            <div class="onboarding-step hidden" id="onboarding-step-2">
                <div class="onboarding-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 33%;"></div>
                    </div>
                </div>
                
                <h2 class="onboarding-title">Pourquoi Ã©cris-tu ?</h2>
                <p class="onboarding-subtitle">Cela nous aidera Ã  personnaliser ton expÃ©rience</p>
                
                <div class="onboarding-choices">
                    <div class="choice-card" onclick="app.selectOnboardingChoice('purpose', 'stress')">
                        <div class="choice-icon">ðŸ§˜</div>
                        <div class="choice-title">GÃ©rer mon stress</div>
                        <div class="choice-description">Trouver du calme au quotidien</div>
                    </div>
                    <div class="choice-card" onclick="app.selectOnboardingChoice('purpose', 'emotions')">
                        <div class="choice-icon">ðŸ’­</div>
                        <div class="choice-title">Comprendre mes Ã©motions</div>
                        <div class="choice-description">Mettre des mots sur ce que je ressens</div>
                    </div>
                    <div class="choice-card" onclick="app.selectOnboardingChoice('purpose', 'memory')">
                        <div class="choice-icon">ðŸ“–</div>
                        <div class="choice-title">Garder mes souvenirs</div>
                        <div class="choice-description">CrÃ©er mon journal personnel</div>
                    </div>
                    <div class="choice-card" onclick="app.selectOnboardingChoice('purpose', 'creativity')">
                        <div class="choice-icon">ðŸŽ¨</div>
                        <div class="choice-title">Exprimer ma crÃ©ativitÃ©</div>
                        <div class="choice-description">CrÃ©er de belles pages</div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Frequency -->
            <div class="onboarding-step hidden" id="onboarding-step-3">
                <div class="onboarding-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 66%;"></div>
                    </div>
                </div>
                
                <h2 class="onboarding-title">Ã€ quelle frÃ©quence souhaites-tu Ã©crire ?</h2>
                <p class="onboarding-subtitle">Nous t'enverrons des rappels bienveillants</p>
                
                <div class="onboarding-choices">
                    <div class="choice-card" onclick="app.selectOnboardingChoice('frequency', 'daily')">
                        <div class="choice-icon">â˜€ï¸</div>
                        <div class="choice-title">Chaque jour</div>
                        <div class="choice-description">Un rituel quotidien</div>
                    </div>
                    <div class="choice-card" onclick="app.selectOnboardingChoice('frequency', 'often')">
                        <div class="choice-icon">ðŸŒ™</div>
                        <div class="choice-title">Plusieurs fois par semaine</div>
                        <div class="choice-description">RÃ©guliÃ¨rement, sans pression</div>
                    </div>
                    <div class="choice-card" onclick="app.selectOnboardingChoice('frequency', 'sometimes')">
                        <div class="choice-icon">â­</div>
                        <div class="choice-title">Quand j'en ressens le besoin</div>
                        <div class="choice-description">Ã€ mon rythme</div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Reminder Time -->
            <div class="onboarding-step hidden" id="onboarding-step-4">
                <div class="onboarding-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%;"></div>
                    </div>
                </div>
                
                <h2 class="onboarding-title">Quand veux-tu qu'on te rappelle ?</h2>
                <p class="onboarding-subtitle">Tu pourras changer cela plus tard</p>
                
                <div class="time-picker-container">
                    <div class="time-picker">
                        <select id="reminder-hour" class="time-select">
                            <option value="07">07</option>
                            <option value="08">08</option>
                            <option value="09" selected>09</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                        </select>
                        <span class="time-separator">:</span>
                        <select id="reminder-minute" class="time-select">
                            <option value="00" selected>00</option>
                            <option value="15">15</option>
                            <option value="30">30</option>
                            <option value="45">45</option>
                        </select>
                    </div>
                    
                    <p style="text-align: center; color: rgba(61, 52, 40, 0.6); margin-top: var(--space-lg); font-size: 14px;">
                        ðŸ’Œ Nous t'enverrons une notification douce chaque jour
                    </p>
                </div>
                
                <button class="btn btn-primary btn-full" onclick="app.completeOnboarding()">
                    C'est parti !
                </button>
                
                <button class="btn btn-ghost btn-full" onclick="app.skipReminder()">
                    Passer cette Ã©tape
                </button>
            </div>
        </div>

        <!-- ============================================
             HOME SCREEN - JOURNALING FIRST
        ============================================ -->
        <div id="home-screen" class="screen">
            <div class="header">
                <h1 class="greeting">Bonjour <span id="user-name-display">Marie</span> ðŸŒ¸</h1>
                <p class="subtitle">Comment vas-tu aujourd'hui ?</p>
            </div>

            <!-- Daily Quote/Wellness Message -->
            <div class="daily-quote-card card-elevated">
                <div class="quote-icon">ðŸ’­</div>
                <div class="quote-label">Ta phrase du jour</div>
                <div class="quote-text" id="daily-quote">
                    <!-- Will be populated -->
                </div>
            </div>

            <!-- Envelope Hero (shown only when available and not opened) -->
            <div class="envelope-hero-card hidden" id="envelope-hero" onclick="app.openEnvelope()">
                <div class="envelope-hero-visual">ðŸ’Œ</div>
                <h2 class="envelope-hero-title">Ta surprise quotidienne t'attend !</h2>
                <p class="envelope-hero-description" id="envelope-hero-desc">
                    Un nouveau trÃ©sor pour embellir tes pages
                </p>
                <button class="btn btn-primary btn-large" onclick="app.openEnvelope(); event.stopPropagation();">
                    <span class="btn-icon">ðŸ’«</span>
                    Ouvrir mon enveloppe
                    <span class="btn-arrow">â†’</span>
                </button>
            </div>

            <!-- HERO: WRITE YOUR JOURNAL - MAIN CTA -->
            <div class="journal-hero-cta">
                <div class="journal-hero-content">
                    <div class="hero-icon-large">âœï¸</div>
                    <h2 class="hero-title">Ã‰cris ta page du jour</h2>
                    <p class="hero-description">
                        Prends un moment pour toi. Exprime ce que tu ressens, 
                        ce que tu vis, ce dont tu rÃªves.
                    </p>
                    <button class="btn btn-primary btn-large btn-full" onclick="app.navigateTo('journal-editor')">
                        <span class="btn-icon">âœ¨</span>
                        Commencer Ã  Ã©crire
                        <span class="btn-arrow">â†’</span>
                    </button>
                    
                    <!-- Quick mood selector -->
                    <div class="quick-mood-selector">
                        <span class="mood-label">Mon humeur :</span>
                        <div class="mood-quick-buttons">
                            <button class="mood-quick-btn" onclick="app.quickSelectMood('calm', '#B4C7D9')" title="Calme">â˜ï¸</button>
                            <button class="mood-quick-btn" onclick="app.quickSelectMood('happy', '#F4E4C1')" title="Joyeux">ðŸ˜Š</button>
                            <button class="mood-quick-btn" onclick="app.quickSelectMood('sad', '#D1C9D9')" title="Triste">ðŸ˜¢</button>
                            <button class="mood-quick-btn" onclick="app.quickSelectMood('energetic', '#E8C5C0')" title="Ã‰nergique">âš¡</button>
                            <button class="mood-quick-btn" onclick="app.quickSelectMood('peaceful', '#C9D1BC')" title="Paisible">ðŸ§˜</button>
                            <button class="mood-quick-btn" onclick="app.quickSelectMood('anxious', '#DDDAD3')" title="Anxieux">ðŸ˜°</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Today's journal entry preview if exists -->
            <div id="today-entry-preview" class="hidden">
                <div class="today-entry-card">
                    <div class="entry-card-header">
                        <span>ðŸ“– Ta page d'aujourd'hui</span>
                        <button class="btn btn-ghost btn-small" onclick="app.editTodayEntry()">Modifier</button>
                    </div>
                    <div class="entry-card-preview" id="today-entry-text">
                        <!-- Preview text -->
                    </div>
                    <div class="entry-card-actions">
                        <button class="btn btn-secondary btn-small" onclick="app.viewTodayEntry()">
                            Voir la page complÃ¨te â†’
                        </button>
                    </div>
                </div>
            </div>

            <!-- Streak Motivation -->
            <div class="streak-card">
                <div class="streak-flame">ðŸ”¥</div>
                <div class="streak-content">
                    <div class="streak-number" id="streak-display">3 jours</div>
                    <div class="streak-label">d'affilÃ©e ! Continue comme Ã§a</div>
                </div>
            </div>

            <!-- Secondary: Daily Envelope (shown when already opened) -->
            <div id="envelope-compact-section">
                <div class="section-header">
                    <h3>Ta surprise quotidienne</h3>
                    <p>DÃ©bloque de nouveaux trÃ©sors pour embellir tes pages</p>
                </div>

                <div class="envelope-card-compact" id="envelope-card" onclick="app.openEnvelope()">
                    <div class="envelope-visual-small">ðŸ’Œ</div>
                    <div class="envelope-content-small">
                        <h4 class="envelope-title-small" id="envelope-title">PrÃªte Ã  dÃ©couvrir ?</h4>
                        <p class="envelope-description-small" id="envelope-description">Un nouveau trÃ©sor t'attend</p>
                        <div class="countdown hidden" id="countdown">
                            <span id="countdown-text">23:45:12</span>
                        </div>
                    </div>
                    <div class="envelope-arrow">â†’</div>
                </div>
            </div>

            <!-- Quick navigation -->
            <div class="home-quick-nav">
                <div class="quick-nav-item" onclick="app.navigateTo('journal-history')">
                    <div class="quick-nav-icon">ðŸ“š</div>
                    <div class="quick-nav-label">Mon journal</div>
                    <div class="quick-nav-count" id="journal-count">12 pages</div>
                </div>
                <div class="quick-nav-item" onclick="app.navigateTo('collection')">
                    <div class="quick-nav-icon">ðŸŽ¨</div>
                    <div class="quick-nav-label">Collection</div>
                    <div class="quick-nav-count" id="collection-count">15 assets</div>
                </div>
                <div class="quick-nav-item" onclick="app.navigateTo('pixel-year')">
                    <div class="quick-nav-icon">ðŸ“Š</div>
                    <div class="quick-nav-label">Pixel Year</div>
                    <div class="quick-nav-count" id="mood-count">8 humeurs</div>
                </div>
            </div>
            
            <!-- Debug: Reset button (remove in production) -->
            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-ghost" onclick="app.resetApp()" style="font-size: 12px; opacity: 0.5;">
                    ðŸ”„ RÃ©initialiser (debug)
                </button>
            </div>
        </div>

        <!-- ============================================
             ENVELOPE OPENING SCREEN
        ============================================ -->
        <div id="envelope-opening-screen" class="screen">
            <div id="opening-phase">
                <h2 class="opening-title">Ton enveloppe quotidienne</h2>
                <div class="opening-envelope" id="opening-envelope" onclick="app.tearEnvelope()">
                    ðŸ’Œ
                </div>
                <p class="hint-text">ðŸ‘† Tape pour ouvrir</p>
            </div>

            <div id="reveal-phase" class="reveal-container hidden">
                <h2 class="reveal-title">Tu as dÃ©bloquÃ© ce trÃ©sor âœ¨</h2>
                <div class="assets-grid" id="revealed-assets">
                    <!-- Assets will be injected here -->
                </div>
                <button class="btn btn-primary btn-full" onclick="app.navigateTo('home')">
                    C'est parti !
                </button>
            </div>
        </div>

        <!-- ============================================
             JOURNAL EDITOR SCREEN
        ============================================ -->
        <!-- ============================================
             JOURNAL EDITOR SCREEN - ZEN MODE
        ============================================ -->
        <div id="journal-editor-screen" class="screen">
            <!-- Minimalist header -->
            <div class="editor-header-minimal">
                <button class="icon-btn-minimal" onclick="app.exitEditor()">â†</button>
                <div class="editor-date-badge" id="editor-date">Aujourd'hui</div>
                <div class="editor-autosave" id="autosave-indicator">
                    <span class="autosave-text">SauvegardÃ© âœ“</span>
                </div>
            </div>

            <!-- Main writing area -->
            <div class="journal-canvas-zen" id="journal-canvas-zen">
                <!-- Background layer -->
                <div class="canvas-background-zen" id="canvas-background-zen"></div>
                
                <!-- Writing container -->
                <div class="writing-container-zen">
                    <textarea 
                        id="journal-text" 
                        class="journal-textarea-zen" 
                        placeholder="Laisse tes pensÃ©es couler doucement..."
                        spellcheck="false"
                    ></textarea>
                    
                    <!-- Word count -->
                    <div class="word-count-zen" id="word-count-zen">0 mots</div>
                </div>
                
                <!-- Stickers layer -->
                <div class="stickers-layer-zen" id="stickers-layer-zen">
                    <!-- Stickers added here -->
                </div>
            </div>

            <!-- Floating toolbar -->
            <div class="editor-toolbar-floating" id="editor-toolbar-floating">
                <button class="toolbar-btn-zen" onclick="app.openStickerPicker()">
                    <span class="toolbar-icon-zen">ðŸŽ¨</span>
                    <span class="toolbar-label-zen">Sticker</span>
                </button>
                
                <button class="toolbar-btn-zen" onclick="app.openBackgroundPicker()">
                    <span class="toolbar-icon-zen">ðŸ–¼ï¸</span>
                    <span class="toolbar-label-zen">Fond</span>
                </button>
                
                <button class="toolbar-btn-zen" onclick="app.openMoodPicker()">
                    <span class="toolbar-icon-zen" id="current-mood-icon-zen">ðŸ˜Š</span>
                    <span class="toolbar-label-zen">Humeur</span>
                </button>
                
                <button class="toolbar-btn-zen toolbar-btn-primary-zen" onclick="app.saveAndExitEditor()">
                    <span class="toolbar-icon-zen">âœ¨</span>
                    <span class="toolbar-label-zen">Terminer</span>
                </button>
            </div>
        </div>

        <!-- Sticker Picker Bottom Sheet -->
        <div class="modal-overlay" id="sticker-picker-modal-zen" onclick="app.closeStickerPickerIfOverlay(event)">
            <div class="bottom-sheet-zen" onclick="event.stopPropagation()">
                <div class="bottom-sheet-handle"></div>
                <div class="bottom-sheet-header-zen">
                    <h3>Ajouter un sticker</h3>
                    <button class="modal-close-zen" onclick="app.closeStickerPicker()">âœ•</button>
                </div>
                
                <div class="bottom-sheet-content-zen">
                    <div class="stickers-grid-zen" id="stickers-grid-zen">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Background Picker Bottom Sheet -->
        <div class="modal-overlay" id="background-picker-modal-zen" onclick="app.closeBackgroundPickerIfOverlay(event)">
            <div class="bottom-sheet-zen" onclick="event.stopPropagation()">
                <div class="bottom-sheet-handle"></div>
                <div class="bottom-sheet-header-zen">
                    <h3>Choisir un fond</h3>
                    <button class="modal-close-zen" onclick="app.closeBackgroundPicker()">âœ•</button>
                </div>
                
                <div class="bottom-sheet-content-zen">
                    <div class="backgrounds-carousel-zen" id="backgrounds-carousel-zen">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Mood Picker Bottom Sheet -->
        <div class="modal-overlay" id="mood-picker-modal-zen" onclick="app.closeMoodPickerIfOverlay(event)">
            <div class="bottom-sheet-zen bottom-sheet-compact-zen" onclick="event.stopPropagation()">
                <div class="bottom-sheet-handle"></div>
                <div class="bottom-sheet-header-zen">
                    <h3>Comment te sens-tu ?</h3>
                    <button class="modal-close-zen" onclick="app.closeMoodPicker()">âœ•</button>
                </div>
                
                <div class="bottom-sheet-content-zen">
                    <div class="mood-picker-grid-zen">
                        <button class="mood-picker-btn-zen" onclick="app.selectEditorMood('calm', '#B4C7D9', 'â˜ï¸')">
                            <span class="mood-picker-emoji-zen">â˜ï¸</span>
                            <span class="mood-picker-label-zen">Calme</span>
                        </button>
                        <button class="mood-picker-btn-zen" onclick="app.selectEditorMood('happy', '#F4E4C1', 'ðŸ˜Š')">
                            <span class="mood-picker-emoji-zen">ðŸ˜Š</span>
                            <span class="mood-picker-label-zen">Joyeux</span>
                        </button>
                        <button class="mood-picker-btn-zen" onclick="app.selectEditorMood('sad', '#D1C9D9', 'ðŸ˜¢')">
                            <span class="mood-picker-emoji-zen">ðŸ˜¢</span>
                            <span class="mood-picker-label-zen">Triste</span>
                        </button>
                        <button class="mood-picker-btn-zen" onclick="app.selectEditorMood('energetic', '#E8C5C0', 'âš¡')">
                            <span class="mood-picker-emoji-zen">âš¡</span>
                            <span class="mood-picker-label-zen">Ã‰nergique</span>
                        </button>
                        <button class="mood-picker-btn-zen" onclick="app.selectEditorMood('peaceful', '#C9D1BC', 'ðŸ§˜')">
                            <span class="mood-picker-emoji-zen">ðŸ§˜</span>
                            <span class="mood-picker-label-zen">Paisible</span>
                        </button>
                        <button class="mood-picker-btn-zen" onclick="app.selectEditorMood('anxious', '#DDDAD3', 'ðŸ˜°')">
                            <span class="mood-picker-emoji-zen">ðŸ˜°</span>
                            <span class="mood-picker-label-zen">Anxieux</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================
             COLLECTION SCREEN
        ============================================ -->
        <div id="collection-screen" class="screen">
            <div class="collection-header">
                <h1>Ma Collection</h1>
                <p>Tous tes trÃ©sors dÃ©bloquÃ©s</p>
            </div>

            <div class="collection-stats">
                <div class="card stat-card">
                    <span class="stat-number" id="total-assets">12</span>
                    <span class="stat-label">Assets</span>
                </div>
                <div class="card stat-card">
                    <span class="stat-number" id="rare-count">2</span>
                    <span class="stat-label">Rares</span>
                </div>
                <div class="card stat-card">
                    <span class="stat-number" id="legendary-count">0</span>
                    <span class="stat-label">LÃ©gendaires</span>
                </div>
            </div>

            <!-- Level 1 Filter: Type -->
            <div class="collection-filters-level1">
                <button class="filter-btn-level1 active" data-type="sticker" onclick="app.filterCollectionByType('sticker')">
                    <span class="filter-icon">ðŸŽ¨</span>
                    <span class="filter-label">Stickers</span>
                </button>
                <button class="filter-btn-level1" data-type="paper" onclick="app.filterCollectionByType('paper')">
                    <span class="filter-icon">ðŸ“„</span>
                    <span class="filter-label">Fonds</span>
                </button>
                <button class="filter-btn-level1" data-type="washi" onclick="app.filterCollectionByType('washi')">
                    <span class="filter-icon">ðŸŽ€</span>
                    <span class="filter-label">Washi</span>
                </button>
            </div>

            <!-- Level 2 Filter: Collection (only shown for stickers) -->
            <div class="collection-filters-level2" id="collection-filters-level2">
                <button class="filter-btn-level2 active" data-collection="all" onclick="app.filterCollectionByCollection('all')">
                    Toutes
                </button>
                <button class="filter-btn-level2" data-collection="japan-lofi" onclick="app.filterCollectionByCollection('japan-lofi')">
                    ðŸŽŒ Japan Lofi
                </button>
                <button class="filter-btn-level2" data-collection="dark-fantasy" onclick="app.filterCollectionByCollection('dark-fantasy')">
                    ðŸŒ™ Dark Fantasy
                </button>
                <button class="filter-btn-level2" data-collection="cottage-core" onclick="app.filterCollectionByCollection('cottage-core')">
                    ðŸŒ¿ Cottage Core
                </button>
                <button class="filter-btn-level2" data-collection="emotions" onclick="app.filterCollectionByCollection('emotions')">
                    ðŸ’ Ã‰motions
                </button>
            </div>

            <div class="collection-grid" id="collection-grid">
                <!-- Will be populated dynamically -->
            </div>

            <div style="height: 80px;"></div> <!-- Spacer for nav -->
        </div>

        <!-- ============================================
             JOURNAL HISTORY SCREEN
        ============================================ -->
        <div id="journal-history-screen" class="screen">
            <div class="editor-header">
                <button class="icon-btn" onclick="app.navigateTo('home')">â†</button>
                <h3 style="margin: 0; font-family: var(--font-display);">Mon Journal</h3>
                <div style="width: 40px;"></div>
            </div>

            <div style="padding: var(--space-lg); flex: 1; overflow-y: auto;">
                <!-- Filters -->
                <div style="display: flex; gap: var(--space-sm); margin-bottom: var(--space-xl); overflow-x: auto;">
                    <button class="btn btn-secondary" style="white-space: nowrap; padding: 8px 16px; font-size: 14px;" onclick="app.filterJournal('all')">
                        Tout
                    </button>
                    <button class="btn btn-secondary" style="white-space: nowrap; padding: 8px 16px; font-size: 14px;" onclick="app.filterJournal('this-week')">
                        Cette semaine
                    </button>
                    <button class="btn btn-secondary" style="white-space: nowrap; padding: 8px 16px; font-size: 14px;" onclick="app.filterJournal('this-month')">
                        Ce mois
                    </button>
                </div>

                <!-- Entries List -->
                <div id="journal-entries-list" class="journal-entries-list">
                    <!-- Will be populated -->
                </div>

                <div style="height: 80px;"></div>
            </div>
        </div>

        <!-- ============================================
             PIXEL YEAR SCREEN
        ============================================ -->
        <div id="pixel-year-screen" class="screen">
            <div class="editor-header">
                <button class="icon-btn" onclick="app.navigateTo('home')">â†</button>
                <h3 style="margin: 0; font-family: var(--font-display);">Pixel Year</h3>
                <button class="icon-btn" onclick="app.sharePixelYear()">â†—</button>
            </div>

            <div style="padding: var(--space-lg); flex: 1; overflow-y: auto;">
                <div class="card" style="text-align: center; margin-bottom: var(--space-xl);">
                    <h2 style="margin-bottom: var(--space-sm);">2026</h2>
                    <p style="font-size: 14px; color: rgba(61, 52, 40, 0.6);">
                        Chaque jour, une couleur reprÃ©sente ton humeur
                    </p>
                </div>

                <!-- Pixel Grid -->
                <div class="pixel-year-grid" id="pixel-year-grid">
                    <!-- 365 pixels will be generated -->
                </div>

                <!-- Legend -->
                <div class="card" style="margin-top: var(--space-xl);">
                    <h3 style="margin-bottom: var(--space-md); font-size: 16px;">LÃ©gende</h3>
                    <div class="mood-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #B4C7D9;"></div>
                            <span>Calme</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #F4E4C1;"></div>
                            <span>Joyeux</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #D1C9D9;"></div>
                            <span>Triste</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #E8C5C0;"></div>
                            <span>Ã‰nergique</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #C9D1BC;"></div>
                            <span>Paisible</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #DDDAD3;"></div>
                            <span>Anxieux</span>
                        </div>
                    </div>
                </div>

                <div style="height: 80px;"></div>
            </div>
        </div>

        <!-- ============================================
             PROFILE SCREEN (formerly Settings)
        ============================================ -->
        <div id="profile-screen" class="screen">
            <div class="profile-header">
                <div class="profile-avatar-large">
                    <div class="avatar-circle">ðŸ‘¤</div>
                    <div class="level-badge" id="profile-level">Niveau 3</div>
                </div>
                <h2 class="profile-name" id="profile-name">Marie</h2>
                <p class="profile-subtitle">En quÃªte d'harmonie</p>
            </div>

            <!-- Harmonie Progress -->
            <div class="harmonie-card card-elevated">
                <div class="harmonie-header">
                    <div>
                        <h3 style="margin: 0; margin-bottom: 4px;">Ton Harmonie</h3>
                        <p style="font-size: 13px; color: rgba(61, 52, 40, 0.6); margin: 0;">
                            Ta sÃ©rÃ©nitÃ© grandit avec toi
                        </p>
                    </div>
                    <div class="harmonie-icon">ðŸŒ¸</div>
                </div>
                
                <div class="level-progress">
                    <div class="level-progress-bar">
                        <div class="level-progress-fill" id="harmonie-progress" style="width: 65%;"></div>
                    </div>
                    <div class="level-progress-text">
                        <span id="harmonie-current">325</span> / <span id="harmonie-next">500</span>
                    </div>
                </div>
                
                <div class="level-info">
                    <span>Niveau <strong id="current-level">3</strong></span>
                    <span id="level-up-text">175 jusqu'au niveau 4</span>
                </div>
                
                <p style="text-align: center; font-size: 13px; color: rgba(61, 52, 40, 0.6); margin-top: var(--space-md);">
                    ðŸ’Œ Ã€ chaque niveau, une nouvelle enveloppe t'attend
                </p>
            </div>

            <!-- Today's Intentions -->
            <div class="intentions-section">
                <h3 class="section-title">Intentions du jour</h3>
                <p class="section-description">Prends soin de toi, pas Ã  pas</p>
                
                <div class="intentions-list">
                    <div class="intention-card" id="intention-write">
                        <div class="intention-icon">âœï¸</div>
                        <div class="intention-content">
                            <div class="intention-title">DÃ©poser une pensÃ©e</div>
                            <div class="intention-description">Ã‰crire dans ton journal</div>
                        </div>
                        <div class="intention-reward">
                            <span class="reward-value">+50</span>
                            <span class="reward-icon">ðŸŒ¸</span>
                        </div>
                        <div class="intention-check">âœ“</div>
                    </div>
                    
                    <div class="intention-card" id="intention-envelope">
                        <div class="intention-icon">ðŸ’Œ</div>
                        <div class="intention-content">
                            <div class="intention-title">Accueillir son cadeau</div>
                            <div class="intention-description">Ouvrir ton enveloppe</div>
                        </div>
                        <div class="intention-reward">
                            <span class="reward-value">+20</span>
                            <span class="reward-icon">ðŸŒ¸</span>
                        </div>
                        <div class="intention-check">âœ“</div>
                    </div>
                    
                    <div class="intention-card" id="intention-react">
                        <div class="intention-icon">ðŸ’«</div>
                        <div class="intention-content">
                            <div class="intention-title">Envoyer de la lumiÃ¨re</div>
                            <div class="intention-description">RÃ©agir Ã  3 publications</div>
                            <div class="intention-progress">
                                <span id="reactions-count">0</span> / 3
                            </div>
                        </div>
                        <div class="intention-reward">
                            <span class="reward-value">+30</span>
                            <span class="reward-icon">ðŸŒ¸</span>
                        </div>
                        <div class="intention-check">âœ“</div>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="profile-stats-grid">
                <div class="profile-stat-card">
                    <div class="stat-icon">ðŸ”¥</div>
                    <div class="stat-value" id="profile-streak">3</div>
                    <div class="stat-label">jours d'affilÃ©e</div>
                </div>
                <div class="profile-stat-card">
                    <div class="stat-icon">ðŸ“–</div>
                    <div class="stat-value" id="profile-entries">12</div>
                    <div class="stat-label">pages Ã©crites</div>
                </div>
                <div class="profile-stat-card">
                    <div class="stat-icon">ðŸ’«</div>
                    <div class="stat-value" id="profile-reactions">47</div>
                    <div class="stat-label">lumiÃ¨res envoyÃ©es</div>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="settings-section">
                <h3 class="section-title">ParamÃ¨tres</h3>
                
                <div class="settings-list">
                    <div class="setting-item" onclick="app.toggleNotifications()">
                        <div>
                            <div class="setting-label">Notifications quotidiennes</div>
                            <div class="setting-description">Rappel pour ouvrir ton enveloppe</div>
                        </div>
                        <div class="toggle-switch" id="notif-toggle">
                            <input type="checkbox" id="notif-checkbox" checked>
                            <span class="toggle-slider"></span>
                        </div>
                    </div>

                    <div class="setting-item" onclick="app.toggleAmbiance()">
                        <div>
                            <div class="setting-label">Ambiances sonores</div>
                            <div class="setting-description">Sons relaxants pendant l'Ã©criture</div>
                        </div>
                        <div class="toggle-switch" id="ambiance-toggle">
                            <input type="checkbox" id="ambiance-checkbox">
                            <span class="toggle-slider"></span>
                        </div>
                    </div>

                    <div class="setting-item" onclick="app.toggleMagicBlur()">
                        <div>
                            <div class="setting-label">Magic Blur</div>
                            <div class="setting-description">Floute automatiquement tes textes</div>
                        </div>
                        <div class="toggle-switch" id="blur-toggle">
                            <input type="checkbox" id="blur-checkbox">
                            <span class="toggle-slider"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Links -->
            <div class="card" style="margin: var(--space-lg);">
                <div class="link-item" onclick="app.navigateTo('wellness')">
                    <span>ðŸ’š Mon bien-Ãªtre</span>
                    <span>â†’</span>
                </div>
                <div class="link-item" onclick="app.showPrivacyPolicy()">
                    <span>ðŸ”’ ConfidentialitÃ©</span>
                    <span>â†’</span>
                </div>
                <div class="link-item" onclick="app.exportData()">
                    <span>ðŸ“¥ Exporter mes donnÃ©es</span>
                    <span>â†’</span>
                </div>
                <div class="link-item" onclick="app.contactSupport()">
                    <span>ðŸ’Œ Nous contacter</span>
                    <span>â†’</span>
                </div>
            </div>

            <div style="text-align: center; margin: var(--space-xl) var(--space-lg); color: rgba(61, 52, 40, 0.4); font-size: 12px;">
                YORI v1.0.0 POC<br>
                Fait avec ðŸŒ¸ par ton Ã©quipe
            </div>

            <div style="height: 80px;"></div>
        </div>

        <!-- Settings screen kept for backwards compatibility but redirects to profile -->
        <div id="settings-screen" class="screen" style="display: none;">
            <!-- Empty - navigateTo('settings') will redirect to 'profile' -->
        </div>

        <!-- ============================================
             WELLNESS DASHBOARD SCREEN
        ============================================ -->
        <div id="wellness-screen" class="screen">
            <div class="editor-header">
                <button class="icon-btn" onclick="app.navigateTo('settings')">â†</button>
                <h3 style="margin: 0; font-family: var(--font-display);">Mon Bien-Ãªtre</h3>
                <div style="width: 40px;"></div>
            </div>

            <div style="padding: var(--space-lg); flex: 1; overflow-y: auto;">
                <!-- Wellness Summary -->
                <div class="card wellness-summary">
                    <h3 style="margin-bottom: var(--space-lg);">Comment vas-tu ?</h3>
                    
                    <div class="wellness-stats-grid">
                        <div class="wellness-stat">
                            <div class="wellness-stat-icon" style="background: var(--honey);">ðŸ”¥</div>
                            <div class="wellness-stat-value" id="wellness-streak">3</div>
                            <div class="wellness-stat-label">jours d'affilÃ©e</div>
                        </div>
                        
                        <div class="wellness-stat">
                            <div class="wellness-stat-icon" style="background: var(--sage);">ðŸ“</div>
                            <div class="wellness-stat-value" id="wellness-entries">12</div>
                            <div class="wellness-stat-label">pages Ã©crites</div>
                        </div>
                        
                        <div class="wellness-stat">
                            <div class="wellness-stat-icon" style="background: var(--lavender);">ðŸ˜Š</div>
                            <div class="wellness-stat-value" id="wellness-mood">Calme</div>
                            <div class="wellness-stat-label">humeur dominante</div>
                        </div>
                    </div>
                </div>

                <!-- Mood Distribution -->
                <div class="card" style="margin-top: var(--space-lg);">
                    <h3 style="margin-bottom: var(--space-md);">Tes humeurs cette semaine</h3>
                    <div class="mood-distribution" id="mood-distribution">
                        <!-- Will be populated -->
                    </div>
                </div>

                <!-- Emotional Insights -->
                <div class="card" style="margin-top: var(--space-lg);">
                    <h3 style="margin-bottom: var(--space-md);">ðŸ’¡ Insights</h3>
                    <div class="insights-list" id="insights-list">
                        <!-- Will be populated -->
                    </div>
                </div>

                <!-- Progress This Month -->
                <div class="card" style="margin-top: var(--space-lg);">
                    <h3 style="margin-bottom: var(--space-md);">Ce mois-ci</h3>
                    <div class="progress-item">
                        <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-xs);">
                            <span>Jours d'Ã©criture</span>
                            <span id="month-progress-text">8 / 30</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 27%; background: var(--terracotta);" id="month-progress-bar"></div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div style="margin-top: var(--space-xl); display: flex; gap: var(--space-md);">
                    <button class="btn btn-secondary" style="flex: 1;" onclick="app.navigateTo('pixel-year')">
                        ðŸ“Š Voir Pixel Year
                    </button>
                    <button class="btn btn-secondary" style="flex: 1;" onclick="app.navigateTo('journal-history')">
                        ðŸ“– Mon journal
                    </button>
                </div>

                <div style="height: 80px;"></div>
            </div>
        </div>

        <!-- ============================================
             COMMUNITY FEED SCREEN
        ============================================ -->
        <div id="community-screen" class="screen">
            <div class="feed-header">
                <h1>CommunautÃ© ðŸ’«</h1>
                <p class="feed-subtitle">Des pages partagÃ©es avec bienveillance</p>
            </div>

            <!-- Filter tabs -->
            <div class="feed-filters">
                <button class="feed-filter-btn active" onclick="app.filterFeed('all')">
                    RÃ©centes
                </button>
                <button class="feed-filter-btn" onclick="app.filterFeed('popular')">
                    Populaires
                </button>
                <button class="feed-filter-btn" onclick="app.filterFeed('following')">
                    Abonnements
                </button>
            </div>

            <div class="feed-content" id="feed-content">
                <!-- Will be populated with shared pages -->
            </div>

            <div style="height: 80px;"></div>
        </div>

        <!-- ============================================
             BOTTOM NAVIGATION
        ============================================ -->
        <nav class="bottom-nav" id="bottom-nav">
            <a class="nav-item active" onclick="app.navigateTo('home')" data-screen="home">
                <div class="nav-icon">ðŸ </div>
                <div class="nav-label">Accueil</div>
            </a>
            <a class="nav-item" onclick="app.navigateTo('community')" data-screen="community">
                <div class="nav-icon">ðŸ’«</div>
                <div class="nav-label">CommunautÃ©</div>
            </a>
            <a class="nav-item" onclick="app.navigateTo('journal-history')" data-screen="journal-history">
                <div class="nav-icon">ðŸ“–</div>
                <div class="nav-label">Journal</div>
            </a>
            <a class="nav-item" onclick="app.navigateTo('collection')" data-screen="collection">
                <div class="nav-icon">ðŸŽ¨</div>
                <div class="nav-label">Collection</div>
            </a>
            <a class="nav-item" onclick="app.navigateTo('profile')" data-screen="profile">
                <div class="nav-icon">âœ¨</div>
                <div class="nav-label">Profil</div>
            </a>
        </nav>

        <!-- ============================================
             MODALS
        ============================================ -->
        
        <!-- Mood Picker Modal -->
        <div class="modal-overlay" id="mood-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">Comment te sens-tu ?</h3>
                    <button class="modal-close" onclick="app.closeMoodPicker()">âœ•</button>
                </div>
                <div class="modal-body">
                    <div class="mood-colors">
                        <div class="mood-color" style="background: #B4C7D9;" data-mood="calm" onclick="app.selectMood('calm', '#B4C7D9')">
                            â˜ï¸
                        </div>
                        <div class="mood-color" style="background: #F4E4C1;" data-mood="happy" onclick="app.selectMood('happy', '#F4E4C1')">
                            ðŸ˜Š
                        </div>
                        <div class="mood-color" style="background: #D1C9D9;" data-mood="sad" onclick="app.selectMood('sad', '#D1C9D9')">
                            ðŸ˜¢
                        </div>
                        <div class="mood-color" style="background: #E8C5C0;" data-mood="energetic" onclick="app.selectMood('energetic', '#E8C5C0')">
                            âš¡
                        </div>
                        <div class="mood-color" style="background: #C9D1BC;" data-mood="peaceful" onclick="app.selectMood('peaceful', '#C9D1BC')">
                            ðŸ§˜
                        </div>
                        <div class="mood-color" style="background: #DDDAD3;" data-mood="anxious" onclick="app.selectMood('anxious', '#DDDAD3')">
                            ðŸ˜°
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary btn-full" onclick="app.saveMood()">
                    Enregistrer
                </button>
            </div>
        </div>

        <!-- Paywall Modal -->
        <div class="modal-overlay" id="paywall-modal">
            <div class="modal paywall-modal">
                <div class="modal-header">
                    <h3 class="modal-title">Passe Premium</h3>
                    <button class="modal-close" onclick="app.closePaywall()">âœ•</button>
                </div>
                
                <div class="paywall-header">
                    <div class="paywall-icon">âœ¨</div>
                    <h2 style="margin-bottom: var(--space-sm);">AccÃ©lÃ¨re ta collection</h2>
                    <p style="color: rgba(61, 52, 40, 0.7);">
                        DÃ©bloque 3Ã— plus vite et accÃ¨de Ã  toutes les fonctionnalitÃ©s
                    </p>
                </div>

                <div class="paywall-features">
                    <div class="feature-row">
                        <div class="feature-icon">ðŸ’Œ</div>
                        <div class="feature-text">
                            <div class="feature-title">3 enveloppes / jour</div>
                            <div class="feature-description">Au lieu d'une seule</div>
                        </div>
                    </div>
                    <div class="feature-row">
                        <div class="feature-icon">ðŸŽ¨</div>
                        <div class="feature-text">
                            <div class="feature-title">Pokedex complet</div>
                            <div class="feature-description">Vois tous les assets disponibles</div>
                        </div>
                    </div>
                    <div class="feature-row">
                        <div class="feature-icon">ðŸŽµ</div>
                        <div class="feature-text">
                            <div class="feature-title">Ambiances illimitÃ©es</div>
                            <div class="feature-description">Tous les sons relaxants</div>
                        </div>
                    </div>
                    <div class="feature-row">
                        <div class="feature-icon">ðŸ“¥</div>
                        <div class="feature-text">
                            <div class="feature-title">Export HD</div>
                            <div class="feature-description">Sauvegarde tes pages en haute qualitÃ©</div>
                        </div>
                    </div>
                </div>

                <div class="price-card">
                    <div class="price-amount">4,99â‚¬</div>
                    <div class="price-period">/ mois</div>
                    <div class="price-description">
                        Annule Ã  tout moment â€¢ Sans engagement
                    </div>
                </div>

                <button class="btn btn-primary btn-full" onclick="app.purchasePremium()">
                    Commencer l'essai gratuit (7 jours)
                </button>
                
                <p style="text-align: center; font-size: 12px; color: rgba(61, 52, 40, 0.5); margin-top: var(--space-md);">
                    Essai gratuit de 7 jours, puis 4,99â‚¬/mois
                </p>
            </div>
        </div>

        <!-- Ambiance Picker Modal -->
        <div class="modal-overlay" id="ambiance-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">Ambiances sonores</h3>
                    <button class="modal-close" onclick="app.closeAmbiancePicker()">âœ•</button>
                </div>
                <div class="modal-body">
                    <div class="ambiance-grid">
                        <div class="ambiance-card" data-ambiance="rain" onclick="app.selectAmbiance('rain')">
                            <div class="ambiance-icon">ðŸŒ§ï¸</div>
                            <div class="ambiance-name">Pluie</div>
                        </div>
                        <div class="ambiance-card" data-ambiance="fireplace" onclick="app.selectAmbiance('fireplace')">
                            <div class="ambiance-icon">ðŸ”¥</div>
                            <div class="ambiance-name">CheminÃ©e</div>
                        </div>
                        <div class="ambiance-card" data-ambiance="forest" onclick="app.selectAmbiance('forest')">
                            <div class="ambiance-icon">ðŸŒ²</div>
                            <div class="ambiance-name">ForÃªt</div>
                        </div>
                        <div class="ambiance-card locked" data-ambiance="ocean">
                            <div class="ambiance-icon">ðŸŒŠ</div>
                            <div class="ambiance-name">OcÃ©an</div>
                            <div class="premium-badge">Premium</div>
                        </div>
                        <div class="ambiance-card locked" data-ambiance="cafe">
                            <div class="ambiance-icon">â˜•</div>
                            <div class="ambiance-name">CafÃ©</div>
                            <div class="premium-badge">Premium</div>
                        </div>
                        <div class="ambiance-card locked" data-ambiance="night">
                            <div class="ambiance-icon">ðŸŒ™</div>
                            <div class="ambiance-name">Nuit</div>
                            <div class="premium-badge">Premium</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary btn-full" onclick="app.stopAmbiance()">
                        ArrÃªter le son
                    </button>
                </div>
            </div>
        </div>

        <!-- Artist Detail Modal -->
        <div class="modal-overlay" id="artist-modal">
            <div class="modal artist-modal">
                <div class="modal-header">
                    <button class="modal-close" onclick="app.closeArtistModal()">âœ•</button>
                </div>
                
                <div class="artist-detail-content" id="artist-detail-content">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
        </div>

        <!-- Asset Detail Modal -->
        <div class="modal-overlay" id="asset-detail-modal">
            <div class="modal">
                <div class="modal-header">
                    <button class="modal-close" onclick="app.closeAssetDetail()">âœ•</button>
                </div>
                
                <div class="asset-detail-content" id="asset-detail-content">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
        </div>

        <!-- Journal Page Viewer Modal -->
        <div class="modal-overlay" id="journal-viewer-modal">
            <div class="modal journal-viewer-modal">
                <div class="viewer-header">
                    <button class="icon-btn" onclick="app.closeJournalViewer()">âœ•</button>
                    <div class="viewer-actions">
                        <button class="icon-btn" onclick="app.toggleTextVisibility()" id="toggle-text-btn" title="Masquer/Afficher le texte">
                            ðŸ‘ï¸
                        </button>
                        <button class="icon-btn" onclick="app.shareJournalPage()" title="Partager">
                            â†—ï¸
                        </button>
                        <button class="icon-btn" onclick="app.editJournalPage()" title="Modifier">
                            âœï¸
                        </button>
                    </div>
                </div>
                
                <div class="viewer-content" id="viewer-content">
                    <!-- Will be populated dynamically -->
                </div>
                
                <div class="viewer-navigation">
                    <button class="nav-arrow" onclick="app.previousJournalPage()" id="prev-page-btn">
                        â†
                    </button>
                    <span class="page-indicator" id="page-indicator">1 / 5</span>
                    <button class="nav-arrow" onclick="app.nextJournalPage()" id="next-page-btn">
                        â†’
                    </button>
                </div>
            </div>
        </div>

        <!-- Share Modal -->
        <div class="modal-overlay" id="share-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">Partager ma page</h3>
                    <button class="modal-close" onclick="app.closeShareModal()">âœ•</button>
                </div>
                
                <div class="modal-body">
                    <!-- Preview -->
                    <div class="share-preview" id="share-preview">
                        <div class="share-preview-canvas">
                            <!-- Will show page preview -->
                        </div>
                    </div>
                    
                    <!-- Options -->
                    <div class="share-options">
                        <div class="share-option">
                            <label class="share-label">
                                <input type="checkbox" id="share-hide-text" checked>
                                <span>Masquer mon texte</span>
                            </label>
                            <p class="share-description">Seuls les stickers et le fond seront visibles</p>
                        </div>
                        
                        <div class="share-option">
                            <label class="share-label">
                                <input type="checkbox" id="share-show-mood">
                                <span>Afficher mon humeur</span>
                            </label>
                            <p class="share-description">La couleur de ton humeur du jour</p>
                        </div>
                        
                        <div class="share-option">
                            <label class="share-label">
                                <input type="checkbox" id="share-show-date">
                                <span>Afficher la date</span>
                            </label>
                            <p class="share-description">Le jour de cette entrÃ©e</p>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary btn-full" onclick="app.generateShareImage()">
                        ðŸ“¸ GÃ©nÃ©rer l'image
                    </button>
                    
                    <div class="share-actions" style="display: none;" id="share-actions">
                        <p style="text-align: center; color: var(--success); margin-bottom: var(--space-md);">
                            âœ“ Image gÃ©nÃ©rÃ©e !
                        </p>
                        <div style="display: flex; gap: var(--space-sm);">
                            <button class="btn btn-secondary" style="flex: 1;" onclick="app.downloadShare()">
                                ðŸ“¥ TÃ©lÃ©charger
                            </button>
                            <button class="btn btn-secondary" style="flex: 1;" onclick="app.copyShareLink()">
                                ðŸ”— Copier lien
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inspiration Prompt Modal -->
        <div class="modal-overlay" id="inspiration-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">As-tu de l'inspiration aujourd'hui ?</h3>
                    <button class="modal-close" onclick="app.closeInspirationModal()">âœ•</button>
                </div>
                
                <div class="modal-body">
                    <p style="text-align: center; margin-bottom: var(--space-xl); color: rgba(61, 52, 40, 0.7);">
                        Si tu ne sais pas par oÃ¹ commencer, je peux t'aider ðŸ’­
                    </p>
                    
                    <div style="display: flex; gap: var(--space-md); margin-bottom: var(--space-xl);">
                        <button class="btn btn-primary" style="flex: 1;" onclick="app.startWritingWithoutPrompt()">
                            Oui, j'ai des idÃ©es âœ¨
                        </button>
                        <button class="btn btn-secondary" style="flex: 1;" onclick="app.showWritingPrompts()">
                            Non, aide-moi ðŸ™
                        </button>
                    </div>
                    
                    <div id="writing-prompts" class="hidden">
                        <p style="font-size: 14px; color: rgba(61, 52, 40, 0.6); margin-bottom: var(--space-md); text-align: center;">
                            Choisis une phrase pour commencer :
                        </p>
                        <div class="prompts-list" id="prompts-list">
                            <!-- Will be populated based on mood -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Celebration Modal (after saving entry) -->
        <div class="modal-overlay" id="celebration-modal">
            <div class="modal celebration-modal">
                <div class="celebration-confetti">âœ¨ ðŸŒ¸ ðŸ’« âœ¨</div>
                <div class="celebration-icon">ðŸŽ‰</div>
                <h2 class="celebration-title">Bravo !</h2>
                <p class="celebration-message">Ta page est magnifique. Tu as pris soin de toi aujourd'hui.</p>
                
                <div class="celebration-stats">
                    <div class="celebration-stat">
                        <div class="stat-value" id="celebration-streak">3</div>
                        <div class="stat-label">jours d'affilÃ©e ðŸ”¥</div>
                    </div>
                    <div class="celebration-stat">
                        <div class="stat-value" id="celebration-total">12</div>
                        <div class="stat-label">pages Ã©crites ðŸ“–</div>
                    </div>
                </div>

                <div class="celebration-actions">
                    <button class="btn btn-primary btn-full" onclick="app.closeCelebrationAndExplore()">
                        DÃ©couvrir la communautÃ© ðŸ’«
                    </button>
                    <button class="btn btn-ghost btn-full" onclick="app.closeCelebrationToHome()">
                        Retour Ã  l'accueil
                    </button>
                </div>

                <p class="celebration-share-prompt">
                    Envie de partager ta crÃ©ation avec la communautÃ© ?
                    <button class="btn-link" onclick="app.shareToCommunityFromCelebration()">
                        Partager â†’
                    </button>
                </p>
            </div>
        </div>

        <!-- Level Up Modal -->
        <div class="modal-overlay" id="levelup-modal">
            <div class="modal levelup-modal">
                <div class="levelup-rays">âœ¨ ðŸ’« âœ¨ ðŸ’« âœ¨</div>
                <div class="levelup-icon">ðŸŒ¸</div>
                <h2 class="levelup-title">Niveau <span id="levelup-number">4</span> !</h2>
                <p class="levelup-message">Ton harmonie grandit</p>
                
                <div class="levelup-reward">
                    <div class="reward-envelope">ðŸ’Œ</div>
                    <p class="reward-text">Une nouvelle enveloppe t'attend !</p>
                </div>

                <button class="btn btn-primary btn-full" onclick="app.closeLevelUpAndClaim()">
                    Ouvrir mon cadeau âœ¨
                </button>
            </div>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Chargement...</p>
        </div>
    </div>

    <script>
        // ============================================
        // DATA & STATE
        // ============================================
        
        const app = {
            // User state
            user: {
                name: 'Marie',
                email: 'marie@exemple.com',
                isPremium: false,
                streak: 3,
                lastEnvelopeOpened: null,
                collection: [],
                journalEntries: [],
                moods: {}, // { '2026-01-15': { mood: 'happy', color: '#F4E4C1' } }
                currentMood: null,
                settings: {
                    notifications: true,
                    notificationTime: '09:00',
                    ambianceEnabled: false,
                    currentAmbiance: null,
                    magicBlurEnabled: false,
                },
                
                // Harmonie / Level system
                harmonie: 325,
                level: 3,
                totalReactions: 47,
                
                // Daily intentions tracking
                dailyIntentions: {
                    date: null, // Will be set to today's date
                    write: false,
                    envelope: false,
                    reactCount: 0, // Need 3 for completion
                },
            },
            
            // Available assets database (simplified)
            availableAssets: [
                // ========================================
                // JAPAN LOFI COLLECTION - Real assets
                // ========================================
                // Commons
                { id: 101, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/Japan%20lofi/Onigiri.png', name: 'Onigiri', type: 'sticker', rarity: 'common', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'japan', collection: 'japan-lofi' },
                { id: 102, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/Japan%20lofi/Parapluie.png', name: 'Parapluie', type: 'sticker', rarity: 'common', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'japan', collection: 'japan-lofi' },
                { id: 103, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/Japan%20lofi/Sakura.png', name: 'Sakura', type: 'sticker', rarity: 'common', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'japan', collection: 'japan-lofi' },
                
                // Rares
                { id: 104, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/Japan%20lofi/Brique_de_lait.png', name: 'Brique de lait', type: 'sticker', rarity: 'rare', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'japan', collection: 'japan-lofi' },
                { id: 105, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/Japan%20lofi/Lanterne_de_rue.png', name: 'Lanterne de rue', type: 'sticker', rarity: 'rare', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'japan', collection: 'japan-lofi' },
                { id: 106, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/Japan%20lofi/Rare_Bureau.png', name: 'Bureau', type: 'sticker', rarity: 'rare', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'japan', collection: 'japan-lofi' },
                { id: 107, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/Japan%20lofi/Rare_Food.png', name: 'Food', type: 'sticker', rarity: 'rare', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'japan', collection: 'japan-lofi' },
                
                // LÃ©gendaires
                { id: 108, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/Japan%20lofi/Legendaire_Cozy_Bedroom.png', name: 'Cozy Bedroom', type: 'sticker', rarity: 'legendary', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'japan', collection: 'japan-lofi' },
                { id: 109, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/Japan%20lofi/Legendaire_Porte_Torii.png', name: 'Porte Torii', type: 'sticker', rarity: 'legendary', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'japan', collection: 'japan-lofi' },
                { id: 110, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/Japan%20lofi/L%C3%A9gendaire_Rue_de_Tokyo.png', name: 'Rue de Tokyo', type: 'sticker', rarity: 'legendary', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'japan', collection: 'japan-lofi' },
                
                // ========================================
                // DARK FANTASY COLLECTION - Temporary emojis
                // ========================================
                // Commons
                { id: 201, icon: 'ðŸŒ‘', name: 'Lune sombre', type: 'sticker', rarity: 'common', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'dark', collection: 'dark-fantasy' },
                { id: 202, icon: 'ðŸ•¯ï¸', name: 'Chandelle', type: 'sticker', rarity: 'common', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'dark', collection: 'dark-fantasy' },
                { id: 203, icon: 'ðŸ’€', name: 'CrÃ¢ne', type: 'sticker', rarity: 'common', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'dark', collection: 'dark-fantasy' },
                
                // Rares
                { id: 204, icon: 'ðŸ”®', name: 'Cristal magique', type: 'sticker', rarity: 'rare', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'dark', collection: 'dark-fantasy' },
                { id: 205, icon: 'ðŸ°', name: 'ChÃ¢teau gothique', type: 'sticker', rarity: 'rare', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'dark', collection: 'dark-fantasy' },
                
                // LÃ©gendaires
                { id: 206, icon: 'ðŸ‰', name: 'Dragon noir', type: 'sticker', rarity: 'legendary', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'dark', collection: 'dark-fantasy' },
                { id: 207, icon: 'ðŸ§™â€â™€ï¸', name: 'SorciÃ¨re', type: 'sticker', rarity: 'legendary', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'dark', collection: 'dark-fantasy' },
                
                // ========================================
                // COTTAGE CORE COLLECTION - Temporary emojis
                // ========================================
                // Commons
                { id: 301, icon: 'ðŸ„', name: 'Champignon', type: 'sticker', rarity: 'common', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'nature', collection: 'cottage-core' },
                { id: 302, icon: 'ðŸ§º', name: 'Panier', type: 'sticker', rarity: 'common', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'nature', collection: 'cottage-core' },
                { id: 303, icon: 'ðŸ¥–', name: 'Pain frais', type: 'sticker', rarity: 'common', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'cozy', collection: 'cottage-core' },
                
                // Rares
                { id: 304, icon: 'ðŸ¡', name: 'Maisonnette', type: 'sticker', rarity: 'rare', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'nature', collection: 'cottage-core' },
                { id: 305, icon: 'ðŸŒ»', name: 'Jardin fleuri', type: 'sticker', rarity: 'rare', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'nature', collection: 'cottage-core' },
                
                // LÃ©gendaires
                { id: 306, icon: 'ðŸ§š', name: 'FÃ©e des bois', type: 'sticker', rarity: 'legendary', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'nature', collection: 'cottage-core' },
                { id: 307, icon: 'ðŸŒˆ', name: 'Arc-en-ciel', type: 'sticker', rarity: 'legendary', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'nature', collection: 'cottage-core' },
                
                // ========================================
                // EMOTIONS COLLECTION - Real assets
                // ========================================
                // Commons
                { id: 501, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/amour.png', name: 'Amour', type: 'sticker', rarity: 'common', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'emotions', collection: 'emotions' },
                { id: 502, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/creativite.png', name: 'CrÃ©ativitÃ©', type: 'sticker', rarity: 'common', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'emotions', collection: 'emotions' },
                { id: 503, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/douleur.png', name: 'Douleur', type: 'sticker', rarity: 'common', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'emotions', collection: 'emotions' },
                { id: 504, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/doute.png', name: 'Doute', type: 'sticker', rarity: 'common', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'emotions', collection: 'emotions' },
                { id: 505, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/energie.png', name: 'Ã‰nergie', type: 'sticker', rarity: 'common', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'emotions', collection: 'emotions' },
                { id: 506, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/fatigue.png', name: 'Fatigue', type: 'sticker', rarity: 'common', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'emotions', collection: 'emotions' },
                { id: 507, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/joie.png', name: 'Joie', type: 'sticker', rarity: 'common', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'emotions', collection: 'emotions' },
                { id: 508, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/sommeil.png', name: 'Sommeil', type: 'sticker', rarity: 'common', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'emotions', collection: 'emotions' },
                { id: 509, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/tristesse.png', name: 'Tristesse', type: 'sticker', rarity: 'common', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'emotions', collection: 'emotions' },
                
                // Rares
                { id: 510, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/rare_anxiete.png', name: 'AnxiÃ©tÃ©', type: 'sticker', rarity: 'rare', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'emotions', collection: 'emotions' },
                { id: 511, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/rare_protection.png', name: 'Protection', type: 'sticker', rarity: 'rare', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'emotions', collection: 'emotions' },
                { id: 512, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/rare_resilience.png', name: 'RÃ©silience', type: 'sticker', rarity: 'rare', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'emotions', collection: 'emotions' },
                
                // LÃ©gendaires
                { id: 513, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/legendaire_guerison.png', name: 'GuÃ©rison', type: 'sticker', rarity: 'legendary', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'emotions', collection: 'emotions' },
                { id: 514, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/legendaire_imagination.png', name: 'Imagination', type: 'sticker', rarity: 'legendary', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'emotions', collection: 'emotions' },
                { id: 515, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/stickers/emotions/legendaire_liberation.png', name: 'LibÃ©ration', type: 'sticker', rarity: 'legendary', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'emotions', collection: 'emotions' },
                
                // ========================================
                // ESSENTIALS - Papers, Washi, Frames (Premium)
                // ========================================
                // PAPERS - Now with real background images (16 total)
                // Commons (9)
                { id: 401, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/Grid.jpg', name: 'Grid', type: 'paper', rarity: 'common', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'backgrounds', collection: 'essentials' },
                { id: 402, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/Matcha.jpg', name: 'Matcha', type: 'paper', rarity: 'common', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'backgrounds', collection: 'essentials' },
                { id: 403, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/Papierfroisse.jpg', name: 'Papier froissÃ©', type: 'paper', rarity: 'common', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'backgrounds', collection: 'essentials' },
                { id: 404, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/Rainyday.jpg', name: 'Rainy Day', type: 'paper', rarity: 'common', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'backgrounds', collection: 'essentials' },
                { id: 405, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/charbon.jpg', name: 'Charbon', type: 'paper', rarity: 'common', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'backgrounds', collection: 'essentials' },
                { id: 406, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/coton.jpg', name: 'Coton', type: 'paper', rarity: 'common', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'backgrounds', collection: 'essentials' },
                { id: 407, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/ligne.jpg', name: 'Lignes', type: 'paper', rarity: 'common', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'backgrounds', collection: 'essentials' },
                
                // Rares (5)
                { id: 408, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/rare_Goldenhour.jpg', name: 'Golden Hour', type: 'paper', rarity: 'rare', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'backgrounds', collection: 'essentials' },
                { id: 409, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/rare_Tachesdencre.jpg', name: 'Taches d\'encre', type: 'paper', rarity: 'rare', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'backgrounds', collection: 'essentials' },
                { id: 410, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/rare_candy.jpg', name: 'Candy', type: 'paper', rarity: 'rare', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'backgrounds', collection: 'essentials' },
                { id: 411, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/rare_matchalatte.jpg', name: 'Matcha Latte', type: 'paper', rarity: 'rare', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'backgrounds', collection: 'essentials' },
                { id: 412, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/rare_midnight.jpg', name: 'Midnight', type: 'paper', rarity: 'rare', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'backgrounds', collection: 'essentials' },
                
                // LÃ©gendaires (4)
                { id: 413, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/legendaire_gold.jpg', name: 'Gold', type: 'paper', rarity: 'legendary', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'backgrounds', collection: 'essentials' },
                { id: 414, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/legendaire_speckle.jpg', name: 'Speckle', type: 'paper', rarity: 'legendary', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'backgrounds', collection: 'essentials' },
                { id: 415, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/legendaire_storm.jpg', name: 'Storm', type: 'paper', rarity: 'legendary', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'backgrounds', collection: 'essentials' },
                { id: 416, icon: 'https://raw.githubusercontent.com/tblabs69/yoriapp/refs/heads/main/assets/fonds/legendaire_water.jpg', name: 'Water', type: 'paper', rarity: 'legendary', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'backgrounds', collection: 'essentials' },
                
                // Generic washi
                { id: 420, icon: 'ðŸŽ€', name: 'Washi basique', type: 'washi', rarity: 'common', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'decoration', collection: 'essentials', locked: true },
                { id: 421, icon: 'ðŸŽ—ï¸', name: 'Washi Ã©toiles', type: 'washi', rarity: 'rare', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'decoration', collection: 'essentials', locked: true },
                
                // Japan Lofi themed washi
                { id: 422, icon: 'ðŸŽ€', name: 'Washi Sakura', type: 'washi', rarity: 'common', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'japan', collection: 'japan-lofi', locked: true },
                { id: 423, icon: 'ðŸŽ—ï¸', name: 'Washi Torii', type: 'washi', rarity: 'rare', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'japan', collection: 'japan-lofi', locked: true },
                
                // Dark Fantasy themed washi
                { id: 424, icon: 'ðŸŽ€', name: 'Washi Lune', type: 'washi', rarity: 'common', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'dark', collection: 'dark-fantasy', locked: true },
                { id: 425, icon: 'ðŸŽ—ï¸', name: 'Washi Ã‰toiles Noires', type: 'washi', rarity: 'rare', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'dark', collection: 'dark-fantasy', locked: true },
                
                // Cottage Core themed washi
                { id: 426, icon: 'ðŸŽ€', name: 'Washi Fleurs', type: 'washi', rarity: 'common', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'nature', collection: 'cottage-core', locked: true },
                { id: 427, icon: 'ðŸŽ—ï¸', name: 'Washi Champignon', type: 'washi', rarity: 'rare', artist: 'Sophie Martin', artistId: 'artist_1', theme: 'nature', collection: 'cottage-core', locked: true },
                
                // Frames
                { id: 428, icon: 'ðŸ–¼ï¸', name: 'Cadre polaroid', type: 'frame', rarity: 'rare', artist: 'Lucas Bernard', artistId: 'artist_2', theme: 'photo', collection: 'essentials', locked: true },
                { id: 429, icon: 'ðŸ”²', name: 'Cadre floral', type: 'frame', rarity: 'legendary', artist: 'Emma Laurent', artistId: 'artist_3', theme: 'photo', collection: 'essentials', locked: true },
            ],
            
            // Artists database
            artists: {
                'artist_1': {
                    id: 'artist_1',
                    name: 'Sophie Martin',
                    avatar: 'ðŸ‘©â€ðŸŽ¨',
                    location: 'Paris, France',
                    bio: 'Illustratrice passionnÃ©e par la nature et les Ã©motions douces. J\'explore les formes organiques et les couleurs apaisantes pour crÃ©er des univers contemplatifs.',
                    instagram: '@sophie.creates',
                    website: 'sophiemartin.art',
                    joinedDate: '2024-03-15',
                    totalAssets: 6,
                },
                'artist_2': {
                    id: 'artist_2',
                    name: 'Lucas Bernard',
                    avatar: 'ðŸ‘¨â€ðŸŽ¨',
                    location: 'Lyon, France',
                    bio: 'Designer graphique et amoureux des nuits Ã©toilÃ©es. Je crÃ©e des assets minimalistes qui racontent des histoires silencieuses.',
                    instagram: '@lucas.designs',
                    website: 'lucasbernard.com',
                    joinedDate: '2024-04-20',
                    totalAssets: 5,
                },
                'artist_3': {
                    id: 'artist_3',
                    name: 'Emma Laurent',
                    avatar: 'ðŸ‘©â€ðŸŽ¨',
                    location: 'Bordeaux, France',
                    bio: 'Artiste autodidacte spÃ©cialisÃ©e dans l\'aquarelle digitale. Mes crÃ©ations cÃ©lÃ¨brent la beautÃ© du quotidien et les petits bonheurs.',
                    instagram: '@emmalaurent.art',
                    website: 'emmalaurent.fr',
                    joinedDate: '2024-02-10',
                    totalAssets: 6,
                },
            },
            
            // Daily wellness quotes
            dailyQuotes: [
                "Chaque jour est une page blanche, prÃªte Ã  accueillir tes pensÃ©es.",
                "L'Ã©criture est un acte de douceur envers soi-mÃªme.",
                "Tes mots ont le pouvoir de transformer ton quotidien.",
                "Prends le temps de t'Ã©couter aujourd'hui.",
                "Il n'y a pas de bonne ou mauvaise faÃ§on d'Ã©crire, juste ta faÃ§on.",
                "L'important n'est pas la perfection, mais la prÃ©sence.",
                "Ton journal est un espace sans jugement, juste pour toi.",
                "Ã‰crire, c'est crÃ©er un dialogue avec ton cÅ“ur.",
                "Chaque mot posÃ© est un pas vers la clartÃ©.",
                "Ta voix intÃ©rieure mÃ©rite d'Ãªtre entendue.",
                "L'Ã©criture est un refuge oÃ¹ tu peux Ãªtre complÃ¨tement toi.",
                "Tes pensÃ©es sont prÃ©cieuses, prends le temps de les accueillir.",
                "Il n'y a rien de trop petit ou trop grand pour Ãªtre Ã©crit.",
                "L'Ã©criture t'aide Ã  mieux comprendre qui tu es.",
                "Aujourd'hui, sois douce avec toi-mÃªme.",
            ],
            
            // Community posts (demo data)
            communityPosts: [
                {
                    id: 1,
                    username: 'Luna âœ¨',
                    avatar: 'ðŸŒ™',
                    time: 'Il y a 2h',
                    mood: { name: 'Calme', color: '#B4C7D9', emoji: 'â˜ï¸' },
                    stickers: ['ðŸŒ¸', 'ðŸŒ¿', 'â˜•'],
                    caption: 'Un dimanche doux et apaisant',
                    reactions: { love: 24, hug: 12, support: 8, beautiful: 15, wow: 5 },
                    following: false,
                },
                {
                    id: 2,
                    username: 'ChloÃ© ðŸŒ¸',
                    avatar: 'ðŸ¦‹',
                    time: 'Il y a 5h',
                    mood: { name: 'Joyeux', color: '#F4E4C1', emoji: 'ðŸ˜Š' },
                    stickers: ['ðŸŒ»', 'â­', 'ðŸ’«'],
                    caption: 'Tellement reconnaissante pour cette journÃ©e',
                    reactions: { love: 45, hug: 18, support: 6, beautiful: 32, wow: 12 },
                    following: true,
                },
                {
                    id: 3,
                    username: 'Emma ðŸ’­',
                    avatar: 'ðŸŒº',
                    time: 'Il y a 8h',
                    mood: { name: 'Paisible', color: '#C9D1BC', emoji: 'ðŸ§˜' },
                    stickers: ['ðŸƒ', 'ðŸŒ™', 'ðŸ•¯ï¸'],
                    caption: null,
                    reactions: { love: 31, hug: 9, support: 14, beautiful: 28, wow: 7 },
                    following: false,
                },
                {
                    id: 4,
                    username: 'Sofia âš¡',
                    avatar: 'âœ¨',
                    time: 'Il y a 12h',
                    mood: { name: 'Ã‰nergique', color: '#E8C5C0', emoji: 'âš¡' },
                    stickers: ['ðŸŽ¨', 'ðŸŒº', 'ðŸ¦‹'],
                    caption: 'Nouvelle semaine, nouvelle Ã©nergie !',
                    reactions: { love: 52, hug: 15, support: 22, beautiful: 38, wow: 18 },
                    following: true,
                },
                {
                    id: 5,
                    username: 'LÃ©a ðŸŒ¿',
                    avatar: 'ðŸŒ»',
                    time: 'Il y a 1j',
                    mood: { name: 'Calme', color: '#B4C7D9', emoji: 'â˜ï¸' },
                    stickers: ['ðŸ“–', 'â˜•', 'ðŸŒ¸'],
                    caption: 'Les petits moments qui comptent',
                    reactions: { love: 38, hug: 21, support: 11, beautiful: 25, wow: 9 },
                    following: false,
                },
            ],
            
            // User's own reactions to posts
            userReactions: {},
            
            // Current screen
            currentScreen: 'onboarding',
            
            // Onboarding state
            onboarding: {
                step: 1,
                purpose: null,
                frequency: null,
                reminderTime: '09:00',
            },
            
            // Journal viewer state
            viewer: {
                currentIndex: 0,
                entries: [],
                textVisible: true,
            },
            
            // Editor state
            editor: {
                currentBackground: null,
                stickers: [],
                draggedSticker: null,
            },
            
            // ============================================
            // INITIALIZATION
            // ============================================
            
            init() {
                console.log('ðŸŒ¸ YORI POC initialized');
                
                // Load from storage first
                this.loadFromStorage();
                
                // Check if collection needs initialization
                const hasPapers = this.user.collection.some(a => a.type === 'paper');
                const needsInit = this.user.collection.length === 0 || !hasPapers;
                
                if (needsInit) {
                    console.log('ðŸŽ¯ Initializing starter collection... (hasPapers:', hasPapers, ', total:', this.user.collection.length, ')');
                    this.user.collection = []; // Clear any existing
                    this.initStarterCollection();
                } else {
                    console.log('âœ… Collection already initialized:', this.user.collection.length, 'assets');
                }
                
                this.setupEventListeners();
            },
            
            initStarterCollection() {
                // Add starter assets to collection
                const starterIds = [
                    // Japan Lofi stickers (ALL 10)
                    101, 102, 103, 104, 105, 106, 107, 108, 109, 110,
                    // Dark Fantasy stickers
                    201, 204,
                    // Cottage Core stickers
                    301, 302, 304,
                    // Emotions stickers (ALL 15)
                    501, 502, 503, 504, 505, 506, 507, 508, 509, // Commons
                    510, 511, 512, // Rares
                    513, 514, 515, // LÃ©gendaires
                    // Background Papers (7 commons + 2 rares)
                    401, 402, 403, 404, 405, 406, 407, // Commons
                    408, 411, // Rares (Golden Hour + Matcha Latte)
                    // Washi (updated IDs)
                    420, 422, 424, 426, // Basic washi from each collection
                ];
                
                console.log('Available assets count:', this.availableAssets.length);
                
                starterIds.forEach(id => {
                    const asset = this.availableAssets.find(a => a.id === id);
                    if (asset) {
                        this.user.collection.push({
                            ...asset,
                            unlockedAt: new Date('2026-01-20').toISOString(),
                            timesUsed: 0
                        });
                    } else {
                        console.warn('Asset not found:', id);
                    }
                });
                
                this.saveToStorage();
                console.log('âœ… Starter collection initialized:', this.user.collection.length, 'assets');
            },
            
            loadFromStorage() {
                const stored = localStorage.getItem('yori_data');
                if (stored) {
                    const data = JSON.parse(stored);
                    this.user = { ...this.user, ...data };
                    console.log('Loaded user data:', this.user);
                }
            },
            
            saveToStorage() {
                localStorage.setItem('yori_data', JSON.stringify(this.user));
            },
            
            setupEventListeners() {
                // Auto-save journal
                const journalText = document.getElementById('journal-text');
                if (journalText) {
                    let timeout;
                    journalText.addEventListener('input', () => {
                        clearTimeout(timeout);
                        timeout = setTimeout(() => {
                            this.autoSaveJournal();
                        }, 2000);
                    });
                }
            },
            
            // ============================================
            // NAVIGATION
            // ============================================
            
            startApp() {
                this.navigateTo('home');
                
                // Give starter pack if new user
                if (this.user.collection.length === 0) {
                    this.giveStarterPack();
                }
            },
            
            // ============================================
            // ONBOARDING FLOW
            // ============================================
            
            nextOnboardingStep() {
                // Save name from step 1
                if (this.onboarding.step === 1) {
                    const nameInput = document.getElementById('onboarding-name');
                    const name = nameInput.value.trim();
                    
                    if (name) {
                        this.user.name = name;
                        this.saveToStorage();
                    } else {
                        this.user.name = 'toi'; // Fallback si pas de nom
                    }
                }
                
                this.onboarding.step++;
                document.getElementById(`onboarding-step-${this.onboarding.step - 1}`).classList.add('hidden');
                document.getElementById(`onboarding-step-${this.onboarding.step}`).classList.remove('hidden');
            },
            
            selectOnboardingChoice(type, value) {
                this.onboarding[type] = value;
                
                // Visual feedback
                const cards = document.querySelectorAll('.choice-card');
                cards.forEach(card => card.classList.remove('selected'));
                event.target.closest('.choice-card').classList.add('selected');
                
                // Auto-advance after 500ms
                setTimeout(() => {
                    this.nextOnboardingStep();
                }, 500);
            },
            
            skipReminder() {
                this.user.settings.notifications = false;
                this.completeOnboarding();
            },
            
            completeOnboarding() {
                // Save onboarding choices
                const hour = document.getElementById('reminder-hour').value;
                const minute = document.getElementById('reminder-minute').value;
                this.user.settings.notificationTime = `${hour}:${minute}`;
                
                this.user.onboardingCompleted = true;
                this.user.onboardingData = {
                    purpose: this.onboarding.purpose,
                    frequency: this.onboarding.frequency,
                    completedAt: new Date().toISOString(),
                };
                
                this.saveToStorage();
                this.startApp();
            },
            
            navigateTo(screenId) {
                // Hide all screens
                document.querySelectorAll('.screen').forEach(s => {
                    s.classList.remove('active');
                });
                
                // Show target screen
                const screen = document.getElementById(screenId + '-screen');
                if (screen) {
                    screen.classList.add('active');
                    screen.classList.add('fade-in');
                    this.currentScreen = screenId;
                    
                    // Update nav
                    this.updateNav(screenId);
                    
                    // Screen-specific actions
                    if (screenId === 'home') {
                        this.updateHomeScreen();
                    } else if (screenId === 'collection') {
                        this.renderCollection();
                    } else if (screenId === 'journal-editor') {
                        // Show inspiration prompt first, then setup editor
                        const today = this.getDateKey(new Date());
                        const todayEntry = this.user.journalEntries.find(e => 
                            this.getDateKey(new Date(e.date)) === today
                        );
                        
                        if (!todayEntry) {
                            this.showInspirationPrompt();
                            return; // Will navigate after prompt
                        } else {
                            // Already has entry, go directly to editor
                            setTimeout(() => this.setupEditorZen(), 100);
                        }
                    } else if (screenId === 'envelope-opening') {
                        this.resetEnvelopeScreen();
                    } else if (screenId === 'journal-history') {
                        this.renderJournalHistory();
                    } else if (screenId === 'pixel-year') {
                        this.renderPixelYear();
                    } else if (screenId === 'settings') {
                        this.updateSettingsUI();
                    } else if (screenId === 'wellness') {
                        this.renderWellnessDashboard();
                    } else if (screenId === 'community') {
                        this.renderCommunityFeed();
                    } else if (screenId === 'profile') {
                        this.updateProfileUI();
                    } else if (screenId === 'settings') {
                        // Redirect to profile
                        this.navigateTo('profile');
                        return;
                    }
                    
                    // Hide nav for some screens
                    const nav = document.getElementById('bottom-nav');
                    if (['envelope-opening', 'journal-editor', 'pixel-year', 'wellness'].includes(screenId)) {
                        nav.style.display = 'none';
                    } else {
                        nav.style.display = 'flex';
                    }
                }
            },
            
            updateNav(activeScreen) {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.screen === activeScreen) {
                        item.classList.add('active');
                    }
                });
            },
            
            resetEnvelopeScreen() {
                // Make sure we're in the right state
                document.getElementById('opening-phase').classList.remove('hidden');
                document.getElementById('reveal-phase').classList.add('hidden');
                const envelope = document.getElementById('opening-envelope');
                envelope.classList.remove('tearing');
            },
            
            // ============================================
            // HOME SCREEN
            // ============================================
            
            updateHomeScreen() {
                // Update name display
                const nameDisplay = document.getElementById('user-name-display');
                if (nameDisplay) {
                    nameDisplay.textContent = this.user.name || 'toi';
                }
                
                // Display daily quote
                this.displayDailyQuote();
                
                // Check if today's entry exists and show preview
                this.updateTodayEntryPreview();
                
                // Update counts
                document.getElementById('journal-count').textContent = `${this.user.journalEntries.length} pages`;
                document.getElementById('collection-count').textContent = `${this.user.collection.length} assets`;
                
                const moodsCount = Object.keys(this.user.moods).length;
                document.getElementById('mood-count').textContent = `${moodsCount} humeurs`;
                
                // Update streak
                document.getElementById('streak-display').textContent = `${this.user.streak} jours`;
                
                // Update selected mood buttons
                const today = this.getDateKey(new Date());
                const todayMood = this.user.moods[today]?.mood;
                document.querySelectorAll('.mood-quick-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                if (todayMood) {
                    const moodBtn = document.querySelector(`.mood-quick-btn[onclick*="${todayMood}"]`);
                    if (moodBtn) moodBtn.classList.add('selected');
                }
                
                // Determine envelope display mode
                const canOpen = this.canUserOpenEnvelope();
                const envelopeHero = document.getElementById('envelope-hero');
                const envelopeCompact = document.getElementById('envelope-compact-section');
                
                if (canOpen) {
                    // Show hero, hide compact
                    envelopeHero.classList.remove('hidden');
                    envelopeCompact.classList.add('hidden');
                    
                    const heroDesc = document.getElementById('envelope-hero-desc');
                    if (heroDesc) {
                        heroDesc.textContent = this.user.isPremium ? '3 nouveaux trÃ©sors pour embellir tes pages' : 'Un nouveau trÃ©sor pour embellir tes pages';
                    }
                } else {
                    // Hide hero, show compact
                    envelopeHero.classList.add('hidden');
                    envelopeCompact.classList.remove('hidden');
                    
                    // Update compact envelope status
                    const title = document.getElementById('envelope-title');
                    const desc = document.getElementById('envelope-description');
                    const countdown = document.getElementById('countdown');
                    const envelopeCard = document.getElementById('envelope-card');
                    
                    title.textContent = 'Ã€ demain';
                    desc.textContent = 'Ton prochain trÃ©sor arrive bientÃ´t';
                    countdown.classList.add('hidden');
                    envelopeCard.style.pointerEvents = 'none';
                    envelopeCard.style.opacity = '0.6';
                }
            },
            
            updateTodayEntryPreview() {
                const today = this.getDateKey(new Date());
                const todayEntry = this.user.journalEntries.find(e => 
                    this.getDateKey(new Date(e.date)) === today
                );
                
                const preview = document.getElementById('today-entry-preview');
                
                if (todayEntry) {
                    // Show preview
                    preview.classList.remove('hidden');
                    const previewText = document.getElementById('today-entry-text');
                    previewText.textContent = todayEntry.text.substring(0, 120) + (todayEntry.text.length > 120 ? '...' : '');
                    
                    // Update hero CTA to show "Continue writing"
                    const heroTitle = document.querySelector('.hero-title');
                    const heroDesc = document.querySelector('.hero-description');
                    const heroBtn = document.querySelector('.journal-hero-cta .btn-large');
                    
                    if (heroTitle) heroTitle.textContent = 'Continue ta page';
                    if (heroDesc) heroDesc.textContent = 'Tu as dÃ©jÃ  commencÃ© Ã  Ã©crire aujourd\'hui. Continue ton Ã©criture ou relis ce que tu as Ã©crit.';
                    if (heroBtn) heroBtn.innerHTML = '<span class="btn-icon">âœï¸</span>Continuer Ã  Ã©crire<span class="btn-arrow">â†’</span>';
                } else {
                    // Hide preview
                    preview.classList.add('hidden');
                    
                    // Reset hero CTA
                    const heroTitle = document.querySelector('.hero-title');
                    const heroDesc = document.querySelector('.hero-description');
                    const heroBtn = document.querySelector('.journal-hero-cta .btn-large');
                    
                    if (heroTitle) heroTitle.textContent = 'Ã‰cris ta page du jour';
                    if (heroDesc) heroDesc.textContent = 'Prends un moment pour toi. Exprime ce que tu ressens, ce que tu vis, ce dont tu rÃªves.';
                    if (heroBtn) heroBtn.innerHTML = '<span class="btn-icon">âœ¨</span>Commencer Ã  Ã©crire<span class="btn-arrow">â†’</span>';
                }
            },
            
            quickSelectMood(mood, color) {
                const today = this.getDateKey(new Date());
                this.user.moods[today] = { mood, color };
                this.saveToStorage();
                
                // Update UI
                document.querySelectorAll('.mood-quick-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                event.target.closest('.mood-quick-btn').classList.add('selected');
                
                this.showToast(`Humeur enregistrÃ©e : ${this.getMoodEmoji(mood)}`);
            },
            
            editTodayEntry() {
                this.navigateTo('journal-editor');
            },
            
            viewTodayEntry() {
                const today = this.getDateKey(new Date());
                const todayEntry = this.user.journalEntries.find(e => 
                    this.getDateKey(new Date(e.date)) === today
                );
                
                if (todayEntry) {
                    this.viewJournalEntry(todayEntry);
                }
            },
            
            displayDailyQuote() {
                // Use date as seed for consistent quote per day
                const today = new Date();
                const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
                const quoteIndex = dayOfYear % this.dailyQuotes.length;
                
                const quoteElement = document.getElementById('daily-quote');
                if (quoteElement) {
                    quoteElement.textContent = `"${this.dailyQuotes[quoteIndex]}"`;
                }
            },
            
            canUserOpenEnvelope() {
                if (!this.user.lastEnvelopeOpened) return true;
                
                const lastOpened = new Date(this.user.lastEnvelopeOpened);
                const now = new Date();
                
                return !this.isSameDay(lastOpened, now);
            },
            
            isSameDay(date1, date2) {
                return date1.getFullYear() === date2.getFullYear() &&
                       date1.getMonth() === date2.getMonth() &&
                       date1.getDate() === date2.getDate();
            },
            
            updateCountdown() {
                const countdown = document.getElementById('countdown');
                const now = new Date();
                const tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(0, 0, 0, 0);
                
                const diff = tomorrow - now;
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                countdown.textContent = `${hours}h ${minutes}min`;
                
                // Update every minute
                setTimeout(() => this.updateCountdown(), 60000);
            },
            
            canOpenEnvelope() {
                if (!this.canUserOpenEnvelope()) {
                    // Shake animation
                    const envelope = document.getElementById('envelope');
                    envelope.classList.add('shake');
                    setTimeout(() => envelope.classList.remove('shake'), 500);
                    this.showToast('Ton enveloppe s\'ouvrira demain ðŸ’Œ');
                    return;
                }
                
                this.openEnvelope();
            },
            
            // ============================================
            // ENVELOPE SYSTEM
            // ============================================
            
            openEnvelope() {
                if (!this.canUserOpenEnvelope()) {
                    this.showToast('Tu as dÃ©jÃ  ouvert ton enveloppe aujourd\'hui');
                    return;
                }
                
                // Complete "envelope" intention and award harmonie
                this.completeIntention('envelope');
                
                this.navigateTo('envelope-opening');
            },
            
            tearEnvelope() {
                const envelope = document.getElementById('opening-envelope');
                envelope.classList.add('tearing');
                
                // Show loading
                this.showLoading(true);
                
                setTimeout(() => {
                    try {
                        // Select random assets
                        const count = this.user.isPremium ? 3 : 1;
                        const newAssets = this.selectRandomAssets(count);
                        
                        // Check if we got assets
                        if (newAssets.length === 0) {
                            this.showLoading(false);
                            this.showToast('Tu as dÃ©jÃ  tous les assets ! ðŸŽ‰');
                            this.navigateTo('home');
                            return;
                        }
                        
                        // Add to collection with tracking data
                        newAssets.forEach(asset => {
                            if (!this.user.collection.find(c => c.id === asset.id)) {
                                this.user.collection.push({
                                    ...asset,
                                    unlockedAt: new Date().toISOString(),
                                    timesUsed: 0,
                                });
                            }
                        });
                        this.user.lastEnvelopeOpened = new Date().toISOString();
                        
                        // Update streak
                        this.updateStreak();
                        
                        this.saveToStorage();
                        this.showLoading(false);
                        
                        // Show reveal
                        this.showReveal(newAssets);
                    } catch (error) {
                        console.error('Error opening envelope:', error);
                        this.showLoading(false);
                        this.showToast('Une erreur est survenue ðŸ˜•');
                        this.navigateTo('home');
                    }
                }, 1200);
            },
            
            selectRandomAssets(count) {
                // Get assets not in collection
                const available = this.availableAssets.filter(asset => 
                    !this.user.collection.find(c => c.id === asset.id)
                );
                
                console.log(`Available assets: ${available.length}, Requested: ${count}`);
                
                if (available.length === 0) {
                    console.log('No more assets to unlock!');
                    return [];
                }
                
                // If not enough assets, return what we have
                if (available.length <= count) {
                    console.log('Returning all remaining assets');
                    return available;
                }
                
                // Weighted selection by rarity
                const weighted = [];
                available.forEach(asset => {
                    const weight = asset.rarity === 'common' ? 7 :
                                  asset.rarity === 'rare' ? 2 : 1;
                    for (let i = 0; i < weight; i++) {
                        weighted.push(asset);
                    }
                });
                
                // Shuffle and select unique assets
                const selected = [];
                const usedIds = new Set();
                let attempts = 0;
                const maxAttempts = 100;
                
                while (selected.length < count && attempts < maxAttempts) {
                    attempts++;
                    const randomIndex = Math.floor(Math.random() * weighted.length);
                    const asset = weighted[randomIndex];
                    
                    if (!usedIds.has(asset.id)) {
                        selected.push({ ...asset }); // Clone to avoid reference issues
                        usedIds.add(asset.id);
                    }
                }
                
                console.log(`Selected ${selected.length} assets:`, selected.map(a => a.name));
                return selected;
            },
            
            showReveal(assets) {
                if (!assets || assets.length === 0) {
                    console.error('No assets to reveal!');
                    this.navigateTo('home');
                    return;
                }
                
                document.getElementById('opening-phase').classList.add('hidden');
                const revealPhase = document.getElementById('reveal-phase');
                revealPhase.classList.remove('hidden');
                
                const container = document.getElementById('revealed-assets');
                container.innerHTML = '';
                
                assets.forEach((asset, index) => {
                    const card = document.createElement('div');
                    card.className = 'asset-card';
                    card.innerHTML = `
                        <div class="rarity-badge rarity-${asset.rarity}">${asset.rarity.toUpperCase()}</div>
                        <div class="asset-visual">${asset.icon}</div>
                        <h3>${asset.name}</h3>
                        <p class="asset-artist">Par ${asset.artist}</p>
                    `;
                    container.appendChild(card);
                });
            },
            
            updateStreak() {
                // Simplified streak logic
                this.user.streak++;
                
                // Update streak display if element exists
                const streakBadge = document.getElementById('streak-badge');
                if (streakBadge) {
                    streakBadge.textContent = `ðŸ”¥ ${this.user.streak} jour${this.user.streak > 1 ? 's' : ''} d'affilÃ©e`;
                }
                
                // Update streak in home screen
                const streakDisplay = document.getElementById('streak-display');
                if (streakDisplay) {
                    streakDisplay.textContent = `${this.user.streak} jours`;
                }
            },
            
            giveStarterPack() {
                const starter = this.selectRandomAssets(10);
                
                // Add proper tracking data
                starter.forEach(asset => {
                    if (!this.user.collection.find(c => c.id === asset.id)) {
                        this.user.collection.push({
                            ...asset,
                            unlockedAt: new Date().toISOString(),
                            timesUsed: 0,
                        });
                    }
                });
                
                // Add demo journal entries
                this.generateDemoData();
                
                this.saveToStorage();
                this.showToast('ðŸŽ 10 trÃ©sors de bienvenue dÃ©bloquÃ©s !');
            },
            
            generateDemoData() {
                // Generate some demo journal entries and moods for the past week
                const moods = ['calm', 'happy', 'sad', 'energetic', 'peaceful', 'anxious'];
                const colors = ['#B4C7D9', '#F4E4C1', '#D1C9D9', '#E8C5C0', '#C9D1BC', '#DDDAD3'];
                
                for (let i = 7; i > 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateKey = this.getDateKey(date);
                    
                    // Add mood
                    const randomMood = moods[Math.floor(Math.random() * moods.length)];
                    const randomColor = colors[moods.indexOf(randomMood)];
                    this.user.moods[dateKey] = { mood: randomMood, color: randomColor };
                    
                    // Add journal entry (every other day)
                    if (i % 2 === 0) {
                        const demoTexts = [
                            "Aujourd'hui Ã©tait une journÃ©e douce. J'ai pris le temps de me poser avec un thÃ© et mes pensÃ©es.",
                            "Sentiment d'accomplissement aprÃ¨s avoir terminÃ© ce projet. Je suis fiÃ¨re de moi.",
                            "Un peu anxieuse ces derniers temps, mais l'Ã©criture m'aide Ã  mettre les choses en perspective.",
                            "Belle balade en forÃªt ce matin. La nature a ce pouvoir d'apaiser mon esprit.",
                        ];
                        
                        this.user.journalEntries.push({
                            id: Date.now() - (i * 100000),
                            date: date.toISOString(),
                            text: demoTexts[Math.floor(Math.random() * demoTexts.length)],
                            background: null,
                            mood: { mood: randomMood, color: randomColor },
                            stickers: [],
                        });
                    }
                }
            },
            
            // ============================================
            // JOURNAL EDITOR
            // ============================================
            
            setupEditor() {
                this.renderPalette();
                this.setupCanvasDragDrop();
                
                // Reset toolbar state
                this.editor.textStyle = 'handwritten';
                this.editor.textSize = 'medium';
                this.editor.currentFilter = 'all';
                
                // Load last entry if exists
                const lastEntry = this.user.journalEntries[this.user.journalEntries.length - 1];
                if (lastEntry && this.isSameDay(new Date(lastEntry.date), new Date())) {
                    document.getElementById('journal-text').value = lastEntry.text;
                    if (lastEntry.background) {
                        this.setCanvasBackground(lastEntry.background);
                    }
                    // Restore stickers
                    if (lastEntry.stickers) {
                        lastEntry.stickers.forEach(sticker => {
                            this.addStickerToCanvas(sticker.icon, sticker.x, sticker.y);
                        });
                    }
                }
            },
            
            // Text formatting functions
            changeTextStyle(style) {
                const textarea = document.getElementById('journal-text');
                const styles = {
                    'handwritten': { fontFamily: 'var(--font-handwritten)', fontSize: '18px' },
                    'typed': { fontFamily: 'Courier, monospace', fontSize: '15px' },
                    'elegant': { fontFamily: 'var(--font-display)', fontSize: '16px' },
                };
                
                if (styles[style]) {
                    textarea.style.fontFamily = styles[style].fontFamily;
                    textarea.style.fontSize = styles[style].fontSize;
                    this.editor.textStyle = style;
                }
                
                // Update active button
                document.querySelectorAll('.toolbar-btn').forEach(btn => btn.classList.remove('active'));
                event.target.closest('.toolbar-btn').classList.add('active');
            },
            
            changeTextSize(size) {
                const textarea = document.getElementById('journal-text');
                const sizes = {
                    'small': '14px',
                    'medium': '18px',
                    'large': '22px',
                };
                
                if (sizes[size]) {
                    textarea.style.fontSize = sizes[size];
                    this.editor.textSize = size;
                }
                
                // Update active button
                document.querySelectorAll('.toolbar-btn').forEach(btn => btn.classList.remove('active'));
                event.target.closest('.toolbar-btn').classList.add('active');
            },
            
            toggleTextDecoration(decoration) {
                const textarea = document.getElementById('journal-text');
                const currentStyle = window.getComputedStyle(textarea);
                
                if (decoration === 'bold') {
                    textarea.style.fontWeight = currentStyle.fontWeight === 'bold' ? 'normal' : 'bold';
                } else if (decoration === 'italic') {
                    textarea.style.fontStyle = currentStyle.fontStyle === 'italic' ? 'normal' : 'italic';
                } else if (decoration === 'underline') {
                    textarea.style.textDecoration = currentStyle.textDecoration.includes('underline') ? 'none' : 'underline';
                }
                
                event.target.closest('.toolbar-btn').classList.toggle('active');
            },
            
            addPhoto() {
                // Simulate photo picker
                const photos = ['ðŸ“¸', 'ðŸ–¼ï¸', 'ðŸŒ…', 'ðŸŒƒ', 'ðŸžï¸'];
                const randomPhoto = photos[Math.floor(Math.random() * photos.length)];
                this.addStickerToCanvas(randomPhoto, Math.random() * 200 + 50, Math.random() * 200 + 50);
                this.showToast('Photo ajoutÃ©e ! (demo)');
            },
            
            showLockedFeature(feature) {
                const featureNames = {
                    'paper': 'Papiers de fond',
                    'washi': 'Washi tapes',
                    'frame': 'Cadres photo',
                    'drawing': 'Outils de dessin',
                };
                this.showToast(`${featureNames[feature]} disponible en Premium âœ¨`);
                setTimeout(() => {
                    if (confirm(`${featureNames[feature]} est disponible en Premium. DÃ©couvrir ?`)) {
                        this.showPaywall();
                    }
                }, 1000);
            },
            
            togglePalette() {
                const palette = document.querySelector('.asset-palette');
                const icon = document.getElementById('palette-toggle-icon');
                palette.classList.toggle('palette-collapsed');
                icon.textContent = palette.classList.contains('palette-collapsed') ? '+' : 'âˆ’';
            },
            
            filterPaletteByType(type) {
                this.editor.currentFilter = type;
                
                // Update active tab
                document.querySelectorAll('.palette-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`.palette-tab[data-type="${type}"]`).classList.add('active');
                
                // Re-render palette
                this.renderPalette(type);
            },
            
            renderPalette(filterType = 'all') {
                const grid = document.getElementById('palette-grid');
                grid.innerHTML = '';
                
                let assetsToShow = this.user.collection;
                
                // Filter by type
                if (filterType !== 'all') {
                    assetsToShow = assetsToShow.filter(a => a.type === filterType);
                }
                
                if (assetsToShow.length === 0) {
                    grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: rgba(61, 52, 40, 0.5); font-size: 13px; padding: var(--space-lg);">Aucun asset de ce type</p>';
                    return;
                }
                
                assetsToShow.forEach(asset => {
                    const item = document.createElement('div');
                    item.className = 'palette-item';
                    item.textContent = asset.icon;
                    item.draggable = true;
                    item.dataset.assetId = asset.id;
                    item.title = asset.name;
                    
                    item.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('assetId', asset.id);
                        e.dataTransfer.setData('icon', asset.icon);
                    });
                    
                    item.addEventListener('click', () => {
                        this.addStickerToCanvas(asset.icon);
                        
                        // Increment usage count
                        const userAsset = this.user.collection.find(a => a.id === asset.id);
                        if (userAsset) {
                            userAsset.timesUsed = (userAsset.timesUsed || 0) + 1;
                            this.saveToStorage();
                        }
                    });
                    
                    grid.appendChild(item);
                });
            },
            
            setupCanvasDragDrop() {
                const canvas = document.getElementById('canvas');
                
                canvas.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });
                
                canvas.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const icon = e.dataTransfer.getData('icon');
                    if (icon) {
                        const rect = canvas.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        this.addStickerToCanvas(icon, x, y);
                    }
                });
            },
            
            addStickerToCanvas(icon, x = null, y = null) {
                const canvas = document.getElementById('canvas-stickers');
                const sticker = document.createElement('div');
                sticker.className = 'sticker';
                sticker.textContent = icon;
                sticker.style.fontSize = '40px';
                sticker.style.left = (x || Math.random() * 200 + 50) + 'px';
                sticker.style.top = (y || Math.random() * 200 + 50) + 'px';
                
                // Make draggable
                this.makeDraggable(sticker);
                
                // Double-tap to remove
                let tapCount = 0;
                sticker.addEventListener('click', () => {
                    tapCount++;
                    if (tapCount === 2) {
                        sticker.remove();
                        tapCount = 0;
                    }
                    setTimeout(() => tapCount = 0, 300);
                });
                
                canvas.appendChild(sticker);
            },
            
            makeDraggable(element) {
                let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                
                element.onmousedown = dragMouseDown;
                element.ontouchstart = dragTouchStart;
                
                function dragMouseDown(e) {
                    e.preventDefault();
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    document.onmouseup = closeDragElement;
                    document.onmousemove = elementDrag;
                    element.classList.add('dragging');
                }
                
                function dragTouchStart(e) {
                    pos3 = e.touches[0].clientX;
                    pos4 = e.touches[0].clientY;
                    document.ontouchend = closeDragElement;
                    document.ontouchmove = elementTouchDrag;
                    element.classList.add('dragging');
                }
                
                function elementDrag(e) {
                    e.preventDefault();
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    element.style.top = (element.offsetTop - pos2) + "px";
                    element.style.left = (element.offsetLeft - pos1) + "px";
                }
                
                function elementTouchDrag(e) {
                    pos1 = pos3 - e.touches[0].clientX;
                    pos2 = pos4 - e.touches[0].clientY;
                    pos3 = e.touches[0].clientX;
                    pos4 = e.touches[0].clientY;
                    element.style.top = (element.offsetTop - pos2) + "px";
                    element.style.left = (element.offsetLeft - pos1) + "px";
                }
                
                function closeDragElement() {
                    document.onmouseup = null;
                    document.onmousemove = null;
                    document.ontouchend = null;
                    document.ontouchmove = null;
                    element.classList.remove('dragging');
                }
            },
            
            setCanvasBackground(bg) {
                const canvas = document.getElementById('canvas-background');
                // Simplified: just set color
                const colors = ['#F4E4C1', '#E8C5C0', '#C9D1BC', '#D1C9D9', '#B4C7D9'];
                canvas.style.background = colors[Math.floor(Math.random() * colors.length)];
                this.editor.currentBackground = bg;
            },
            
            showBackgroundPicker() {
                // Simplified: random background
                this.setCanvasBackground('random');
                this.showToast('Fond changÃ© ! ðŸŽ¨');
            },
            
            saveJournalEntry() {
                const text = document.getElementById('journal-text').value;
                
                if (!text.trim()) {
                    this.showToast('Ã‰cris quelque chose d\'abord ðŸ“');
                    return;
                }
                
                // Get stickers from canvas (both old and zen styles)
                const stickerElements = document.querySelectorAll('.sticker, .sticker-zen');
                const stickers = Array.from(stickerElements).map(el => {
                    const icon = el.querySelector('.sticker-zen-icon') ? 
                        el.querySelector('.sticker-zen-icon').textContent || el.querySelector('.sticker-zen-icon img')?.src :
                        el.textContent;
                    return {
                        icon: icon,
                        x: parseInt(el.style.left) || 0,
                        y: parseInt(el.style.top) || 0,
                    };
                });
                
                const today = this.getDateKey(new Date());
                
                const entry = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    text: text,
                    background: this.editor.currentBackground,
                    mood: this.user.moods[today] || null,
                    stickers: stickers,
                };
                
                // Remove today's entry if exists
                this.user.journalEntries = this.user.journalEntries.filter(e => 
                    !this.isSameDay(new Date(e.date), new Date())
                );
                
                this.user.journalEntries.push(entry);
                
                // Complete "write" intention and award harmonie
                this.completeIntention('write');
                
                this.saveToStorage();
                
                // Show celebration modal instead of just toast
                this.showCelebrationModal();
            },
            
            // ============================================
            // ZEN EDITOR FUNCTIONS
            // ============================================
            
            setupEditorZen() {
                const textarea = document.getElementById('journal-text');
                
                // Update date badge
                const dateDisplay = document.getElementById('editor-date');
                if (dateDisplay) {
                    const today = new Date();
                    const options = { weekday: 'long', day: 'numeric', month: 'long' };
                    dateDisplay.textContent = today.toLocaleDateString('fr-FR', options);
                }
                
                // Load today's entry if exists
                const today = this.getDateKey(new Date());
                const todayEntry = this.user.journalEntries.find(e => 
                    this.getDateKey(new Date(e.date)) === today
                );
                
                if (todayEntry) {
                    textarea.value = todayEntry.text;
                    
                    // Restore background
                    if (todayEntry.background) {
                        this.changeBackgroundZen(todayEntry.background);
                    }
                    
                    // Restore stickers
                    if (todayEntry.stickers) {
                        todayEntry.stickers.forEach(sticker => {
                            this.addStickerToCanvasZen(sticker.icon, sticker.x, sticker.y);
                        });
                    }
                }
                
                // Update placeholder based on mood
                const todayMood = this.user.moods[today];
                if (todayMood) {
                    this.updatePlaceholderForMood(todayMood.mood);
                    const moodIcon = document.getElementById('current-mood-icon-zen');
                    if (moodIcon) moodIcon.textContent = todayMood.emoji || 'ðŸ˜Š';
                }
                
                // Setup word count
                this.updateWordCount();
                textarea.addEventListener('input', () => this.updateWordCount());
                
                // Setup auto-save (every 3 seconds)
                this.startAutoSave();
                
                // Setup toolbar hide on typing
                this.setupToolbarHiding();
            },
            
            updateWordCount() {
                const textarea = document.getElementById('journal-text');
                const wordCountEl = document.getElementById('word-count-zen');
                if (!textarea || !wordCountEl) return;
                
                const text = textarea.value.trim();
                const words = text ? text.split(/\s+/).length : 0;
                wordCountEl.textContent = `${words} mot${words > 1 ? 's' : ''}`;
            },
            
            startAutoSave() {
                // Clear any existing interval
                if (this.autoSaveInterval) clearInterval(this.autoSaveInterval);
                
                this.autoSaveInterval = setInterval(() => {
                    const text = document.getElementById('journal-text')?.value;
                    if (text && text.trim()) {
                        this.autoSaveEntry();
                    }
                }, 3000);
            },
            
            autoSaveEntry() {
                const indicator = document.getElementById('autosave-indicator');
                if (indicator) {
                    indicator.classList.add('show');
                    setTimeout(() => indicator.classList.remove('show'), 2000);
                }
                // Note: Actual save happens on exit to avoid performance issues
            },
            
            setupToolbarHiding() {
                const textarea = document.getElementById('journal-text');
                const toolbar = document.getElementById('editor-toolbar-floating');
                let typingTimer;
                
                if (!textarea || !toolbar) return;
                
                textarea.addEventListener('input', () => {
                    // Hide toolbar while typing
                    toolbar.classList.add('hidden');
                    
                    // Show again after 2 seconds of no typing
                    clearTimeout(typingTimer);
                    typingTimer = setTimeout(() => {
                        toolbar.classList.remove('hidden');
                    }, 2000);
                });
            },
            
            updatePlaceholderForMood(mood) {
                const textarea = document.getElementById('journal-text');
                if (!textarea) return;
                
                const placeholders = {
                    calm: 'Laisse tes pensÃ©es couler doucement...',
                    happy: 'Qu\'est-ce qui t\'a fait sourire aujourd\'hui ?',
                    sad: 'Prends le temps d\'accueillir ce que tu ressens...',
                    energetic: 'Ton Ã©nergie dÃ©borde ! Raconte-moi tout...',
                    peaceful: 'Dans ce moment de paix, que ressens-tu ?',
                    anxious: 'DÃ©pose ici ce qui t\'inquiÃ¨te, sans jugement...',
                };
                
                textarea.placeholder = placeholders[mood] || placeholders.calm;
            },
            
            exitEditor() {
                // Stop auto-save
                if (this.autoSaveInterval) {
                    clearInterval(this.autoSaveInterval);
                    this.autoSaveInterval = null;
                }
                
                // Save if there's content
                const text = document.getElementById('journal-text')?.value;
                if (text && text.trim()) {
                    // Silent save without celebration
                    this.silentSaveEntry();
                }
                
                // Clear any selected stickers
                document.querySelectorAll('.sticker-zen.selected').forEach(s => s.classList.remove('selected'));
                
                this.navigateTo('home');
            },
            
            saveAndExitEditor() {
                // Close all modals first
                this.closeStickerPicker();
                this.closeBackgroundPicker();
                this.closeMoodPicker();
                
                // Stop auto-save
                if (this.autoSaveInterval) {
                    clearInterval(this.autoSaveInterval);
                    this.autoSaveInterval = null;
                }
                
                this.saveJournalEntry();
            },
            
            silentSaveEntry() {
                const text = document.getElementById('journal-text').value;
                if (!text.trim()) return;
                
                const stickerElements = document.querySelectorAll('.sticker-zen');
                const stickers = Array.from(stickerElements).map(el => {
                    const iconEl = el.querySelector('.sticker-zen-icon');
                    const icon = iconEl.querySelector('img')?.src || iconEl.textContent;
                    return {
                        icon: icon,
                        x: parseInt(el.style.left) || 0,
                        y: parseInt(el.style.top) || 0,
                    };
                });
                
                const today = this.getDateKey(new Date());
                
                const entry = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    text: text,
                    background: this.editor.currentBackground,
                    mood: this.user.moods[today] || null,
                    stickers: stickers,
                };
                
                this.user.journalEntries = this.user.journalEntries.filter(e => 
                    !this.isSameDay(new Date(e.date), new Date())
                );
                
                this.user.journalEntries.push(entry);
                this.saveToStorage();
            },
            
            // ============================================
            // STICKER PICKER
            // ============================================
            
            openStickerPicker() {
                document.getElementById('sticker-picker-modal-zen').classList.add('active');
                this.renderStickerPickerZen();
            },
            
            closeStickerPicker() {
                document.getElementById('sticker-picker-modal-zen').classList.remove('active');
            },
            
            closeStickerPickerIfOverlay(event) {
                // Only close if clicking directly on overlay, not on bottom sheet
                if (event.target.id === 'sticker-picker-modal-zen') {
                    this.closeStickerPicker();
                }
            },
            
            renderStickerPickerZen() {
                const grid = document.getElementById('stickers-grid-zen');
                if (!grid) return;
                
                grid.innerHTML = '';
                
                // Filter only stickers from user collection
                const stickers = this.user.collection.filter(asset => asset.type === 'sticker');
                
                if (stickers.length === 0) {
                    grid.innerHTML = '<p style="text-align: center; color: rgba(61,52,40,0.5); grid-column: 1/-1;">Ouvre des enveloppes pour dÃ©bloquer des stickers ! ðŸ’Œ</p>';
                    return;
                }
                
                stickers.forEach(sticker => {
                    const item = document.createElement('div');
                    item.className = 'sticker-picker-item';
                    
                    const isImage = sticker.icon.startsWith('http');
                    item.innerHTML = isImage ? 
                        `<img src="${sticker.icon}" alt="${sticker.name}">` : 
                        sticker.icon;
                    
                    item.onclick = () => {
                        this.addStickerToCanvasZen(sticker.icon);
                        this.closeStickerPicker();
                    };
                    
                    grid.appendChild(item);
                });
            },
            
            addStickerToCanvasZen(icon, x = null, y = null) {
                const layer = document.getElementById('stickers-layer-zen');
                if (!layer) return;
                
                const sticker = document.createElement('div');
                sticker.className = 'sticker-zen';
                
                // Random position if not specified
                const posX = x !== null ? x : Math.random() * (window.innerWidth - 100);
                const posY = y !== null ? y : Math.random() * 300 + 100;
                
                sticker.style.left = posX + 'px';
                sticker.style.top = posY + 'px';
                
                const isImage = icon && icon.startsWith('http');
                
                sticker.innerHTML = `
                    <div class="sticker-zen-icon">
                        ${isImage ? `<img src="${icon}" style="width: 48px; height: 48px; object-fit: contain;">` : icon}
                    </div>
                    <button class="sticker-zen-delete" onclick="app.deleteStickerZen(this, event)">âœ•</button>
                `;
                
                // Make draggable
                this.makeElementDraggable(sticker);
                
                // Select on click
                sticker.onclick = (e) => {
                    if (e.target.classList.contains('sticker-zen-delete')) return;
                    document.querySelectorAll('.sticker-zen').forEach(s => s.classList.remove('selected'));
                    sticker.classList.add('selected');
                };
                
                layer.appendChild(sticker);
                
                // Animate in
                setTimeout(() => sticker.style.opacity = '1', 10);
            },
            
            deleteStickerZen(button, event) {
                if (event) event.stopPropagation();
                const sticker = button.closest('.sticker-zen');
                if (sticker) {
                    sticker.style.transform = 'scale(0)';
                    sticker.style.opacity = '0';
                    setTimeout(() => sticker.remove(), 200);
                }
            },
            
            makeElementDraggable(element) {
                let isDragging = false;
                let hasMoved = false;
                let currentX;
                let currentY;
                let initialX;
                let initialY;
                
                element.addEventListener('mousedown', dragStart);
                element.addEventListener('touchstart', dragStart, { passive: false });
                
                function dragStart(e) {
                    if (e.target.classList.contains('sticker-zen-delete')) return;
                    
                    hasMoved = false;
                    
                    if (e.type === 'touchstart') {
                        initialX = e.touches[0].clientX - element.offsetLeft;
                        initialY = e.touches[0].clientY - element.offsetTop;
                    } else {
                        initialX = e.clientX - element.offsetLeft;
                        initialY = e.clientY - element.offsetTop;
                    }
                    
                    isDragging = true;
                    element.style.cursor = 'grabbing';
                    
                    document.addEventListener('mousemove', drag);
                    document.addEventListener('touchmove', drag, { passive: false });
                    document.addEventListener('mouseup', dragEnd);
                    document.addEventListener('touchend', dragEnd);
                }
                
                function drag(e) {
                    if (!isDragging) return;
                    
                    e.preventDefault();
                    hasMoved = true;
                    
                    if (e.type === 'touchmove') {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }
                    
                    element.style.left = currentX + 'px';
                    element.style.top = currentY + 'px';
                }
                
                function dragEnd() {
                    isDragging = false;
                    element.style.cursor = 'move';
                    
                    document.removeEventListener('mousemove', drag);
                    document.removeEventListener('touchmove', drag);
                    document.removeEventListener('mouseup', dragEnd);
                    document.removeEventListener('touchend', dragEnd);
                }
            },
            
            // ============================================
            // BACKGROUND PICKER
            // ============================================
            
            openBackgroundPicker() {
                document.getElementById('background-picker-modal-zen').classList.add('active');
                this.renderBackgroundPickerZen();
            },
            
            closeBackgroundPicker() {
                document.getElementById('background-picker-modal-zen').classList.remove('active');
            },
            
            closeBackgroundPickerIfOverlay(event) {
                // Only close if clicking directly on overlay, not on bottom sheet
                if (event.target.id === 'background-picker-modal-zen') {
                    this.closeBackgroundPicker();
                }
            },
            
            renderBackgroundPickerZen() {
                const carousel = document.getElementById('backgrounds-carousel-zen');
                if (!carousel) return;
                
                // Get all paper backgrounds from user collection
                const papers = this.user.collection.filter(asset => asset.type === 'paper');
                
                if (papers.length === 0) {
                    carousel.innerHTML = '<p style="text-align: center; color: rgba(61,52,40,0.5); padding: var(--space-xl);">Aucun fond disponible</p>';
                    return;
                }
                
                carousel.innerHTML = papers.map(paper => {
                    const isActive = this.editor.currentBackground === paper.id;
                    const isImage = paper.icon && paper.icon.startsWith('http');
                    
                    return `
                        <div class="background-option-zen ${isActive ? 'active' : ''}"
                             style="background-image: url('${isImage ? paper.icon : ''}'); background-size: cover; background-position: center;"
                             onclick="app.changeBackgroundZen(${paper.id})">
                            ${!isImage ? paper.icon : ''}
                        </div>
                    `;
                }).join('');
            },
            
            changeBackgroundZen(paperId) {
                // Find the paper asset
                const paper = this.user.collection.find(a => a.id === paperId);
                if (!paper) {
                    console.warn('Paper not found:', paperId);
                    return;
                }
                
                const bg = document.getElementById('canvas-background-zen');
                if (!bg) {
                    console.warn('canvas-background-zen not found');
                    return;
                }
                
                const isImage = paper.icon && paper.icon.startsWith('http');
                
                console.log('Applying background:', paper.name, isImage ? 'IMAGE' : 'EMOJI');
                
                if (isImage) {
                    // Clear any previous background color
                    bg.style.backgroundColor = 'transparent';
                    
                    // Apply image as background
                    bg.style.backgroundImage = `url('${paper.icon}')`;
                    bg.style.backgroundSize = 'cover';
                    bg.style.backgroundPosition = 'center';
                    bg.style.backgroundRepeat = 'no-repeat';
                } else {
                    // Fallback to white if emoji
                    bg.style.backgroundColor = '#FFFFFF';
                    bg.style.backgroundImage = 'none';
                }
                
                this.editor.currentBackground = paperId;
                
                // Re-render picker to update active state
                this.renderBackgroundPickerZen();
                this.closeBackgroundPicker();
            },
            
            // ============================================
            // MOOD PICKER
            // ============================================
            
            openMoodPicker() {
                document.getElementById('mood-picker-modal-zen').classList.add('active');
            },
            
            closeMoodPicker() {
                document.getElementById('mood-picker-modal-zen').classList.remove('active');
            },
            
            closeMoodPickerIfOverlay(event) {
                // Only close if clicking directly on overlay, not on bottom sheet
                if (event.target.id === 'mood-picker-modal-zen') {
                    this.closeMoodPicker();
                }
            },
            
            selectEditorMood(mood, color, emoji) {
                const today = this.getDateKey(new Date());
                
                this.user.moods[today] = {
                    mood: mood,
                    color: color,
                    emoji: emoji,
                };
                
                // Update icon in toolbar
                const moodIcon = document.getElementById('current-mood-icon-zen');
                if (moodIcon) moodIcon.textContent = emoji;
                
                // Update placeholder
                this.updatePlaceholderForMood(mood);
                
                this.saveToStorage();
                this.closeMoodPicker();
                this.showToast(`Humeur enregistrÃ©e : ${emoji}`);
            },
            
            // ============================================
            // CELEBRATION MODAL
            // ============================================
            
            showCelebrationModal() {
                document.getElementById('celebration-streak').textContent = this.user.streak;
                document.getElementById('celebration-total').textContent = this.user.journalEntries.length;
                
                document.getElementById('celebration-modal').classList.add('active');
            },
            
            closeCelebrationToHome() {
                document.getElementById('celebration-modal').classList.remove('active');
                this.navigateTo('home');
            },
            
            closeCelebrationAndExplore() {
                document.getElementById('celebration-modal').classList.remove('active');
                this.navigateTo('community');
            },
            
            shareToCommunityFromCelebration() {
                document.getElementById('celebration-modal').classList.remove('active');
                this.showShareModal();
                this.showToast('Partage ta crÃ©ation avec la communautÃ© ! ðŸ’«');
            },
            
            // ============================================
            // COMMUNITY FEED
            // ============================================
            
            filterFeed(filter) {
                document.querySelectorAll('.feed-filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                
                this.renderCommunityFeed(filter);
            },
            
            renderCommunityFeed(filter = 'all') {
                const container = document.getElementById('feed-content');
                let posts = [...this.communityPosts];
                
                // Filter logic
                if (filter === 'following') {
                    posts = posts.filter(p => p.following);
                } else if (filter === 'popular') {
                    posts.sort((a, b) => {
                        const aTotal = Object.values(a.reactions).reduce((sum, val) => sum + val, 0);
                        const bTotal = Object.values(b.reactions).reduce((sum, val) => sum + val, 0);
                        return bTotal - aTotal;
                    });
                }
                
                if (posts.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: var(--space-2xl); color: rgba(61, 52, 40, 0.5);">
                            <p style="font-size: 48px; margin-bottom: var(--space-md);">ðŸ’«</p>
                            <p>Aucune publication pour l'instant</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = posts.map(post => this.renderPost(post)).join('');
            },
            
            renderPost(post) {
                const userReaction = this.userReactions[post.id];
                
                return `
                    <div class="feed-post">
                        <div class="post-header">
                            <div class="post-avatar">${post.avatar}</div>
                            <div class="post-user-info">
                                <div class="post-username">${post.username}</div>
                                <div class="post-time">${post.time}</div>
                            </div>
                            <button class="post-follow-btn ${post.following ? 'following' : ''}" 
                                    onclick="app.toggleFollow(${post.id})">
                                ${post.following ? 'AbonnÃ©' : 'Suivre'}
                            </button>
                        </div>
                        
                        <div class="post-image">
                            ${post.mood ? `<div class="post-mood-badge" style="background: ${post.mood.color};">
                                ${post.mood.emoji} ${post.mood.name}
                            </div>` : ''}
                            <div style="font-size: 48px; display: flex; gap: 16px;">
                                ${post.stickers.map(s => `<span>${s}</span>`).join('')}
                            </div>
                        </div>
                        
                        ${post.caption ? `<div class="post-caption">${post.caption}</div>` : ''}
                        
                        <div class="post-reactions">
                            <button class="reaction-btn ${userReaction === 'love' ? 'reacted' : ''}" 
                                    onclick="app.reactToPost(${post.id}, 'love')">
                                <span class="reaction-emoji">ðŸ’–</span>
                                <span class="reaction-count">${post.reactions.love}</span>
                            </button>
                            <button class="reaction-btn ${userReaction === 'hug' ? 'reacted' : ''}" 
                                    onclick="app.reactToPost(${post.id}, 'hug')">
                                <span class="reaction-emoji">ðŸ«‚</span>
                                <span class="reaction-count">${post.reactions.hug}</span>
                            </button>
                            <button class="reaction-btn ${userReaction === 'support' ? 'reacted' : ''}" 
                                    onclick="app.reactToPost(${post.id}, 'support')">
                                <span class="reaction-emoji">ðŸ’ª</span>
                                <span class="reaction-count">${post.reactions.support}</span>
                            </button>
                            <button class="reaction-btn ${userReaction === 'beautiful' ? 'reacted' : ''}" 
                                    onclick="app.reactToPost(${post.id}, 'beautiful')">
                                <span class="reaction-emoji">âœ¨</span>
                                <span class="reaction-count">${post.reactions.beautiful}</span>
                            </button>
                            <button class="reaction-btn ${userReaction === 'wow' ? 'reacted' : ''}" 
                                    onclick="app.reactToPost(${post.id}, 'wow')">
                                <span class="reaction-emoji">ðŸ˜</span>
                                <span class="reaction-count">${post.reactions.wow}</span>
                            </button>
                        </div>
                    </div>
                `;
            },
            
            reactToPost(postId, reactionType) {
                const post = this.communityPosts.find(p => p.id === postId);
                if (!post) return;
                
                const previousReaction = this.userReactions[postId];
                
                // Remove previous reaction
                if (previousReaction) {
                    post.reactions[previousReaction]--;
                    this.user.totalReactions--;
                }
                
                // Toggle or add new reaction
                if (previousReaction === reactionType) {
                    delete this.userReactions[postId];
                } else {
                    this.userReactions[postId] = reactionType;
                    post.reactions[reactionType]++;
                    this.user.totalReactions++;
                    
                    // Award harmonie for sending light
                    this.completeIntention('react');
                }
                
                this.saveToStorage();
                this.renderCommunityFeed();
                
                // Haptic feedback simulation
                if (this.userReactions[postId]) {
                    // Don't show toast here, completeIntention already does
                }
            },
            
            toggleFollow(postId) {
                const post = this.communityPosts.find(p => p.id === postId);
                if (!post) return;
                
                post.following = !post.following;
                this.saveToStorage();
                this.renderCommunityFeed();
                
                this.showToast(post.following ? `Tu suis maintenant ${post.username}` : `Tu ne suis plus ${post.username}`);
            },
            
            // ============================================
            // HARMONIE / LEVEL SYSTEM
            // ============================================
            
            getLevelRequirement(level) {
                // Progressive difficulty curve
                // Levels 1-5: Fast (100, 200, 300, 400, 500)
                // Levels 6+: Slower (600, 750, 900, 1100, 1300...)
                if (level <= 5) {
                    return level * 100;
                }
                return 500 + ((level - 5) * 150);
            },
            
            addHarmonie(amount, reason) {
                this.user.harmonie += amount;
                
                // Check for level up
                const currentLevel = this.user.level;
                const requiredForNext = this.getLevelRequirement(currentLevel + 1);
                
                if (this.user.harmonie >= requiredForNext) {
                    this.user.level++;
                    this.user.harmonie -= requiredForNext; // Carry over excess
                    this.showLevelUpModal(this.user.level);
                } else {
                    // Just show harmonie gain toast
                    this.showToast(`+${amount} Harmonie ðŸŒ¸`);
                }
                
                this.saveToStorage();
                this.updateProfileUI();
            },
            
            showLevelUpModal(newLevel) {
                document.getElementById('levelup-number').textContent = newLevel;
                document.getElementById('levelup-modal').classList.add('active');
            },
            
            closeLevelUpAndClaim() {
                document.getElementById('levelup-modal').classList.remove('active');
                // Force open envelope (level up reward)
                this.user.lastEnvelopeOpened = null; // Reset to allow opening
                this.navigateTo('envelope-opening');
                this.showToast('Ton cadeau de niveau t\'attend ! ðŸ’Œ');
            },
            
            resetDailyIntentions() {
                const today = this.getDateKey(new Date());
                
                if (this.user.dailyIntentions.date !== today) {
                    this.user.dailyIntentions = {
                        date: today,
                        write: false,
                        envelope: false,
                        reactCount: 0,
                    };
                    this.saveToStorage();
                }
            },
            
            completeIntention(type) {
                this.resetDailyIntentions();
                
                if (type === 'write' && !this.user.dailyIntentions.write) {
                    this.user.dailyIntentions.write = true;
                    this.addHarmonie(50, 'DÃ©poser une pensÃ©e');
                } else if (type === 'envelope' && !this.user.dailyIntentions.envelope) {
                    this.user.dailyIntentions.envelope = true;
                    this.addHarmonie(20, 'Accueillir son cadeau');
                } else if (type === 'react') {
                    this.user.dailyIntentions.reactCount++;
                    
                    // Award harmonie for every 3 reactions
                    if (this.user.dailyIntentions.reactCount % 3 === 0) {
                        this.addHarmonie(30, 'Envoyer de la lumiÃ¨re');
                    } else {
                        // Small harmonie for single reaction
                        this.addHarmonie(10, 'LumiÃ¨re envoyÃ©e');
                    }
                }
                
                this.saveToStorage();
                this.updateProfileUI();
            },
            
            updateProfileUI() {
                // Update level badge
                const levelBadge = document.getElementById('profile-level');
                if (levelBadge) levelBadge.textContent = `Niveau ${this.user.level}`;
                
                // Update harmonie progress
                const currentHarmonie = this.user.harmonie;
                const nextLevelReq = this.getLevelRequirement(this.user.level + 1);
                const percentage = (currentHarmonie / nextLevelReq) * 100;
                
                const progressBar = document.getElementById('harmonie-progress');
                if (progressBar) progressBar.style.width = `${percentage}%`;
                
                const currentSpan = document.getElementById('harmonie-current');
                if (currentSpan) currentSpan.textContent = currentHarmonie;
                
                const nextSpan = document.getElementById('harmonie-next');
                if (nextSpan) nextSpan.textContent = nextLevelReq;
                
                const currentLevelSpan = document.getElementById('current-level');
                if (currentLevelSpan) currentLevelSpan.textContent = this.user.level;
                
                const levelUpText = document.getElementById('level-up-text');
                if (levelUpText) {
                    const remaining = nextLevelReq - currentHarmonie;
                    levelUpText.textContent = `${remaining} jusqu'au niveau ${this.user.level + 1}`;
                }
                
                // Update stats
                const streakSpan = document.getElementById('profile-streak');
                if (streakSpan) streakSpan.textContent = this.user.streak;
                
                const entriesSpan = document.getElementById('profile-entries');
                if (entriesSpan) entriesSpan.textContent = this.user.journalEntries.length;
                
                const reactionsSpan = document.getElementById('profile-reactions');
                if (reactionsSpan) reactionsSpan.textContent = this.user.totalReactions;
                
                const profileName = document.getElementById('profile-name');
                if (profileName) profileName.textContent = this.user.name;
                
                // Update intentions UI
                this.updateIntentionsUI();
            },
            
            updateIntentionsUI() {
                this.resetDailyIntentions();
                
                const writeCard = document.getElementById('intention-write');
                const envelopeCard = document.getElementById('intention-envelope');
                const reactCard = document.getElementById('intention-react');
                
                if (writeCard) {
                    if (this.user.dailyIntentions.write) {
                        writeCard.classList.add('completed');
                    } else {
                        writeCard.classList.remove('completed');
                    }
                }
                
                if (envelopeCard) {
                    if (this.user.dailyIntentions.envelope) {
                        envelopeCard.classList.add('completed');
                    } else {
                        envelopeCard.classList.remove('completed');
                    }
                }
                
                if (reactCard) {
                    const count = this.user.dailyIntentions.reactCount;
                    const reactCountSpan = document.getElementById('reactions-count');
                    if (reactCountSpan) reactCountSpan.textContent = count;
                    
                    if (count >= 3) {
                        reactCard.classList.add('completed');
                    } else {
                        reactCard.classList.remove('completed');
                    }
                }
            },
            
            autoSaveJournal() {
                console.log('Auto-saving journal...');
                // Silent save
            },
            
            confirmExitEditor() {
                const text = document.getElementById('journal-text').value;
                if (text.trim()) {
                    if (confirm('Sauvegarder cette page avant de partir ?')) {
                        this.saveJournalEntry();
                    } else {
                        this.navigateTo('home');
                    }
                } else {
                    this.navigateTo('home');
                }
            },
            
            // ============================================
            // COLLECTION
            // ============================================
            
            // Collection filter state
            collectionFilter: {
                type: 'sticker', // sticker, paper, washi
                collection: 'all', // all, japan-lofi, dark-fantasy, cottage-core
            },
            
            filterCollectionByType(type) {
                this.collectionFilter.type = type;
                this.collectionFilter.collection = 'all'; // Reset collection filter
                
                // Update UI
                document.querySelectorAll('.filter-btn-level1').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`.filter-btn-level1[data-type="${type}"]`).classList.add('active');
                
                // Show level 2 filter for all types (not just stickers)
                const level2 = document.getElementById('collection-filters-level2');
                level2.classList.remove('hidden');
                
                // Reset level 2 to 'all'
                document.querySelectorAll('.filter-btn-level2').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('.filter-btn-level2[data-collection="all"]').classList.add('active');
                
                this.renderCollection();
            },
            
            filterCollectionByCollection(collection) {
                this.collectionFilter.collection = collection;
                
                // Update UI
                document.querySelectorAll('.filter-btn-level2').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`.filter-btn-level2[data-collection="${collection}"]`).classList.add('active');
                
                this.renderCollection();
            },
            
            renderCollection() {
                const grid = document.getElementById('collection-grid');
                grid.innerHTML = '';
                
                console.log('=== RENDER COLLECTION DEBUG ===');
                console.log('Total user collection:', this.user.collection.length);
                console.log('Current filter:', this.collectionFilter);
                
                // Filter assets based on current filters
                let filteredAssets = this.user.collection.filter(asset => {
                    // Type filter
                    if (asset.type !== this.collectionFilter.type) return false;
                    
                    // Collection filter (applies to all types now)
                    if (this.collectionFilter.collection !== 'all') {
                        if (asset.collection !== this.collectionFilter.collection) return false;
                    }
                    
                    return true;
                });
                
                console.log('Filtered assets count:', filteredAssets.length);
                
                // Update stats
                document.getElementById('total-assets').textContent = this.user.collection.length;
                document.getElementById('rare-count').textContent = 
                    this.user.collection.filter(a => a.rarity === 'rare').length;
                document.getElementById('legendary-count').textContent = 
                    this.user.collection.filter(a => a.rarity === 'legendary').length;
                
                // Show empty state if no assets
                if (filteredAssets.length === 0) {
                    grid.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: var(--space-2xl); color: rgba(61, 52, 40, 0.5);">
                            <p style="font-size: 48px; margin-bottom: var(--space-md);">ðŸ“¦</p>
                            <p>Aucun asset de ce type</p>
                            <button class="btn btn-secondary" onclick="app.forceResetCollection()" style="margin-top: var(--space-lg);">
                                ðŸ”„ RÃ©initialiser (Debug)
                            </button>
                        </div>
                    `;
                    return;
                }
                
                // Render items
                filteredAssets.forEach(asset => {
                    const item = document.createElement('div');
                    item.className = 'collection-item';
                    
                    // Check if icon is URL (image) or emoji
                    const isImage = asset.icon.startsWith('http');
                    
                    item.innerHTML = `
                        <div class="collection-item-icon">
                            ${isImage ? `<img src="${asset.icon}" alt="${asset.name}" style="width: 100%; height: 100%; object-fit: contain;">` : asset.icon}
                        </div>
                        <div class="collection-item-name">${asset.name}</div>
                    `;
                    
                    item.addEventListener('click', () => {
                        this.showAssetDetail(asset);
                    });
                    
                    grid.appendChild(item);
                })
;
            },
            
            forceResetCollection() {
                console.log('ðŸ”„ Force resetting collection...');
                this.user.collection = [];
                this.initStarterCollection();
                this.renderCollection();
            },
            
            showAssetDetail(asset) {
                const content = document.getElementById('asset-detail-content');
                const artist = this.artists[asset.artistId];
                
                // Check if user owns this asset
                const owned = this.user.collection.find(a => a.id === asset.id);
                const timesUsed = owned ? (owned.timesUsed || 0) : 0;
                const unlockedDate = owned ? new Date(owned.unlockedAt) : null;
                
                // Check if icon is URL (image) or emoji
                const isImage = asset.icon.startsWith('http');
                
                content.innerHTML = `
                    <div class="asset-detail-visual">
                        ${isImage ? `<img src="${asset.icon}" alt="${asset.name}" style="width: 100%; height: 100%; object-fit: contain;">` : asset.icon}
                    </div>
                    
                    <div class="rarity-badge rarity-${asset.rarity}" style="margin: 0 auto var(--space-md); display: inline-block;">
                        ${asset.rarity.toUpperCase()}
                    </div>
                    
                    <h2 class="asset-detail-name">${asset.name}</h2>
                    
                    <div class="asset-detail-artist" onclick="app.showArtistDetail('${asset.artistId}')">
                        Par ${asset.artist} â†’
                    </div>
                    
                    <div class="asset-detail-tags">
                        <span class="asset-tag">${this.getAssetTypeLabel(asset.type)}</span>
                        ${asset.collection ? `<span class="asset-tag">${this.getCollectionLabel(asset.collection)}</span>` : ''}
                    </div>
                    
                    ${owned ? `
                        <div class="asset-usage-stats">
                            <div class="usage-stat-item">
                                <span class="usage-stat-label">DÃ©bloquÃ© le</span>
                                <span class="usage-stat-value">${this.formatDate(unlockedDate)}</span>
                            </div>
                            <div class="usage-stat-item">
                                <span class="usage-stat-label">UtilisÃ©</span>
                                <span class="usage-stat-value">${timesUsed} fois</span>
                            </div>
                        </div>
                    ` : `
                        <div class="card" style="background: rgba(212, 165, 137, 0.1); padding: var(--space-lg); margin-bottom: var(--space-lg);">
                            <p style="font-size: 14px; color: rgba(61, 52, 40, 0.7);">
                                ðŸ”’ Asset non dÃ©bloquÃ©<br>
                                ${asset.locked ? 'Disponible prochainement' : 'Continue Ã  ouvrir des enveloppes pour le dÃ©bloquer'}
                            </p>
                        </div>
                    `}
                    
                    ${owned && !asset.locked ? `
                        <button class="btn btn-primary btn-full" onclick="app.useAssetInEditor('${asset.id}')">
                            Utiliser dans mon journal
                        </button>
                    ` : ''}
                `;
                
                document.getElementById('asset-detail-modal').classList.add('active');
            },
            
            getCollectionLabel(collection) {
                const labels = {
                    'japan-lofi': 'ðŸŽŒ Japan Lofi',
                    'dark-fantasy': 'ðŸŒ™ Dark Fantasy',
                    'cottage-core': 'ðŸŒ¿ Cottage Core',
                    'emotions': 'ðŸ’ Ã‰motions',
                    'essentials': 'âœ¨ Essentials',
                };
                return labels[collection] || collection;
            },
            
            getAssetTypeLabel(type) {
                const labels = {
                    'sticker': 'Sticker',
                    'paper': 'Papier',
                    'washi': 'Washi Tape',
                    'frame': 'Cadre',
                    'stamp': 'Tampon',
                };
                return labels[type] || type;
            },
            
            closeAssetDetail() {
                document.getElementById('asset-detail-modal').classList.remove('active');
            },
            
            useAssetInEditor(assetId) {
                this.closeAssetDetail();
                this.navigateTo('journal-editor');
                // Asset will be available in palette
                this.showToast('Ouvre la palette pour utiliser cet asset ðŸŽ¨');
            },
            
            showArtistDetail(artistId) {
                const artist = this.artists[artistId];
                if (!artist) return;
                
                // Get all assets by this artist
                const artistAssets = this.availableAssets.filter(a => a.artistId === artistId);
                const ownedAssets = artistAssets.filter(a => 
                    this.user.collection.find(c => c.id === a.id)
                );
                
                const content = document.getElementById('artist-detail-content');
                content.innerHTML = `
                    <div class="artist-avatar">${artist.avatar}</div>
                    <h2 class="artist-name">${artist.name}</h2>
                    <div class="artist-location">ðŸ“ ${artist.location}</div>
                    
                    <div class="artist-bio">${artist.bio}</div>
                    
                    <div class="artist-stats">
                        <div class="artist-stat">
                            <span class="artist-stat-number">${artistAssets.length}</span>
                            <span class="artist-stat-label">Assets crÃ©Ã©s</span>
                        </div>
                        <div class="artist-stat">
                            <span class="artist-stat-number">${ownedAssets.length}</span>
                            <span class="artist-stat-label">PossÃ©dÃ©s</span>
                        </div>
                        <div class="artist-stat">
                            <span class="artist-stat-number">${artistAssets.filter(a => a.rarity === 'legendary').length}</span>
                            <span class="artist-stat-label">LÃ©gendaires</span>
                        </div>
                    </div>
                    
                    <div class="artist-assets-section">
                        <h3 class="artist-assets-title">Ses crÃ©ations</h3>
                        <div class="artist-assets-grid">
                            ${artistAssets.map(asset => {
                                const owned = ownedAssets.find(a => a.id === asset.id);
                                return `
                                    <div class="artist-asset-item" 
                                         style="opacity: ${owned ? '1' : '0.3'};"
                                         onclick="app.closeArtistModal(); app.showAssetDetail(app.availableAssets.find(a => a.id === ${asset.id}))">
                                        ${asset.icon}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div class="artist-social-links">
                        <a class="social-link" onclick="app.openArtistSocial('${artist.instagram}')" title="Instagram">
                            ðŸ“·
                        </a>
                        <a class="social-link" onclick="app.openArtistSocial('${artist.website}')" title="Site web">
                            ðŸŒ
                        </a>
                    </div>
                `;
                
                // Close asset detail if open
                this.closeAssetDetail();
                
                document.getElementById('artist-modal').classList.add('active');
            },
            
            closeArtistModal() {
                document.getElementById('artist-modal').classList.remove('active');
            },
            
            openArtistSocial(handle) {
                this.showToast(`Ouverture de ${handle}... (demo)`);
            },
            
            // ============================================
            // MOOD PICKER
            // ============================================
            
            selectMood(mood, color) {
                // Remove previous selection
                document.querySelectorAll('.mood-color').forEach(m => {
                    m.classList.remove('selected');
                });
                
                // Select this one
                document.querySelector(`.mood-color[data-mood="${mood}"]`).classList.add('selected');
                
                this.user.currentMood = { mood, color };
            },
            
            saveMood() {
                if (!this.user.currentMood) {
                    this.showToast('Choisis une humeur d\'abord');
                    return;
                }
                
                // Save to moods object with today's date
                const today = this.getDateKey(new Date());
                this.user.moods[today] = this.user.currentMood;
                
                this.saveToStorage();
                this.closeMoodPicker();
                this.showToast('Humeur enregistrÃ©e ðŸ˜Š');
            },
            
            // ============================================
            // JOURNAL HISTORY
            // ============================================
            
            filterJournal(filter) {
                console.log('Filter journal:', filter);
                this.renderJournalHistory(filter);
            },
            
            renderJournalHistory(filter = 'all') {
                const list = document.getElementById('journal-entries-list');
                list.innerHTML = '';
                
                let entries = [...this.user.journalEntries];
                
                // Filter
                const now = new Date();
                if (filter === 'this-week') {
                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    entries = entries.filter(e => new Date(e.date) >= weekAgo);
                } else if (filter === 'this-month') {
                    entries = entries.filter(e => {
                        const entryDate = new Date(e.date);
                        return entryDate.getMonth() === now.getMonth() && 
                               entryDate.getFullYear() === now.getFullYear();
                    });
                }
                
                // Sort by date desc
                entries.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                if (entries.length === 0) {
                    list.innerHTML = '<p style="text-align: center; color: rgba(61, 52, 40, 0.5); padding: var(--space-xl);">Aucune entrÃ©e pour cette pÃ©riode</p>';
                    return;
                }
                
                entries.forEach(entry => {
                    const card = document.createElement('div');
                    card.className = 'journal-entry-card';
                    
                    const date = new Date(entry.date);
                    const dateStr = this.formatDate(date);
                    
                    const moodColor = entry.mood ? entry.mood.color : 'transparent';
                    const moodBorderColor = entry.mood ? moodColor : 'rgba(61, 52, 40, 0.1)';
                    
                    const previewClass = this.user.settings.magicBlurEnabled ? 'entry-preview blurred' : 'entry-preview';
                    
                    const stickerCount = entry.stickers ? entry.stickers.length : 0;
                    
                    card.style.borderLeftColor = moodBorderColor;
                    
                    card.innerHTML = `
                        <div class="entry-header">
                            <div class="entry-date">${dateStr}</div>
                            <div class="entry-mood-indicator" style="background: ${moodColor}; border-color: ${moodBorderColor};"></div>
                        </div>
                        <div class="${previewClass}">${entry.text}</div>
                        <div class="entry-stats">
                            <span>ðŸŽ¨ ${stickerCount} stickers</span>
                            ${entry.mood ? `<span>${this.getMoodEmoji(entry.mood.mood)}</span>` : ''}
                        </div>
                    `;
                    
                    card.addEventListener('click', () => {
                        this.viewJournalEntry(entry);
                    });
                    
                    list.appendChild(card);
                });
            },
            
            viewJournalEntry(entry) {
                // Find all entries and the index of this one
                const allEntries = [...this.user.journalEntries].sort((a, b) => 
                    new Date(b.date) - new Date(a.date)
                );
                
                const index = allEntries.findIndex(e => e.id === entry.id);
                
                this.viewer.entries = allEntries;
                this.viewer.currentIndex = index;
                this.viewer.textVisible = true;
                
                this.renderJournalViewer();
                document.getElementById('journal-viewer-modal').classList.add('active');
            },
            
            renderJournalViewer() {
                const entry = this.viewer.entries[this.viewer.currentIndex];
                if (!entry) return;
                
                const content = document.getElementById('viewer-content');
                const date = new Date(entry.date);
                
                const moodDisplay = entry.mood ? `
                    <div class="viewer-mood" style="background: ${entry.mood.color};">
                        ${this.getMoodEmoji(entry.mood.mood)} ${entry.mood.mood}
                    </div>
                ` : '';
                
                const stickersHTML = (entry.stickers || []).map(sticker => `
                    <div class="viewer-sticker" style="left: ${sticker.x}px; top: ${sticker.y}px;">
                        ${sticker.icon}
                    </div>
                `).join('');
                
                content.innerHTML = `
                    <div class="viewer-page">
                        <div class="viewer-date">${this.formatDate(date)}</div>
                        ${moodDisplay}
                        <div class="viewer-text ${!this.viewer.textVisible ? 'hidden' : ''}" id="viewer-text">
                            ${entry.text}
                        </div>
                        <div class="viewer-stickers">
                            ${stickersHTML}
                        </div>
                    </div>
                `;
                
                // Update navigation
                const indicator = document.getElementById('page-indicator');
                indicator.textContent = `${this.viewer.currentIndex + 1} / ${this.viewer.entries.length}`;
                
                const prevBtn = document.getElementById('prev-page-btn');
                const nextBtn = document.getElementById('next-page-btn');
                prevBtn.disabled = this.viewer.currentIndex === 0;
                nextBtn.disabled = this.viewer.currentIndex === this.viewer.entries.length - 1;
            },
            
            closeJournalViewer() {
                document.getElementById('journal-viewer-modal').classList.remove('active');
            },
            
            previousJournalPage() {
                if (this.viewer.currentIndex > 0) {
                    this.viewer.currentIndex--;
                    this.renderJournalViewer();
                }
            },
            
            nextJournalPage() {
                if (this.viewer.currentIndex < this.viewer.entries.length - 1) {
                    this.viewer.currentIndex++;
                    this.renderJournalViewer();
                }
            },
            
            toggleTextVisibility() {
                this.viewer.textVisible = !this.viewer.textVisible;
                const text = document.getElementById('viewer-text');
                if (text) {
                    text.classList.toggle('hidden');
                }
                
                const btn = document.getElementById('toggle-text-btn');
                btn.textContent = this.viewer.textVisible ? 'ðŸ‘ï¸' : 'ðŸ™ˆ';
            },
            
            editJournalPage() {
                const entry = this.viewer.entries[this.viewer.currentIndex];
                this.closeJournalViewer();
                this.navigateTo('journal-editor');
                this.showToast('Mode Ã©dition (Ã  implÃ©menter)');
            },
            
            shareJournalPage() {
                this.closeJournalViewer();
                document.getElementById('share-modal').classList.add('active');
                
                // Populate preview
                const entry = this.viewer.entries[this.viewer.currentIndex];
                this.currentShareEntry = entry;
            },
            
            closeShareModal() {
                document.getElementById('share-modal').classList.remove('active');
                document.getElementById('share-actions').style.display = 'none';
            },
            
            generateShareImage() {
                const hideText = document.getElementById('share-hide-text').checked;
                const showMood = document.getElementById('share-show-mood').checked;
                const showDate = document.getElementById('share-show-date').checked;
                
                this.showLoading(true);
                
                // Simulate image generation
                setTimeout(() => {
                    this.showLoading(false);
                    document.getElementById('share-actions').style.display = 'block';
                    this.showToast('âœ¨ Image gÃ©nÃ©rÃ©e !');
                }, 1500);
            },
            
            downloadShare() {
                this.showToast('ðŸ“¥ TÃ©lÃ©chargement... (demo)');
                setTimeout(() => {
                    this.closeShareModal();
                }, 1000);
            },
            
            copyShareLink() {
                // Simulate copy
                this.showToast('ðŸ”— Lien copiÃ© ! (demo)');
                setTimeout(() => {
                    this.closeShareModal();
                }, 1000);
            },
            
            // ============================================
            // INSPIRATION PROMPTS
            // ============================================
            
            showInspirationPrompt() {
                document.getElementById('inspiration-modal').classList.add('active');
                document.getElementById('writing-prompts').classList.add('hidden');
            },
            
            closeInspirationModal() {
                document.getElementById('inspiration-modal').classList.remove('active');
            },
            
            startWritingWithoutPrompt() {
                this.closeInspirationModal();
                // Now actually navigate to editor
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('journal-editor-screen').classList.add('active');
                this.currentScreen = 'journal-editor';
                this.setupEditorZen();
                document.getElementById('bottom-nav').style.display = 'none';
            },
            
            showWritingPrompts() {
                // Get today's mood or use a default
                const today = this.getDateKey(new Date());
                const todayMood = this.user.moods[today]?.mood || this.getMostRecentMood() || 'calm';
                
                const prompts = this.getWritingPromptsForMood(todayMood);
                
                const promptsList = document.getElementById('prompts-list');
                promptsList.innerHTML = prompts.map(prompt => `
                    <div class="prompt-item" onclick="app.useWritingPrompt(\`${prompt}\`)">
                        ${prompt}
                    </div>
                `).join('');
                
                document.getElementById('writing-prompts').classList.remove('hidden');
            },
            
            getMostRecentMood() {
                const moodEntries = Object.entries(this.user.moods).sort((a, b) => b[0].localeCompare(a[0]));
                return moodEntries.length > 0 ? moodEntries[0][1].mood : null;
            },
            
            getWritingPromptsForMood(mood) {
                const promptsByMood = {
                    calm: [
                        "Aujourd'hui, j'ai ressenti une paix intÃ©rieure quand...",
                        "Ce qui m'apaise en ce moment, c'est...",
                        "Un moment de calme que j'ai savourÃ© aujourd'hui...",
                        "Je me sens apaisÃ©e parce que...",
                    ],
                    happy: [
                        "Ce qui m'a fait sourire aujourd'hui...",
                        "Je suis reconnaissante pour...",
                        "Un petit bonheur du jour...",
                        "Ce qui illumine ma journÃ©e...",
                    ],
                    sad: [
                        "Aujourd'hui, j'ai besoin de...",
                        "Ce qui pÃ¨se sur mon cÅ“ur...",
                        "Si je pouvais m'envoyer un message de rÃ©confort...",
                        "Ce dont j'ai besoin pour me sentir mieux...",
                    ],
                    energetic: [
                        "Aujourd'hui, je dÃ©borde d'Ã©nergie et je veux...",
                        "Ce qui me motive en ce moment...",
                        "J'ai envie de rÃ©aliser...",
                        "Cette Ã©nergie m'inspire Ã ...",
                    ],
                    peaceful: [
                        "Je me sens en harmonie avec...",
                        "Ce moment de sÃ©rÃ©nitÃ© oÃ¹...",
                        "La paix que je ressens vient de...",
                        "Dans cet instant de tranquillitÃ©...",
                    ],
                    anxious: [
                        "Ce qui m'inquiÃ¨te aujourd'hui...",
                        "Pour apaiser mon anxiÃ©tÃ©, je peux...",
                        "Ces pensÃ©es qui tournent en boucle...",
                        "J'aimerais me libÃ©rer de...",
                    ],
                };
                
                return promptsByMood[mood] || promptsByMood.calm;
            },
            
            useWritingPrompt(prompt) {
                this.closeInspirationModal();
                
                // Navigate to editor
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('journal-editor-screen').classList.add('active');
                this.currentScreen = 'journal-editor';
                this.setupEditorZen();
                document.getElementById('bottom-nav').style.display = 'none';
                
                // Pre-fill with prompt
                setTimeout(() => {
                    const textarea = document.getElementById('journal-text');
                    if (textarea) {
                        textarea.value = prompt;
                        textarea.focus();
                        // Place cursor at end
                        textarea.setSelectionRange(prompt.length, prompt.length);
                    }
                }, 100);
            },
            
            formatDate(date) {
                const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
                return date.toLocaleDateString('fr-FR', options);
            },
            
            getMoodEmoji(mood) {
                const emojis = {
                    'calm': 'â˜ï¸',
                    'happy': 'ðŸ˜Š',
                    'sad': 'ðŸ˜¢',
                    'energetic': 'âš¡',
                    'peaceful': 'ðŸ§˜',
                    'anxious': 'ðŸ˜°',
                };
                return emojis[mood] || 'ðŸ˜Š';
            },
            
            getDateKey(date) {
                return date.toISOString().split('T')[0];
            },
            
            // ============================================
            // PIXEL YEAR
            // ============================================
            
            renderPixelYear() {
                const grid = document.getElementById('pixel-year-grid');
                grid.innerHTML = '';
                
                // Generate 365 pixels
                const year = 2026;
                for (let day = 1; day <= 365; day++) {
                    const pixel = document.createElement('div');
                    pixel.className = 'pixel';
                    
                    // Calculate date for this pixel
                    const date = new Date(year, 0, day);
                    const dateKey = this.getDateKey(date);
                    
                    // Check if we have a mood for this day
                    if (this.user.moods[dateKey]) {
                        pixel.style.background = this.user.moods[dateKey].color;
                        pixel.classList.add('filled');
                        pixel.title = `${this.formatDate(date)} - ${this.user.moods[dateKey].mood}`;
                    } else {
                        pixel.title = this.formatDate(date);
                    }
                    
                    pixel.addEventListener('click', () => {
                        if (this.user.moods[dateKey]) {
                            alert(`${this.formatDate(date)}\n${this.getMoodEmoji(this.user.moods[dateKey].mood)} ${this.user.moods[dateKey].mood}`);
                        } else {
                            alert(`${this.formatDate(date)}\nPas d'humeur enregistrÃ©e`);
                        }
                    });
                    
                    grid.appendChild(pixel);
                }
            },
            
            sharePixelYear() {
                this.showToast('Export Pixel Year... (Ã  implÃ©menter)');
            },
            
            // ============================================
            // SETTINGS
            // ============================================
            
            toggleNotifications() {
                const checkbox = document.getElementById('notif-checkbox');
                this.user.settings.notifications = !checkbox.checked;
                checkbox.checked = this.user.settings.notifications;
                this.saveToStorage();
                this.showToast(this.user.settings.notifications ? 'Notifications activÃ©es ðŸ””' : 'Notifications dÃ©sactivÃ©es');
            },
            
            toggleAmbiance() {
                const checkbox = document.getElementById('ambiance-checkbox');
                this.user.settings.ambianceEnabled = !checkbox.checked;
                checkbox.checked = this.user.settings.ambianceEnabled;
                this.saveToStorage();
                
                if (this.user.settings.ambianceEnabled) {
                    this.showAmbiancePicker();
                } else {
                    this.stopAmbiance();
                }
            },
            
            toggleMagicBlur() {
                const checkbox = document.getElementById('blur-checkbox');
                this.user.settings.magicBlurEnabled = !checkbox.checked;
                checkbox.checked = this.user.settings.magicBlurEnabled;
                this.saveToStorage();
                this.showToast(this.user.settings.magicBlurEnabled ? 'Magic Blur activÃ© âœ¨' : 'Magic Blur dÃ©sactivÃ©');
            },
            
            updateSettingsUI() {
                document.getElementById('settings-name').textContent = this.user.name;
                document.getElementById('settings-email').textContent = this.user.email;
                document.getElementById('notif-checkbox').checked = this.user.settings.notifications;
                document.getElementById('ambiance-checkbox').checked = this.user.settings.ambianceEnabled;
                document.getElementById('blur-checkbox').checked = this.user.settings.magicBlurEnabled;
                
                const subscriptionBadge = document.getElementById('subscription-badge');
                if (this.user.isPremium) {
                    subscriptionBadge.innerHTML = '<div class="badge badge-success">Premium âœ¨</div>';
                }
            },
            
            // ============================================
            // WELLNESS DASHBOARD
            // ============================================
            
            renderWellnessDashboard() {
                // Update stats
                document.getElementById('wellness-streak').textContent = this.user.streak;
                document.getElementById('wellness-entries').textContent = this.user.journalEntries.length;
                
                // Calculate dominant mood
                const moodCounts = {};
                Object.values(this.user.moods).forEach(mood => {
                    moodCounts[mood.mood] = (moodCounts[mood.mood] || 0) + 1;
                });
                
                const dominantMood = Object.keys(moodCounts).reduce((a, b) => 
                    moodCounts[a] > moodCounts[b] ? a : b, 'Calme'
                );
                document.getElementById('wellness-mood').textContent = dominantMood;
                
                // Render mood distribution (last 7 days)
                this.renderMoodDistribution();
                
                // Render insights
                this.renderInsights();
                
                // Month progress
                const now = new Date();
                const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
                const daysWritten = this.user.journalEntries.filter(e => {
                    const entryDate = new Date(e.date);
                    return entryDate.getMonth() === now.getMonth() && 
                           entryDate.getFullYear() === now.getFullYear();
                }).length;
                
                const percentage = (daysWritten / daysInMonth) * 100;
                document.getElementById('month-progress-text').textContent = `${daysWritten} / ${daysInMonth}`;
                document.getElementById('month-progress-bar').style.width = `${percentage}%`;
            },
            
            renderMoodDistribution() {
                const container = document.getElementById('mood-distribution');
                const moods = ['calm', 'happy', 'sad', 'energetic', 'peaceful', 'anxious'];
                const colors = ['#B4C7D9', '#F4E4C1', '#D1C9D9', '#E8C5C0', '#C9D1BC', '#DDDAD3'];
                
                // Count moods in last 7 days
                const sevenDaysAgo = new Date();
                sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                
                const moodCounts = {};
                moods.forEach(mood => moodCounts[mood] = 0);
                
                Object.entries(this.user.moods).forEach(([dateKey, moodData]) => {
                    const date = new Date(dateKey);
                    if (date >= sevenDaysAgo) {
                        moodCounts[moodData.mood]++;
                    }
                });
                
                const maxCount = Math.max(...Object.values(moodCounts), 1);
                
                container.innerHTML = moods.map((mood, index) => {
                    const count = moodCounts[mood];
                    const height = (count / maxCount) * 100;
                    
                    return `
                        <div class="mood-bar" style="background: ${colors[index]}20;">
                            <div style="flex: 1; display: flex; align-items: flex-end;">
                                <div class="mood-bar-fill" style="height: ${height}%; background: ${colors[index]}; width: 100%;"></div>
                            </div>
                            <div style="margin-top: var(--space-xs);">${this.getMoodEmoji(mood)}</div>
                            <div class="mood-bar-label">${count}</div>
                        </div>
                    `;
                }).join('');
            },
            
            renderInsights() {
                const container = document.getElementById('insights-list');
                const insights = this.generateInsights();
                
                if (insights.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: rgba(61, 52, 40, 0.5);">Continue d\'Ã©crire pour voir des insights</p>';
                    return;
                }
                
                container.innerHTML = insights.map(insight => `
                    <div class="insight-item">
                        <div class="insight-icon">${insight.icon}</div>
                        <div class="insight-text">${insight.text}</div>
                    </div>
                `).join('');
            },
            
            generateInsights() {
                const insights = [];
                
                // Streak insight
                if (this.user.streak >= 7) {
                    insights.push({
                        icon: 'ðŸ”¥',
                        text: `Bravo ! Tu as Ã©crit ${this.user.streak} jours d'affilÃ©e. L'Ã©criture rÃ©guliÃ¨re aide Ã  rÃ©duire le stress de 30%.`
                    });
                } else if (this.user.streak >= 3) {
                    insights.push({
                        icon: 'â­',
                        text: `${this.user.streak} jours d'affilÃ©e ! Continue comme Ã§a, tu crÃ©es une belle habitude.`
                    });
                }
                
                // Mood insight
                const recentMoods = Object.entries(this.user.moods)
                    .sort((a, b) => new Date(b[0]) - new Date(a[0]))
                    .slice(0, 7);
                
                const calmDays = recentMoods.filter(([_, m]) => m.mood === 'calm' || m.mood === 'peaceful').length;
                
                if (calmDays >= 5) {
                    insights.push({
                        icon: 'ðŸ˜Œ',
                        text: 'Tu sembles Ãªtre dans une pÃ©riode apaisÃ©e. Profite de cette sÃ©rÃ©nitÃ© pour crÃ©er de belles pages.'
                    });
                }
                
                // Entries insight
                if (this.user.journalEntries.length >= 10) {
                    insights.push({
                        icon: 'ðŸ“š',
                        text: `Tu as dÃ©jÃ  ${this.user.journalEntries.length} pages ! Relire son journal aide Ã  mieux se comprendre.`
                    });
                }
                
                // Collection insight
                const legendary = this.user.collection.filter(a => a.rarity === 'legendary').length;
                if (legendary > 0) {
                    insights.push({
                        icon: 'âœ¨',
                        text: `Tu as ${legendary} asset${legendary > 1 ? 's' : ''} lÃ©gendaire${legendary > 1 ? 's' : ''} ! Ces crÃ©ations rares rendent tes pages uniques.`
                    });
                }
                
                return insights;
            },
            
            showPrivacyPolicy() {
                alert('Politique de confidentialitÃ©\n\nYORI respecte ta vie privÃ©e. Tes donnÃ©es sont chiffrÃ©es et ne sont jamais partagÃ©es.');
            },
            
            exportData() {
                const data = {
                    user: this.user.name,
                    entries: this.user.journalEntries.length,
                    collection: this.user.collection.length,
                    exportDate: new Date().toISOString(),
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'yori-export.json';
                a.click();
                
                this.showToast('DonnÃ©es exportÃ©es ðŸ“¥');
            },
            
            contactSupport() {
                window.open('mailto:support@yori.app?subject=Question depuis le POC', '_blank');
            },
            
            deleteAccount() {
                if (confirm('Es-tu sÃ»re de vouloir supprimer ton compte ? Cette action est irrÃ©versible.')) {
                    if (confirm('Vraiment sÃ»re ? Toutes tes donnÃ©es seront perdues.')) {
                        this.resetApp();
                    }
                }
            },
            
            // ============================================
            // PAYWALL
            // ============================================
            
            showPaywall() {
                document.getElementById('paywall-modal').classList.add('active');
            },
            
            closePaywall() {
                document.getElementById('paywall-modal').classList.remove('active');
            },
            
            purchasePremium() {
                // Simulate purchase
                this.showLoading(true);
                
                setTimeout(() => {
                    this.user.isPremium = true;
                    this.saveToStorage();
                    this.showLoading(false);
                    this.closePaywall();
                    this.showToast('Bienvenue dans Premium ! âœ¨');
                    this.updateSettingsUI();
                    this.updateHomeScreen();
                }, 1500);
            },
            
            // ============================================
            // AMBIANCE SOUNDS
            // ============================================
            
            showAmbiancePicker() {
                document.getElementById('ambiance-modal').classList.add('active');
            },
            
            closeAmbiancePicker() {
                document.getElementById('ambiance-modal').classList.remove('active');
            },
            
            selectAmbiance(ambiance) {
                // Check if premium required
                const premiumAmbiances = ['ocean', 'cafe', 'night'];
                if (premiumAmbiances.includes(ambiance) && !this.user.isPremium) {
                    this.closeAmbiancePicker();
                    this.showPaywall();
                    return;
                }
                
                // Remove previous active
                document.querySelectorAll('.ambiance-card').forEach(card => {
                    card.classList.remove('active');
                });
                
                // Set active
                document.querySelector(`.ambiance-card[data-ambiance="${ambiance}"]`).classList.add('active');
                
                this.user.settings.currentAmbiance = ambiance;
                this.saveToStorage();
                
                // Simulate playing sound
                this.showToast(`Ambiance "${ambiance}" en cours ðŸŽµ`);
                
                // Auto-close after selection
                setTimeout(() => {
                    this.closeAmbiancePicker();
                }, 800);
            },
            
            stopAmbiance() {
                this.user.settings.currentAmbiance = null;
                this.user.settings.ambianceEnabled = false;
                document.getElementById('ambiance-checkbox').checked = false;
                this.saveToStorage();
                
                document.querySelectorAll('.ambiance-card').forEach(card => {
                    card.classList.remove('active');
                });
                
                this.showToast('Ambiance arrÃªtÃ©e');
                this.closeAmbiancePicker();
            },
            
            // ============================================
            // UTILITIES
            // ============================================
            
            showLoading(show) {
                const loading = document.getElementById('loading');
                if (show) {
                    loading.classList.add('active');
                } else {
                    loading.classList.remove('active');
                }
            },
            
            showToast(message) {
                // Remove existing toast
                const existing = document.querySelector('.toast');
                if (existing) existing.remove();
                
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            },
            
            // Debug function to reset everything
            resetApp() {
                if (confirm('RÃ©initialiser toutes les donnÃ©es ? (debug)')) {
                    localStorage.removeItem('yori_data');
                    location.reload();
                }
            },
        };
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>
